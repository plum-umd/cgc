module CDGAI.AExpAbstract where

open import Prelude
open import POSet
open import CDGAI.ASyntax
open import CDGAI.ASemantics
open import CDGAI.AEnvAbstract

module Â§-Faexpâ™¯
  (â„¤â™¯ : POSet zeroË¡)
  (â‡„â„¤â‡„ : â‡§ â„¤ â‡„á¶œ â„¤â™¯)
  (âŠ¤â„¤â™¯ : âŸª â„¤â™¯ âŸ«)
  (Î·[âŠ¤â„¤] : (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ]) * â‹… allâº (â‡§ â„¤) âŠ‘ return â‹… âŠ¤â„¤â™¯)
  (âŸ¦_âŸ§áµƒÂ¹â™¯ : unary â†’ âŸª â„¤â™¯ â‡’ â„¤â™¯ âŸ«)
  (Î±[âŸ¦âŸ§áµƒÂ¹] : âˆ€ {o} â†’ Î±[ â‡„â„¤â‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] â‹… (pure â‹… âŸ¦ o âŸ§áµƒÂ¹âº) âŠ‘ pure â‹… âŸ¦ o âŸ§áµƒÂ¹â™¯)
  (âŸ¦_âŸ§áµƒÂ²â™¯ : binary â†’ âŸª â„¤â™¯ â‡’ â„¤â™¯ â‡’ â„¤â™¯ âŸ«)
  (Î±[âŸ¦âŸ§áµƒÂ²] : âˆ€ {o} â†’ Î±[ (â‡„â„¤â‡„ Ã—â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„) â‡’â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] â‹… (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²âº) âŠ‘ pure â‹… (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²â™¯))
  where
  open Â§-envâ™¯ â„¤â™¯ â‡„â„¤â‡„
  âˆƒÎ±[âŸ¦âŸ§áµƒ] :
    âˆƒ âŸ¦_âŸ§áµƒâ™¯ â¦‚ (âˆ€ {Î“} â†’ aexp Î“ â†’ âŸª â‡§ (envâ™¯ Î“) â‡’ â„¤â™¯ âŸ«)
    ğ‘ ğ‘¡ (âˆ€ {Î“} (e : aexp Î“) â†’ Î±[ â‡„envâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] â‹… âŸ¦ e âŸ§áµƒâº âŠ‘ pure â‹… âŸ¦ e âŸ§áµƒâ™¯)
  âˆƒÎ±[âŸ¦âŸ§áµƒ] = âˆƒ âŸ¦_âŸ§áµƒâ™¯ ,, Î±[âŸ¦âŸ§áµƒ]
    where
      âŸ¦_âŸ§áµƒâ™¯ : âˆ€ {Î“} â†’ aexp Î“ â†’ âŸª â‡§ (envâ™¯ Î“) â‡’ â„¤â™¯ âŸ«
      âŸ¦ Num n âŸ§áµƒâ™¯             = constâº â‹… (Î·á¶œ[ â‡„â„¤â‡„ ] â‹… â†‘ n)
      âŸ¦ Var x âŸ§áµƒâ™¯             = lookupâ™¯[ x ]
      âŸ¦ âŠ¤â„¤ âŸ§áµƒâ™¯                = constâº â‹… âŠ¤â„¤â™¯
      âŸ¦ Unary[ o ] e âŸ§áµƒâ™¯      = âŸ¦ o âŸ§áµƒÂ¹â™¯ âŠ™ âŸ¦ e âŸ§áµƒâ™¯
      âŸ¦ Binary[ o ] eâ‚ eâ‚‚ âŸ§áµƒâ™¯ = uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²â™¯ âŠ™ applyâ¸¢Ã—âºâ¸£ â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯) âŠ™ splitâº
      Î±[âŸ¦âŸ§áµƒ] : âˆ€ {Î“} (e : aexp Î“) â†’ Î±[ â‡„envâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] â‹… âŸ¦ e âŸ§áµƒâº âŠ‘ pure â‹… âŸ¦ e âŸ§áµƒâ™¯
      Î±[âŸ¦âŸ§áµƒ] (Num n) = ext[â‡’]â¸¢âŠ‘â¸£ $ Î» {Ï} â†’ let open Â§-ProofMode[âŠ‘] in [proof-mode]
        do [[ (Î±[ â‡„envâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] â‹… âŸ¦ Num n âŸ§áµƒâº) â‹… Ï ]]
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] âŸ âŸ¦ Num n âŸ§áµƒâº âŸ Î³á¶œ[ â‡„envâ‡„ ]) â‹… Ï ]]
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ]) * â‹… (âŸ¦ Num n âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï)) ]]
         â€£ [focus-right [â‹…] ğ‘œğ‘“ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ]) * ] begin
             do [[ (âŸ¦ Num n âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï)) ]]
              â€£ âŸ… ğ’âŸ¦NumâŸ§â¸¢âŠ‘â¸£ âŸ†â¸¢âŠ‘â¸£
              â€£ [[ return â‹… â†‘ n ]]
             end
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ]) * â‹… (return â‹… â†‘ n) ]]
         â€£ âŸ… right-unit[*] âŸ†â¸¢â‰ˆâ¸£
         â€£ [[ pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] â‹… â†‘ n ]]
         â€£ [[ pure â‹… (constâº â‹… (Î·á¶œ[ â‡„â„¤â‡„ ] â‹… â†‘ n)) â‹… Ï ]]
         â€£ [[ pure â‹… âŸ¦ Num n âŸ§áµƒâ™¯ â‹… Ï ]]
         âˆ 
      Î±[âŸ¦âŸ§áµƒ] (Var x) = let open Â§-ProofMode[âŠ‘] in [proof-mode]
        do [[ Î±[ â‡„envâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] â‹… âŸ¦ Var x âŸ§áµƒâº ]]
         â€£ [[ pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] âŸ âŸ¦ Var x âŸ§áµƒâº âŸ Î³á¶œ[ â‡„envâ‡„ ] ]]
         â€£ [focus-right [âŸ] ğ‘œğ‘“ pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] ] begin
             do [focus-left [âŸ] ğ‘œğ‘“ Î³á¶œ[ â‡„envâ‡„ ] ] begin
                  do [[ âŸ¦ Var x âŸ§áµƒâº ]]
                   â€£ âŸ… ğ’âŸ¦VarâŸ§â¸¢âŠ™â¸£ âŸ†â¸¢â‰ˆâ¸£
                   â€£ [[ pure â‹… lookup[ x ]âº ]]
                  end
              â€£ [[ pure â‹… lookup[ x ]âº âŸ Î³á¶œ[ â‡„envâ‡„ ] ]]
              â€£ âŸ… Ï€â‚ Î±[f]â†”fâŸÎ³á¶œ[ â‡„envâ‡„ , â‡„â„¤â‡„ ] $ Î±[lookup] {x = x} âŸ†
              â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ ] âŸ pure â‹… lookupâ™¯[ x ] ]]
             end
         â€£ [[ pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] âŸ Î³á¶œ[ â‡„â„¤â‡„ ] âŸ pure â‹… lookupâ™¯[ x ] ]]
         â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] âŸ Î³á¶œ[ â‡„â„¤â‡„ ]) âŸ pure â‹… lookupâ™¯[ x ] ]]
         â€£ âŸ… left-unit-contractive[âŸ]á¶œ[ â‡„â„¤â‡„ ] âŸ†
         â€£ [[ pure â‹… lookupâ™¯[ x ] ]]
         â€£ [[ pure â‹… âŸ¦ Var x âŸ§áµƒâ™¯ ]]
         âˆ 
      Î±[âŸ¦âŸ§áµƒ] âŠ¤â„¤ = ext[â‡’]â¸¢âŠ‘â¸£ $ Î» {Ï} â†’ let open Â§-ProofMode[âŠ‘] in [proof-mode]
        do [[ (Î±[ â‡„envâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] â‹… âŸ¦ âŠ¤â„¤ âŸ§áµƒâº) â‹… Ï ]]
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] âŸ âŸ¦ âŠ¤â„¤ âŸ§áµƒâº âŸ Î³á¶œ[ â‡„envâ‡„ ]) â‹… Ï ]]
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ]) * â‹… (âŸ¦ âŠ¤â„¤ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï)) ]]
         â€£ [focus-right [â‹…] ğ‘œğ‘“ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ]) * ] begin
             do [[ (âŸ¦ âŠ¤â„¤ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï)) ]]
              â€£ âŸ… ğ’âŸ¦âŠ¤â„¤âŸ§â¸¢âŠ‘â¸£ âŸ†
              â€£ [[ allâº (â‡§ â„¤) ]]
             end
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ]) * â‹… allâº (â‡§ â„¤) ]]
         â€£ âŸ… Î·[âŠ¤â„¤] âŸ†
         â€£ [[ return â‹… âŠ¤â„¤â™¯ ]]
         â€£ [[ pure â‹… âŸ¦ âŠ¤â„¤ âŸ§áµƒâ™¯ â‹… Ï ]]
         âˆ 
      Î±[âŸ¦âŸ§áµƒ] (Unary[ o ] e) with Î±[âŸ¦âŸ§áµƒ] e
      ... | IH = let open Â§-ProofMode[âŠ‘] in [proof-mode]
        do [[ Î±[ â‡„envâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] â‹… âŸ¦ Unary[ o ] e âŸ§áµƒâº ]]
         â€£ [[ pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] âŸ âŸ¦ Unary[ o ] e âŸ§áµƒâº âŸ Î³á¶œ[ â‡„envâ‡„ ] ]]
         â€£ [focus-right [âŸ] ğ‘œğ‘“ pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] ] begin
             do [focus-left [âŸ] ğ‘œğ‘“ Î³á¶œ[ â‡„envâ‡„ ] ] begin
                  do [[ âŸ¦ Unary[ o ] e âŸ§áµƒâº ]]
                   â€£ âŸ… ğ’âŸ¦UnaryâŸ§â¸¢âŸâ¸£ âŸ†â¸¢â‰ˆâ¸£
                   â€£ [[ pure â‹… âŸ¦ o âŸ§áµƒÂ¹âº âŸ âŸ¦ e âŸ§áµƒâº ]]
                  end
              â€£ [[ (pure â‹… âŸ¦ o âŸ§áµƒÂ¹âº âŸ âŸ¦ e âŸ§áµƒâº) âŸ Î³á¶œ[ â‡„envâ‡„ ] ]]
              â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
              â€£ [[ pure â‹… âŸ¦ o âŸ§áµƒÂ¹âº âŸ âŸ¦ e âŸ§áµƒâº âŸ Î³á¶œ[ â‡„envâ‡„ ] ]]
              â€£ [focus-right [âŸ] ğ‘œğ‘“ pure â‹… âŸ¦ o âŸ§áµƒÂ¹âº ] begin
                  do [[ âŸ¦ e âŸ§áµƒâº âŸ Î³á¶œ[ â‡„envâ‡„ ] ]]
                   â€£ âŸ… Ï€â‚ Î±[f]â†”fâŸÎ³á¶œ[ â‡„envâ‡„ , â‡„â„¤â‡„ ] IH âŸ†
                   â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ ] âŸ pure â‹… âŸ¦ e âŸ§áµƒâ™¯ ]]
                  end
              â€£ [[ pure â‹… âŸ¦ o âŸ§áµƒÂ¹âº âŸ Î³á¶œ[ â‡„â„¤â‡„ ] âŸ pure â‹… âŸ¦ e âŸ§áµƒâ™¯ ]]
              â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
              â€£ [[ (pure â‹… âŸ¦ o âŸ§áµƒÂ¹âº âŸ Î³á¶œ[ â‡„â„¤â‡„ ]) âŸ pure â‹… âŸ¦ e âŸ§áµƒâ™¯ ]]
              â€£ [focus-left [âŸ] ğ‘œğ‘“ pure â‹… âŸ¦ e âŸ§áµƒâ™¯ ] begin
                  do [[ pure â‹… âŸ¦ o âŸ§áµƒÂ¹âº âŸ Î³á¶œ[ â‡„â„¤â‡„ ] ]]
                   â€£ âŸ… Ï€â‚ Î±[f]â†”fâŸÎ³á¶œ[ â‡„â„¤â‡„ , â‡„â„¤â‡„ ] Î±[âŸ¦âŸ§áµƒÂ¹] âŸ†
                   â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ ] âŸ pure â‹… âŸ¦ o âŸ§áµƒÂ¹â™¯ ]]
                  end
              â€£ [[ (Î³á¶œ[ â‡„â„¤â‡„ ] âŸ pure â‹… âŸ¦ o âŸ§áµƒÂ¹â™¯) âŸ pure â‹… âŸ¦ e âŸ§áµƒâ™¯ ]]
              â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
              â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ ] âŸ pure â‹… âŸ¦ o âŸ§áµƒÂ¹â™¯ âŸ pure â‹… âŸ¦ e âŸ§áµƒâ™¯ ]]
             end
         â€£ [[ pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] âŸ Î³á¶œ[ â‡„â„¤â‡„ ] âŸ pure â‹… âŸ¦ o âŸ§áµƒÂ¹â™¯ âŸ pure â‹… âŸ¦ e âŸ§áµƒâ™¯ ]]
         â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] âŸ Î³á¶œ[ â‡„â„¤â‡„ ]) âŸ pure â‹… âŸ¦ o âŸ§áµƒÂ¹â™¯ âŸ pure â‹… âŸ¦ e âŸ§áµƒâ™¯ ]]
         â€£ âŸ… left-unit-contractive[âŸ]á¶œ[ â‡„â„¤â‡„ ] âŸ†
         â€£ [[ pure â‹… âŸ¦ o âŸ§áµƒÂ¹â™¯ âŸ pure â‹… âŸ¦ e âŸ§áµƒâ™¯ ]]
         â€£ âŸ… homomorphic[pure]â¸¢âŸâ¸£ âŸ†â¸¢â‰ˆâ¸£
         â€£ [[ pure â‹… (âŸ¦ o âŸ§áµƒÂ¹â™¯ âŠ™ âŸ¦ e âŸ§áµƒâ™¯) ]]
         â€£ [[ pure â‹… âŸ¦ Unary[ o ] e âŸ§áµƒâ™¯ ]]
         âˆ
      Î±[âŸ¦âŸ§áµƒ] (Binary[ o ] eâ‚ eâ‚‚) with Î±[âŸ¦âŸ§áµƒ] eâ‚ | Î±[âŸ¦âŸ§áµƒ] eâ‚‚
      ... | IHâ‚ | IHâ‚‚ = ext[â‡’]â¸¢âŠ‘â¸£ $ Î» {Ï} â†’ let open Â§-ProofMode[âŠ‘] in [proof-mode]
        do [[ (Î±[ â‡„envâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] â‹… âŸ¦ Binary[ o ] eâ‚ eâ‚‚ âŸ§áµƒâº) â‹… Ï ]]
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ] âŸ âŸ¦ Binary[ o ] eâ‚ eâ‚‚ âŸ§áµƒâº âŸ Î³á¶œ[ â‡„envâ‡„ ]) â‹… Ï ]]
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ]) * â‹… (âŸ¦ Binary[ o ] eâ‚ eâ‚‚ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï)) ]]
         â€£ [focus-right [â‹…] ğ‘œğ‘“ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ]) * ] begin
             do [[ âŸ¦ Binary[ o ] eâ‚ eâ‚‚ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï) ]]
              â€£ âŸ… ğ’âŸ¦BinaryâŸ§â¸¢*â¸£â¸¢âŠ‘â¸£ âŸ†
              â€£ [[ (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²âº) * â‹… (Î³â¸¢IAâ¸£ â‹… (âŸ¦ eâ‚ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï) ,âº âŸ¦ eâ‚‚ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï))) ]]
              â€£ [focus-right [â‹…] ğ‘œğ‘“ (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²âº) * ] begin
                  do [focus-right [â‹…] ğ‘œğ‘“ Î³â¸¢IAâ¸£ ] begin
                       do [[ âŸ¦ eâ‚ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï) ,âº âŸ¦ eâ‚‚ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï) ]]
                        â€£ [focus-left [,] ğ‘œğ‘“ âŸ¦ eâ‚‚ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï) ] begin
                            do [[ âŸ¦ eâ‚ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï) ]]
                             â€£ âŸ… Ï€â‚ Î±[f]â†”fâŸÎ³á¶œ*[ â‡„envâ‡„ , â‡„â„¤â‡„ ] IHâ‚ âŸ†
                             â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ ] * â‹… (pure â‹… âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï) ]]
                             end
                        â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ ] * â‹… (pure â‹… âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï) ,âº âŸ¦ eâ‚‚ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï) ]]
                        â€£ [focus-right [,] ğ‘œğ‘“ Î³á¶œ[ â‡„â„¤â‡„ ] * â‹… (pure â‹… âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï) ] begin
                            do [[ âŸ¦ eâ‚‚ âŸ§áµƒâº * â‹… (Î³á¶œ[ â‡„envâ‡„ ] â‹… Ï) ]]
                             â€£ âŸ… Ï€â‚ Î±[f]â†”fâŸÎ³á¶œ*[ â‡„envâ‡„ , â‡„â„¤â‡„ ] IHâ‚‚ âŸ†
                             â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ ] * â‹… (pure â‹… âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï) ]]
                            end
                        â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ ] * â‹… (pure â‹… âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï) ,âº Î³á¶œ[ â‡„â„¤â‡„ ] * â‹… (pure â‹… âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï) ]]
                       end
                   â€£ [[ Î³â¸¢IAâ¸£ â‹… (Î³á¶œ[ â‡„â„¤â‡„ ] * â‹… (pure â‹… âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï) ,âº Î³á¶œ[ â‡„â„¤â‡„ ] * â‹… (pure â‹… âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï)) ]]
                   â€£ âŸ… homomorphic[Î³/Î³]â¸¢IAâ¸£[ â‡„â„¤â‡„ , â‡„â„¤â‡„ ] âŸ†â¸¢â‰ˆâ¸£
                   â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ Ã—â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] * â‹… (Î³â¸¢IAâ¸£ â‹… (pure â‹… âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï ,âº pure â‹… âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï)) ]]
                   â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ Ã—â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] * â‹… (Î³â¸¢IAâ¸£ â‹… (return â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï) ,âº return â‹… (âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï))) ]]
                   â€£ [focus-right [â‹…] ğ‘œğ‘“ Î³á¶œ[ â‡„â„¤â‡„ Ã—â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] * ] begin
                       do [[ Î³â¸¢IAâ¸£ â‹… (return â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï) ,âº return â‹… (âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï)) ]]
                        â€£ âŸ… homomorphic[Î³/return]â¸¢IAâ¸£ âŸ†â¸¢â‰ˆâ¸£
                        â€£ [[ return â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï) ]]
                       end
                   â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ Ã—â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] * â‹… (return â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï)) ]]
                  end
              â€£ [[ (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²âº) * â‹… (Î³á¶œ[ â‡„â„¤â‡„ Ã—â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ ] * â‹… (return â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï))) ]]
              â€£ âŸ… Ï€â‚ Î±[f]â†”fâŸÎ³á¶œ*X[ â‡„â„¤â‡„ Ã—â¸¢â‡„á¶œâ¸£ â‡„â„¤â‡„ , â‡„â„¤â‡„ ] Î±[âŸ¦âŸ§áµƒÂ²] âŸ†
              â€£ [[ Î³á¶œ[ â‡„â„¤â‡„ ] * â‹… ((pure â‹… (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²â™¯)) * â‹… (return â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï))) ]]
             end
         â€£ [[ (pure â‹… Î·á¶œ[ â‡„â„¤â‡„ ]) * â‹… (Î³á¶œ[ â‡„â„¤â‡„ ] * â‹… ((pure â‹… (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²â™¯)) * â‹… (return â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï)))) ]]
         â€£ âŸ… contractiveá¶œ[X*][ â‡„â„¤â‡„ ] âŸ†
         â€£ [[ (pure â‹… (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²â™¯)) * â‹… (return â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï)) ]]
         â€£ âŸ… right-unit[*] âŸ†â¸¢â‰ˆâ¸£
         â€£ [[ pure â‹… (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²â™¯) â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ â‹… Ï ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï) ]]
         â€£ [[ pure â‹… (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²â™¯) â‹… ((applyâ¸¢Ã—âºâ¸£ â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯)  âŠ™ splitâº) â‹… Ï) ]]
         â€£ âŸ… â—‡ $ homomorphic[pure] {g = (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²â™¯)} {f = applyâ¸¢Ã—âºâ¸£ â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯) âŠ™ splitâº} âŸ†â¸¢â‰ˆâ¸£
         â€£ [[ pure â‹… (uncurryâº â‹… âŸ¦ o âŸ§áµƒÂ²â™¯ âŠ™ applyâ¸¢Ã—âºâ¸£ â‹… (âŸ¦ eâ‚ âŸ§áµƒâ™¯ ,âº âŸ¦ eâ‚‚ âŸ§áµƒâ™¯) âŠ™ splitâº) â‹… Ï ]]
         â€£ [[ pure â‹… âŸ¦ Binary[ o ] eâ‚ eâ‚‚ âŸ§áµƒâ™¯ â‹… Ï ]]
         âˆ
