module AGT.SubTyped where

open import Prelude
open import POSet

module Â§ (L : â„•) where

  infix   8 _âŠ¢_
  infix   8 _âŠ¢â™¯_
  infix   8 _âˆˆ_
  infix   8 _âˆˆâ™¯_
  infixr 10 _âˆ·_
  infixr 10 _â¦‚_âˆ·_
  
  label : Set
  label = fin L

  --==========--
  -- Concrete --
  --==========--
  
  mutual
    data type : Set where
      âŠ¥ : type
      âŸ¨ğ”¹âŸ© : type
      _âŸ¨â†’âŸ©_ : type â†’ type â†’ type
      Rec : rec-type â†’ type
    data rec-type : Set where
      [] : rec-type
      _â¦‚_âˆ·_ : label â†’ type â†’ rec-type â†’ rec-type

  -- partial order
  -- (arrows are monotonic)

  mutual
    data _âŠ´áµ—_ : type â†’ type â†’ Set where
      âŠ¥ : âˆ€ {Ï„} â†’ âŠ¥ âŠ´áµ— Ï„
      âŸ¨ğ”¹âŸ© : âŸ¨ğ”¹âŸ© âŠ´áµ— âŸ¨ğ”¹âŸ©
      _âŸ¨â†’âŸ©_ : âˆ€ {Ï„â‚â‚ Ï„â‚‚â‚ Ï„â‚â‚‚ Ï„â‚‚â‚‚}
        â†’ Ï„â‚â‚ âŠ´áµ— Ï„â‚‚â‚
        â†’ Ï„â‚â‚‚ âŠ´áµ— Ï„â‚‚â‚‚
        â†’ (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚â‚‚) âŠ´áµ— (Ï„â‚‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚)
      Rec : âˆ€ {rÏ„â‚ rÏ„â‚‚}
        â†’ rÏ„â‚ âŠ´áµ—* rÏ„â‚‚
        â†’ Rec rÏ„â‚ âŠ´áµ— Rec rÏ„â‚‚
    data _âŠ´áµ—*_  : rec-type â†’ rec-type â†’ Set where
      [] : [] âŠ´áµ—* []
      _âˆ·_ : âˆ€ {l Ï„â‚ Ï„â‚‚ rÏ„â‚ rÏ„â‚‚}
        â†’ Ï„â‚ âŠ´áµ— Ï„â‚‚
        â†’ rÏ„â‚ âŠ´áµ—* rÏ„â‚‚
        â†’ (l â¦‚ Ï„â‚ âˆ· rÏ„â‚) âŠ´áµ—* (l â¦‚ Ï„â‚‚ âˆ· rÏ„â‚‚)

  mutual
    xRxâ¸¢âŠ´áµ—â¸£ : reflexive _âŠ´áµ—_
    xRxâ¸¢âŠ´áµ—â¸£ {âŠ¥} = âŠ¥
    xRxâ¸¢âŠ´áµ—â¸£ {âŸ¨ğ”¹âŸ©} = âŸ¨ğ”¹âŸ©
    xRxâ¸¢âŠ´áµ—â¸£ {Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚} = xRxâ¸¢âŠ´áµ—â¸£ âŸ¨â†’âŸ© xRxâ¸¢âŠ´áµ—â¸£
    xRxâ¸¢âŠ´áµ—â¸£ {Rec rÏ„} = Rec xRxâ¸¢âŠ´áµ—*â¸£

    xRxâ¸¢âŠ´áµ—*â¸£ : reflexive _âŠ´áµ—*_
    xRxâ¸¢âŠ´áµ—*â¸£ {[]} = []
    xRxâ¸¢âŠ´áµ—*â¸£ {l â¦‚ Ï„ âˆ· rÏ„} = xRxâ¸¢âŠ´áµ—â¸£ âˆ· xRxâ¸¢âŠ´áµ—*â¸£

  mutual
    _âŒ¾â¸¢âŠ´áµ—â¸£_ : transitive _âŠ´áµ—_
    _ âŒ¾â¸¢âŠ´áµ—â¸£ âŠ¥ = âŠ¥
    âŸ¨ğ”¹âŸ© âŒ¾â¸¢âŠ´áµ—â¸£ âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    (âŠ´â‚â‚ âŸ¨â†’âŸ© âŠ´â‚‚â‚) âŒ¾â¸¢âŠ´áµ—â¸£ (âŠ´â‚â‚‚ âŸ¨â†’âŸ© âŠ´â‚‚â‚‚) = (âŠ´â‚â‚ âŒ¾â¸¢âŠ´áµ—â¸£ âŠ´â‚â‚‚) âŸ¨â†’âŸ© (âŠ´â‚‚â‚ âŒ¾â¸¢âŠ´áµ—â¸£ âŠ´â‚‚â‚‚)
    Rec âŠ´*â‚ âŒ¾â¸¢âŠ´áµ—â¸£ Rec âŠ´*â‚‚ = Rec (âŠ´*â‚ âŒ¾â¸¢âŠ´áµ—*â¸£ âŠ´*â‚‚)

    _âŒ¾â¸¢âŠ´áµ—*â¸£_ : transitive _âŠ´áµ—*_
    [] âŒ¾â¸¢âŠ´áµ—*â¸£ [] = []
    (âŠ´â‚ âˆ· âŠ´*â‚) âŒ¾â¸¢âŠ´áµ—*â¸£ (âŠ´â‚‚ âˆ· âŠ´*â‚‚) = (âŠ´â‚ âŒ¾â¸¢âŠ´áµ—â¸£ âŠ´â‚‚) âˆ· (âŠ´*â‚ âŒ¾â¸¢âŠ´áµ—*â¸£ âŠ´*â‚‚)

  instance
    Reflexive[âŠ´áµ—] : Reflexive _âŠ´áµ—_
    Reflexive[âŠ´áµ—] = record { xRx = xRxâ¸¢âŠ´áµ—â¸£ }
    Reflexive[âŠ´áµ—*] : Reflexive _âŠ´áµ—*_
    Reflexive[âŠ´áµ—*] = record { xRx = xRxâ¸¢âŠ´áµ—*â¸£ }
    Transitive[âŠ´áµ—] : Transitive _âŠ´áµ—_
    Transitive[âŠ´áµ—] = record { _âŒ¾_ = _âŒ¾â¸¢âŠ´áµ—â¸£_ }
    Transitive[âŠ´áµ—*] : Transitive _âŠ´áµ—*_
    Transitive[âŠ´áµ—*] = record { _âŒ¾_ = _âŒ¾â¸¢âŠ´áµ—*â¸£_ }
    PreOrder[type] : PreOrder zeroË¡ type
    PreOrder[type] = record { _âŠ´_ = _âŠ´áµ—_ }
    PreOrder[rec-type] : PreOrder zeroË¡ rec-type
    PreOrder[rec-type] = record { _âŠ´_ = _âŠ´áµ—*_ }

  -- subtype order
  -- (arrows are co/contra-variant)

  mutual
    data _<:_ : type â†’ type â†’ Set where
      âŸ¨ğ”¹âŸ© : âŸ¨ğ”¹âŸ© <: âŸ¨ğ”¹âŸ©
      _âŸ¨â†’âŸ©_ : âˆ€ {Ï„â‚â‚ Ï„â‚‚â‚ Ï„â‚â‚‚ Ï„â‚‚â‚‚}
        â†’ Ï„â‚‚â‚ <: Ï„â‚â‚
        â†’ Ï„â‚â‚‚ <: Ï„â‚‚â‚‚
        â†’ (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚â‚‚) <: (Ï„â‚‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚)
      Rec : âˆ€ {rÏ„â‚ rÏ„â‚‚}
        â†’ rÏ„â‚ <:* rÏ„â‚‚
        â†’ Rec rÏ„â‚ <: Rec rÏ„â‚‚
    data _<:*_ : rec-type â†’ rec-type â†’ Set where
      [] : [] <:* []
      <[_] : âˆ€ {l Ï„ rÏ„â‚ rÏ„â‚‚}
        â†’ rÏ„â‚ <:* rÏ„â‚‚
        â†’ (l â¦‚ Ï„ âˆ· rÏ„â‚) <:* rÏ„â‚‚
      _âˆ·_ : âˆ€ {l Ï„â‚ Ï„â‚‚ rÏ„â‚ rÏ„â‚‚}
        â†’ Ï„â‚ <: Ï„â‚‚
        â†’ rÏ„â‚ <:* rÏ„â‚‚
        â†’ (l â¦‚ Ï„â‚ âˆ· rÏ„â‚) <:* (l â¦‚ Ï„â‚‚ âˆ· rÏ„â‚‚)

  -- dom and cod

  domáµ— : type â†’ type
  domáµ— (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = Ï„â‚
  domáµ— _ = âŠ¥

  monotonic[domáµ—] : proper (_âŠ´_ â‡‰ _âŠ´_) domáµ—
  monotonic[domáµ—] âŠ¥ = âŠ¥
  monotonic[domáµ—] âŸ¨ğ”¹âŸ© = âŠ¥
  monotonic[domáµ—] (âŠ´â‚ âŸ¨â†’âŸ© âŠ´â‚‚) = âŠ´â‚
  monotonic[domáµ—] (Rec âŠ´*â‚) = âŠ¥

  codáµ— : type â†’ type
  codáµ— (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = Ï„â‚‚
  codáµ— _ = âŠ¥

  monotonic[codáµ—] : proper (_âŠ´_ â‡‰ _âŠ´_) codáµ—
  monotonic[codáµ—] âŠ¥ = âŠ¥
  monotonic[codáµ—] âŸ¨ğ”¹âŸ© = âŠ¥
  monotonic[codáµ—] (âŠ´â‚ âŸ¨â†’âŸ© âŠ´â‚‚) = âŠ´â‚‚
  monotonic[codáµ—] (Rec âŠ´*â‚) = âŠ¥

  -- subtype join and meet

  mutual
    _âˆ¨:_ : type â†’ type â†’ type
    âŸ¨ğ”¹âŸ© âˆ¨: âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚) âˆ¨: (Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚) = (Ï„â‚â‚ âˆ§: Ï„â‚‚â‚) âŸ¨â†’âŸ© (Ï„â‚â‚‚ âˆ¨: Ï„â‚‚â‚‚)
    Rec rÏ„â‚ âˆ¨: Rec rÏ„â‚‚ = TODO
      where TODO = âŠ¥
    âŠ¥ âˆ¨: Ï„ = âŠ¥
    Ï„ âˆ¨: âŠ¥ = âŠ¥
    âŸ¨ğ”¹âŸ© âˆ¨: _ = âŠ¥
    _ âˆ¨: âŸ¨ğ”¹âŸ© = âŠ¥
    (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) âˆ¨: _ = âŠ¥
    _ âˆ¨: (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = âŠ¥

    _âˆ§:_ : type â†’ type â†’ type
    âŸ¨ğ”¹âŸ© âˆ§: âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚) âˆ§: (Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚) = (Ï„â‚â‚ âˆ¨: Ï„â‚‚â‚) âŸ¨â†’âŸ© (Ï„â‚â‚‚ âˆ§: Ï„â‚‚â‚‚)
    Rec rÏ„â‚ âˆ§: Rec rÏ„â‚‚ = TODO
      where TODO = âŠ¥
    âŠ¥ âˆ§: Ï„ = âŠ¥
    Ï„ âˆ§: âŠ¥ = âŠ¥
    âŸ¨ğ”¹âŸ© âˆ§: _ = âŠ¥
    _ âˆ§: âŸ¨ğ”¹âŸ© = âŠ¥
    (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) âˆ§: _ = âŠ¥
    _ âˆ§: (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = âŠ¥
  
  -- terms

  data context : Set where
    [] : context
    _âˆ·_ : type â†’ context â†’ context
  
  data _âˆˆ_ : type â†’ context â†’ Set where
    Zero : âˆ€ {Î“ Ï„} â†’ Ï„ âˆˆ Ï„ âˆ· Î“
    Suc : âˆ€ {Î“ Ï„â‚ Ï„â‚‚} â†’ Ï„â‚ âˆˆ Î“ â†’ Ï„â‚ âˆˆ Ï„â‚‚ âˆ· Î“
  
  data _â¦‚_âˆˆ_ : label â†’ type â†’ rec-type â†’ Set where
    Zero : âˆ€ {l Ï„ rÏ„} â†’ l â¦‚ Ï„ âˆˆ (l â¦‚ Ï„ âˆ· rÏ„)
    Suc : âˆ€ {lâ‚ lâ‚‚ Ï„â‚ Ï„â‚‚ rÏ„} â†’ lâ‚ â¦‚ Ï„â‚ âˆˆ rÏ„ â†’ lâ‚ â¦‚ Ï„â‚ âˆˆ (lâ‚‚ â¦‚ Ï„â‚‚ âˆ· rÏ„)

  mutual
    data _âŠ¢_ : context â†’ type â†’ Set where
      Bool : âˆ€ {Î“} â†’ ğ”¹ â†’ Î“ âŠ¢ âŸ¨ğ”¹âŸ©
      âŸ¨ifâŸ©_âŸ¨thenâŸ©_âŸ¨elseâŸ©_â€–_ : âˆ€ {Î“ Ï„â‚ Ï„â‚‚ Ï„â‚ƒ}
        â†’ Î“ âŠ¢ Ï„â‚
        â†’ Î“ âŠ¢ Ï„â‚‚
        â†’ Î“ âŠ¢ Ï„â‚ƒ
        â†’ Ï„â‚ <: âŸ¨ğ”¹âŸ©
        â†’ Î“ âŠ¢ Ï„â‚‚ âˆ¨: Ï„â‚ƒ
      Var : âˆ€ {Î“ Ï„}
        â†’ Ï„ âˆˆ Î“
        â†’ Î“ âŠ¢ Ï„
      âŸ¨Î»âŸ© : âˆ€ {Î“ Ï„â‚ Ï„â‚‚}
        â†’ Ï„â‚ âˆ· Î“ âŠ¢ Ï„â‚‚
        â†’ Î“ âŠ¢ (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚)
      _âŸ¨â‹…âŸ©_â€–_ : âˆ€ {Î“ Ï„â‚ Ï„â‚‚}
        â†’ Î“ âŠ¢ Ï„â‚
        â†’ Î“ âŠ¢ Ï„â‚‚
        â†’ Ï„â‚‚ <: domáµ— Ï„â‚
        â†’ Î“ âŠ¢ codáµ— Ï„â‚
      Rec : âˆ€ {Î“ rÏ„}
        â†’ Î“ âŠ¢* rÏ„
        â†’ Î“ âŠ¢ Rec rÏ„
      Proj : âˆ€ {Î“ l Ï„ rÏ„}
        â†’ l â¦‚ Ï„ âˆˆ rÏ„
        â†’ Î“ âŠ¢* rÏ„
        â†’ Î“ âŠ¢ Ï„
      _â¦‚â¦‚_ : âˆ€ {Î“ Ï„â‚ Ï„â‚‚}
        â†’ Î“ âŠ¢ Ï„â‚
        â†’ Ï„â‚ <: Ï„â‚‚
        â†’ Î“ âŠ¢ Ï„â‚‚
    data _âŠ¢*_ : context â†’ rec-type â†’ Set where
      [] : âˆ€ {Î“} â†’ Î“ âŠ¢* []
      _â‰”_âˆ·_ : âˆ€ {Î“ Ï„ rÏ„} (l : fin L)
        â†’ Î“ âŠ¢ Ï„
        â†’ Î“ âŠ¢* rÏ„
        â†’ Î“ âŠ¢* (l â¦‚ Ï„ âˆ· rÏ„)

  --==========--
  -- Abstract --
  --==========--

  mutual
    data typeâ™¯ : Set where
      âŠ¥ : typeâ™¯
      âŠ¤ : typeâ™¯
      âŸ¨ğ”¹âŸ© : typeâ™¯
      _âŸ¨â†’âŸ©_ : typeâ™¯ â†’ typeâ™¯ â†’ typeâ™¯
      Rec : rec-typeâ™¯ â†’ typeâ™¯
    data rec-typeâ™¯ : Set where
      [] : rec-typeâ™¯
      _â¦‚_âˆ·_ : label â†’ typeâ™¯ â†’ rec-typeâ™¯ â†’ rec-typeâ™¯

  -- partial order
  -- (arrows are monotonic)

  mutual
    data _âŠ´â™¯_ : typeâ™¯ â†’ typeâ™¯ â†’ Set where
      âŠ¥ : âˆ€ {Ï„} â†’ âŠ¥ âŠ´â™¯ Ï„
      âŠ¤ : âˆ€ {Ï„} â†’ Ï„ âŠ´â™¯ âŠ¤
      âŸ¨ğ”¹âŸ© : âŸ¨ğ”¹âŸ© âŠ´â™¯ âŸ¨ğ”¹âŸ©
      _âŸ¨â†’âŸ©_ : âˆ€ {Ï„â‚â‚ Ï„â‚‚â‚ Ï„â‚â‚‚ Ï„â‚‚â‚‚}
        â†’ Ï„â‚â‚ âŠ´â™¯ Ï„â‚‚â‚
        â†’ Ï„â‚â‚‚ âŠ´â™¯ Ï„â‚‚â‚‚
        â†’ (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚â‚‚) âŠ´â™¯ (Ï„â‚‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚)
      Rec : âˆ€ {rÏ„â‚ rÏ„â‚‚}
        â†’ rÏ„â‚ âŠ´*â™¯ rÏ„â‚‚
        â†’ Rec rÏ„â‚ âŠ´â™¯ Rec rÏ„â‚‚
    data _âŠ´*â™¯_  : rec-typeâ™¯ â†’ rec-typeâ™¯ â†’ Set where
      [] : [] âŠ´*â™¯ []
      _âˆ·_ : âˆ€ {l Ï„â‚ Ï„â‚‚ rÏ„â‚ rÏ„â‚‚}
        â†’ Ï„â‚ âŠ´â™¯ Ï„â‚‚
        â†’ rÏ„â‚ âŠ´*â™¯ rÏ„â‚‚
        â†’ (l â¦‚ Ï„â‚ âˆ· rÏ„â‚) âŠ´*â™¯ (l â¦‚ Ï„â‚‚ âˆ· rÏ„â‚‚)

  mutual
    xRxâ¸¢âŠ´â™¯â¸£ : reflexive _âŠ´â™¯_
    xRxâ¸¢âŠ´â™¯â¸£ {âŠ¥} = âŠ¥
    xRxâ¸¢âŠ´â™¯â¸£ {âŠ¤} = âŠ¤
    xRxâ¸¢âŠ´â™¯â¸£ {âŸ¨ğ”¹âŸ©} = âŸ¨ğ”¹âŸ©
    xRxâ¸¢âŠ´â™¯â¸£ {Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚} = xRxâ¸¢âŠ´â™¯â¸£ âŸ¨â†’âŸ© xRxâ¸¢âŠ´â™¯â¸£
    xRxâ¸¢âŠ´â™¯â¸£ {Rec rÏ„} = Rec xRxâ¸¢âŠ´*â™¯â¸£

    xRxâ¸¢âŠ´*â™¯â¸£ : reflexive _âŠ´*â™¯_
    xRxâ¸¢âŠ´*â™¯â¸£ {[]} = []
    xRxâ¸¢âŠ´*â™¯â¸£ {l â¦‚ Ï„ âˆ· rÏ„} = xRxâ¸¢âŠ´â™¯â¸£ âˆ· xRxâ¸¢âŠ´*â™¯â¸£

  mutual
    _âŒ¾â¸¢âŠ´â™¯â¸£_ : transitive _âŠ´â™¯_
    _ âŒ¾â¸¢âŠ´â™¯â¸£ âŠ¥ = âŠ¥
    âŠ¤ âŒ¾â¸¢âŠ´â™¯â¸£ _ = âŠ¤
    âŸ¨ğ”¹âŸ© âŒ¾â¸¢âŠ´â™¯â¸£ âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    (âŠ´â‚â‚ âŸ¨â†’âŸ© âŠ´â‚‚â‚) âŒ¾â¸¢âŠ´â™¯â¸£ (âŠ´â‚â‚‚ âŸ¨â†’âŸ© âŠ´â‚‚â‚‚) = (âŠ´â‚â‚ âŒ¾â¸¢âŠ´â™¯â¸£ âŠ´â‚â‚‚) âŸ¨â†’âŸ© (âŠ´â‚‚â‚ âŒ¾â¸¢âŠ´â™¯â¸£ âŠ´â‚‚â‚‚)
    Rec âŠ´*â‚ âŒ¾â¸¢âŠ´â™¯â¸£ Rec âŠ´*â‚‚ = Rec (âŠ´*â‚ âŒ¾â¸¢âŠ´*â™¯â¸£ âŠ´*â‚‚)

    _âŒ¾â¸¢âŠ´*â™¯â¸£_ : transitive _âŠ´*â™¯_
    [] âŒ¾â¸¢âŠ´*â™¯â¸£ [] = []
    (âŠ´â‚ âˆ· âŠ´*â‚) âŒ¾â¸¢âŠ´*â™¯â¸£ (âŠ´â‚‚ âˆ· âŠ´*â‚‚) = (âŠ´â‚ âŒ¾â¸¢âŠ´â™¯â¸£ âŠ´â‚‚) âˆ· (âŠ´*â‚ âŒ¾â¸¢âŠ´*â™¯â¸£ âŠ´*â‚‚)

  instance
    Reflexive[âŠ´â™¯] : Reflexive _âŠ´â™¯_
    Reflexive[âŠ´â™¯] = record { xRx = xRxâ¸¢âŠ´â™¯â¸£ }
    Reflexive[âŠ´â™¯*] : Reflexive _âŠ´*â™¯_
    Reflexive[âŠ´â™¯*] = record { xRx = xRxâ¸¢âŠ´*â™¯â¸£ }
    Transitive[âŠ´â™¯] : Transitive _âŠ´â™¯_
    Transitive[âŠ´â™¯] = record { _âŒ¾_ = _âŒ¾â¸¢âŠ´â™¯â¸£_ }
    Transitive[âŠ´â™¯*] : Transitive _âŠ´*â™¯_
    Transitive[âŠ´â™¯*] = record { _âŒ¾_ = _âŒ¾â¸¢âŠ´*â™¯â¸£_ }
    PreOrder[typeâ™¯] : PreOrder zeroË¡ typeâ™¯
    PreOrder[typeâ™¯] = record { _âŠ´_ = _âŠ´â™¯_ }
    PreOrder[rec-typeâ™¯] : PreOrder zeroË¡ rec-typeâ™¯
    PreOrder[rec-typeâ™¯] = record { _âŠ´_ = _âŠ´*â™¯_ }

  -- subtype order
  -- (arrows are co/contra-variant)

  mutual
    data _<:â™¯_ : typeâ™¯ â†’ typeâ™¯ â†’ Set where
      âŠ¤<:Ï„ : âˆ€ {Ï„} â†’ âŠ¤ <:â™¯ Ï„
      Ï„<:âŠ¤ : âˆ€ {Ï„} â†’ Ï„ <:â™¯  âŠ¤
      âŸ¨ğ”¹âŸ© : âŸ¨ğ”¹âŸ© <:â™¯ âŸ¨ğ”¹âŸ©
      _âŸ¨â†’âŸ©_ : âˆ€ {Ï„â‚â‚ Ï„â‚‚â‚ Ï„â‚â‚‚ Ï„â‚‚â‚‚}
        â†’ Ï„â‚â‚‚ <:â™¯ Ï„â‚â‚
        â†’ Ï„â‚‚â‚ <:â™¯ Ï„â‚‚â‚‚
        â†’ (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚) <:â™¯ (Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚)
      Rec : âˆ€ {rÏ„â‚ rÏ„â‚‚}
        â†’ rÏ„â‚ <:â™¯* rÏ„â‚‚
        â†’ Rec rÏ„â‚ <:â™¯ Rec rÏ„â‚‚
    data _<:â™¯*_ : rec-typeâ™¯ â†’ rec-typeâ™¯ â†’ Set where
      [] : [] <:â™¯* []
      <[_] : âˆ€ {l Ï„ rÏ„â‚ rÏ„â‚‚}
        â†’ rÏ„â‚ <:â™¯* rÏ„â‚‚
        â†’ (l â¦‚ Ï„ âˆ· rÏ„â‚) <:â™¯* rÏ„â‚‚
      _âˆ·_ : âˆ€ {l Ï„â‚ Ï„â‚‚ rÏ„â‚ rÏ„â‚‚}
        â†’ Ï„â‚ <:â™¯ Ï„â‚‚
        â†’ rÏ„â‚ <:â™¯* rÏ„â‚‚
        â†’ (l â¦‚ Ï„â‚ âˆ· rÏ„â‚) <:â™¯* (l â¦‚ Ï„â‚‚ âˆ· rÏ„â‚‚)
      
  -- dom and cod

  domâ™¯ : typeâ™¯ â†’ typeâ™¯
  domâ™¯ âŠ¤ = âŠ¤
  domâ™¯ (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = Ï„â‚
  domâ™¯ _ = âŠ¥

  monotonic[domâ™¯] : proper (_âŠ´_ â‡‰ _âŠ´_) domâ™¯
  monotonic[domâ™¯] âŠ¥ = âŠ¥
  monotonic[domâ™¯] âŠ¤ = âŠ¤
  monotonic[domâ™¯] âŸ¨ğ”¹âŸ© = âŠ¥
  monotonic[domâ™¯] (âŠ´â‚ âŸ¨â†’âŸ© âŠ´â‚‚) = âŠ´â‚
  monotonic[domâ™¯] (Rec _) = âŠ¥

  codâ™¯ : typeâ™¯ â†’ typeâ™¯
  codâ™¯ âŠ¤ = âŠ¤
  codâ™¯ (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = Ï„â‚‚
  codâ™¯ _ = âŠ¥

  monotonic[codâ™¯] : proper (_âŠ´_ â‡‰ _âŠ´_) codâ™¯
  monotonic[codâ™¯] âŠ¥ = âŠ¥
  monotonic[codâ™¯] âŠ¤ = âŠ¤
  monotonic[codâ™¯] âŸ¨ğ”¹âŸ© = âŠ¥
  monotonic[codâ™¯] (âŠ´â‚ âŸ¨â†’âŸ© âŠ´â‚‚) = âŠ´â‚‚
  monotonic[codâ™¯] (Rec _) = âŠ¥

  -- subtype join and meet

  mutual
    _âˆ¨:â™¯_ : typeâ™¯ â†’ typeâ™¯ â†’ typeâ™¯
    âŠ¥ âˆ¨:â™¯ Ï„ = âŠ¥
    Ï„ âˆ¨:â™¯ âŠ¥ = âŠ¥
    âŠ¤ âˆ¨:â™¯ _ = âŠ¤
    _ âˆ¨:â™¯ âŠ¤ = âŠ¤
    âŸ¨ğ”¹âŸ© âˆ¨:â™¯ âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚) âˆ¨:â™¯ (Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚) = (Ï„â‚â‚ âˆ§:â™¯ Ï„â‚‚â‚) âŸ¨â†’âŸ© (Ï„â‚â‚‚ âˆ¨:â™¯ Ï„â‚‚â‚‚)
    Rec rÏ„â‚ âˆ¨:â™¯ Rec rÏ„â‚‚ = TODO
      where TODO = âŠ¥
    âŸ¨ğ”¹âŸ© âˆ¨:â™¯ _ = âŠ¥
    _ âˆ¨:â™¯ âŸ¨ğ”¹âŸ© = âŠ¥
    (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) âˆ¨:â™¯ _ = âŠ¥
    _ âˆ¨:â™¯ (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = âŠ¥

    _âˆ§:â™¯_ : typeâ™¯ â†’ typeâ™¯ â†’ typeâ™¯
    âŠ¥ âˆ§:â™¯ Ï„ = âŠ¥
    Ï„ âˆ§:â™¯ âŠ¥ = âŠ¥
    âŠ¤ âˆ§:â™¯ _ = âŠ¤
    _ âˆ§:â™¯ âŠ¤ = âŠ¤
    âŸ¨ğ”¹âŸ© âˆ§:â™¯ âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚) âˆ§:â™¯ (Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚) = (Ï„â‚â‚ âˆ¨:â™¯ Ï„â‚‚â‚) âŸ¨â†’âŸ© (Ï„â‚â‚‚ âˆ§:â™¯ Ï„â‚‚â‚‚)
    Rec rÏ„â‚ âˆ§:â™¯ Rec rÏ„â‚‚ = TODO
      where TODO = âŠ¥
    âŸ¨ğ”¹âŸ© âˆ§:â™¯ _ = âŠ¥
    _ âˆ§:â™¯ âŸ¨ğ”¹âŸ© = âŠ¥
    (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) âˆ§:â™¯ _ = âŠ¥
    _ âˆ§:â™¯ (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = âŠ¥

  _âŠ“_ : typeâ™¯ â†’ typeâ™¯ â†’ typeâ™¯
  âŠ¤ âŠ“ Ï„ = Ï„
  Ï„ âŠ“ âŠ¤ = Ï„
  âŸ¨ğ”¹âŸ© âŠ“ âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
  (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚) âŠ“ (Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚) = (Ï„â‚â‚ âŠ“ Ï„â‚‚â‚) âŸ¨â†’âŸ© (Ï„â‚â‚‚ âŠ“ Ï„â‚‚â‚‚)
  Rec rÏ„â‚ âŠ“ Rec rÏ„â‚‚ = {!!}
  _ âŠ“ _ = âŠ¥
  
  data contextâ™¯ : Set where
    [] : contextâ™¯
    _âˆ·_ : typeâ™¯ â†’ contextâ™¯ â†’ contextâ™¯
  
  data _âˆˆâ™¯_ : typeâ™¯ â†’ contextâ™¯ â†’ Set where
    Zero : âˆ€ {Î“ Ï„} â†’ Ï„ âˆˆâ™¯ Ï„ âˆ· Î“
    Suc : âˆ€ {Î“ Ï„â‚ Ï„â‚‚} â†’ Ï„â‚ âˆˆâ™¯ Î“ â†’ Ï„â‚ âˆˆâ™¯ Ï„â‚‚ âˆ· Î“
  
  data _â¦‚_âˆˆâ™¯_ : label â†’ typeâ™¯ â†’ rec-typeâ™¯ â†’ Set where
    Zero : âˆ€ {l Ï„ rÏ„} â†’ l â¦‚ Ï„ âˆˆâ™¯ (l â¦‚ Ï„ âˆ· rÏ„)
    Suc : âˆ€ {lâ‚ lâ‚‚ Ï„â‚ Ï„â‚‚ rÏ„} â†’ lâ‚ â¦‚ Ï„â‚ âˆˆâ™¯ rÏ„ â†’ lâ‚ â¦‚ Ï„â‚ âˆˆâ™¯ (lâ‚‚ â¦‚ Ï„â‚‚ âˆ· rÏ„)

  mutual
    data _âŠ¢â™¯_ : contextâ™¯ â†’ typeâ™¯ â†’ Set where
      Bool : âˆ€ {Î“} â†’ ğ”¹ â†’ Î“ âŠ¢â™¯ âŸ¨ğ”¹âŸ©
      âŸ¨ifâŸ©_âŸ¨thenâŸ©_âŸ¨elseâŸ©_â€–_ : âˆ€ {Î“ Ï„â‚ Ï„â‚‚ Ï„â‚ƒ}
        â†’ Î“ âŠ¢â™¯ Ï„â‚
        â†’ Î“ âŠ¢â™¯ Ï„â‚‚
        â†’ Î“ âŠ¢â™¯ Ï„â‚ƒ
        â†’ Ï„â‚ <:â™¯ âŸ¨ğ”¹âŸ©
        â†’ Î“ âŠ¢â™¯ Ï„â‚‚ âˆ¨:â™¯ Ï„â‚ƒ
      Var : âˆ€ {Î“ Ï„}
        â†’ Ï„ âˆˆâ™¯ Î“
        â†’ Î“ âŠ¢â™¯ Ï„
      âŸ¨Î»âŸ© : âˆ€ {Î“ Ï„â‚ Ï„â‚‚}
        â†’ Ï„â‚ âˆ· Î“ âŠ¢â™¯ Ï„â‚‚
        â†’ Î“ âŠ¢â™¯ (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚)
      _âŸ¨â‹…âŸ©_â€–_,_ : âˆ€ {Î“ Ï„â‚ Ï„â‚‚ Ï„â‚â‚ Ï„â‚‚â‚}
        â†’ Î“ âŠ¢â™¯ Ï„â‚
        â†’ Î“ âŠ¢â™¯ Ï„â‚‚
        â†’ Ï„â‚ <:â™¯ (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚)
        â†’ Ï„â‚‚ <:â™¯ Ï„â‚â‚
        â†’ Î“ âŠ¢â™¯ Ï„â‚‚â‚
      Rec : âˆ€ {Î“ rÏ„}
        â†’ Î“ âŠ¢*â™¯ rÏ„
        â†’ Î“ âŠ¢â™¯ Rec rÏ„
      Proj : âˆ€ {Î“ l Ï„ rÏ„}
        â†’ Î“ âŠ¢*â™¯ rÏ„
        â†’ l â¦‚ Ï„ âˆˆâ™¯ rÏ„
        â†’ Î“ âŠ¢â™¯ Ï„
      _â¦‚â¦‚_ : âˆ€ {Î“ Ï„â‚ Ï„â‚‚}
        â†’ Î“ âŠ¢â™¯ Ï„â‚
        â†’ Ï„â‚ <:â™¯ Ï„â‚‚
        â†’ Î“ âŠ¢â™¯ Ï„â‚‚
    data _âŠ¢*â™¯_ : contextâ™¯ â†’ rec-typeâ™¯ â†’ Set where
      [] : âˆ€ {Î“} â†’ Î“ âŠ¢*â™¯ []
      _â‰”_âˆ·_ : âˆ€ {Î“ Ï„ rÏ„} (l : fin L)
        â†’ Î“ âŠ¢â™¯ Ï„
        â†’ Î“ âŠ¢*â™¯ rÏ„
        â†’ Î“ âŠ¢*â™¯ (l â¦‚ Ï„ âˆ· rÏ„)

  --========--
  -- Proofs --
  --========--

  -----------------------
  -- Galois Connection --
  -----------------------

  mutual
    data _âˆˆÎ³[_] : type â†’ typeâ™¯ â†’ Set where
      âŠ¤ : âˆ€ {Ï„} â†’ Ï„ âˆˆÎ³[ âŠ¤ ]
      âŠ¥ : âˆ€ {Ï„} â†’ âŠ¥ âˆˆÎ³[ Ï„ ]
      âŸ¨ğ”¹âŸ© : âŸ¨ğ”¹âŸ© âˆˆÎ³[ âŸ¨ğ”¹âŸ© ]
      _âŸ¨â†’âŸ©_ : âˆ€ {Ï„â‚ Ï„â‚‚ Ï„â‚â™¯ Ï„â‚‚â™¯}
        â†’ Ï„â‚ âˆˆÎ³[ Ï„â‚â™¯ ]
        â†’ Ï„â‚‚ âˆˆÎ³[ Ï„â‚‚â™¯ ]
        â†’ (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) âˆˆÎ³[ Ï„â‚â™¯ âŸ¨â†’âŸ© Ï„â‚‚â™¯ ]
      Rec : âˆ€ {rÏ„ rÏ„â™¯} â†’ rÏ„ âˆˆÎ³*[ rÏ„â™¯ ] â†’ Rec rÏ„ âˆˆÎ³[ Rec rÏ„â™¯ ]
    data _âˆˆÎ³*[_] : rec-type â†’ rec-typeâ™¯ â†’ Set where
      [] : [] âˆˆÎ³*[ [] ]
      _âˆ·_ : âˆ€ {l Ï„ Ï„â™¯ rÏ„ rÏ„â™¯}
        â†’ Ï„ âˆˆÎ³[ Ï„â™¯ ]
        â†’ rÏ„ âˆˆÎ³*[ rÏ„â™¯ ]
        â†’ (l â¦‚ Ï„ âˆ· rÏ„) âˆˆÎ³*[ l â¦‚ Ï„â™¯ âˆ· rÏ„â™¯ ]

  mutual
    monotonic[Î³] : proper (flip _âŠ´_ â‡‰ _âŠ´_ â‡‰ [â†’]) _âˆˆÎ³[_]
    monotonic[Î³] âŸ¨ğ”¹âŸ© âŸ¨ğ”¹âŸ© âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    monotonic[Î³] (âŠ´â‚â‚ âŸ¨â†’âŸ© âŠ´â‚‚â‚) (âŠ´â‚â‚‚ âŸ¨â†’âŸ© âŠ´â‚‚â‚‚) (âˆˆâ‚ âŸ¨â†’âŸ© âˆˆâ‚‚) = monotonic[Î³] âŠ´â‚â‚ âŠ´â‚â‚‚ âˆˆâ‚ âŸ¨â†’âŸ© monotonic[Î³] âŠ´â‚‚â‚ âŠ´â‚‚â‚‚ âˆˆâ‚‚
    monotonic[Î³] (Rec âŠ´*â‚) (Rec âŠ´*â‚‚) (Rec âˆˆ*â‚) = Rec (monotonic[Î³*] âŠ´*â‚ âŠ´*â‚‚ âˆˆ*â‚)
    monotonic[Î³] _ âŠ¤ _ = âŠ¤
    monotonic[Î³] âŠ¥ _ _ = âŠ¥

    monotonic[Î³*] : proper (flip _âŠ´_ â‡‰ _âŠ´_ â‡‰ [â†’]) _âˆˆÎ³*[_]
    monotonic[Î³*] [] [] [] = []
    monotonic[Î³*] (âŠ´â‚ âˆ· âŠ´*â‚) (âŠ´â‚‚ âˆ· âŠ´*â‚‚) (âˆˆâ‚ âˆ· âˆˆ*â‚) = (monotonic[Î³] âŠ´â‚ âŠ´â‚‚ âˆˆâ‚) âˆ· (monotonic[Î³*] âŠ´*â‚ âŠ´*â‚‚ âˆˆ*â‚)

  mutual
    Î· : type â†’ typeâ™¯
    Î· âŠ¥ = âŠ¥
    Î· âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    Î· (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = Î· Ï„â‚ âŸ¨â†’âŸ© Î· Ï„â‚‚
    Î· (Rec rÏ„) = Rec (Î·* rÏ„)

    Î·* : rec-type â†’ rec-typeâ™¯
    Î·* [] = []
    Î·* (l â¦‚ Ï„ âˆ· rÏ„) = l â¦‚ Î· Ï„ âˆ· Î·* rÏ„

  mutual
    monotonic[Î·] : proper (_âŠ´_ â‡‰ _âŠ´_) Î·
    monotonic[Î·] âŠ¥ = âŠ¥
    monotonic[Î·] âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    monotonic[Î·] (âŠ´â‚ âŸ¨â†’âŸ© âŠ´â‚‚) = monotonic[Î·] âŠ´â‚ âŸ¨â†’âŸ© monotonic[Î·] âŠ´â‚‚
    monotonic[Î·] (Rec âŠ´â‚) = Rec (monotonic[Î·*] âŠ´â‚)

    monotonic[Î·*] : proper (_âŠ´_ â‡‰ _âŠ´_) Î·*
    monotonic[Î·*] [] = []
    monotonic[Î·*] (âŠ´â‚ âˆ· âˆˆâ‚) = monotonic[Î·] âŠ´â‚ âˆ· monotonic[Î·*] âˆˆâ‚

  mutual
    sound[Î·Î³] : âˆ€ Ï„ â†’ Ï„ âˆˆÎ³[ Î· Ï„ ]
    sound[Î·Î³] âŠ¥ = âŠ¥
    sound[Î·Î³] âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    sound[Î·Î³] (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = sound[Î·Î³] Ï„â‚ âŸ¨â†’âŸ© sound[Î·Î³] Ï„â‚‚
    sound[Î·Î³] (Rec rÏ„) = Rec (sound[Î·*] rÏ„)

    sound[Î·*] : âˆ€ rÏ„ â†’ rÏ„ âˆˆÎ³*[ Î·* rÏ„ ]
    sound[Î·*] [] = []
    sound[Î·*] (l â¦‚ Ï„ âˆ· rÏ„) = sound[Î·Î³] Ï„ âˆ· sound[Î·*] rÏ„

  mutual
    complete[Î·Î³] : âˆ€ {Ï„ Ï„â™¯} â†’ Ï„ âˆˆÎ³[ Ï„â™¯ ] â†’ Î· Ï„ âŠ´ Ï„â™¯
    complete[Î·Î³] âŠ¤ = âŠ¤
    complete[Î·Î³] âŠ¥ = âŠ¥
    complete[Î·Î³] âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    complete[Î·Î³] (âˆˆâ‚ âŸ¨â†’âŸ© âˆˆâ‚‚) = complete[Î·Î³] âˆˆâ‚ âŸ¨â†’âŸ© complete[Î·Î³] âˆˆâ‚‚
    complete[Î·Î³] (Rec âˆˆ*â‚) = Rec (complete[Î·Î³*] âˆˆ*â‚)

    complete[Î·Î³*] : âˆ€ {rÏ„ rÏ„â™¯} â†’ rÏ„ âˆˆÎ³*[ rÏ„â™¯ ] â†’ Î·* rÏ„ âŠ´ rÏ„â™¯
    complete[Î·Î³*] [] = []
    complete[Î·Î³*] (âˆˆâ‚ âˆ· âˆˆ*â‚) = complete[Î·Î³] âˆˆâ‚ âˆ· complete[Î·Î³*] âˆˆ*â‚

  --------------------------
  -- Abstract dom and cod --
  --------------------------

  sound[domâ™¯] : âˆ€ Ï„ â†’ Î· (domáµ— Ï„) âŠ´ domâ™¯ (Î· Ï„)
  sound[domâ™¯] âŠ¥ = âŠ¥
  sound[domâ™¯] âŸ¨ğ”¹âŸ© = âŠ¥
  sound[domâ™¯] (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = xRx
  sound[domâ™¯] (Rec _) = âŠ¥

  sound[codâ™¯] : âˆ€ Ï„ â†’ Î· (codáµ— Ï„) âŠ´ codâ™¯ (Î· Ï„)
  sound[codâ™¯] âŠ¥ = âŠ¥
  sound[codâ™¯] âŸ¨ğ”¹âŸ© = âŠ¥
  sound[codâ™¯] (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = xRx
  sound[codâ™¯] (Rec _) = âŠ¥

  -------------------------------
  -- Abstract <: meet and join --
  -------------------------------

  -- TODO

  --==========--
  -- Dynamics --
  --==========--
   
  data _âŠ´â¸¢Ï†â¸£_ : contextâ™¯ â†’ contextâ™¯ â†’ Set where
    [] : âˆ€ {Î“} â†’ [] âŠ´â¸¢Ï†â¸£ Î“ 
    _âˆ·_ : âˆ€ {Î“â‚ Î“â‚‚ Ï„} â†’ Ï„ âˆˆâ™¯ Î“â‚‚ â†’ Î“â‚ âŠ´â¸¢Ï†â¸£ Î“â‚‚ â†’ (Ï„ âˆ· Î“â‚) âŠ´â¸¢Ï†â¸£ Î“â‚‚

  introâ¸¢Ï†â¸£ : âˆ€ {Ï„ Î“â‚ Î“â‚‚} â†’ Î“â‚ âŠ´â¸¢Ï†â¸£ Î“â‚‚ â†’ Î“â‚ âŠ´â¸¢Ï†â¸£ (Ï„ âˆ· Î“â‚‚)
  introâ¸¢Ï†â¸£ [] = []
  introâ¸¢Ï†â¸£ (x âˆ· Ï†) = Suc x âˆ· introâ¸¢Ï†â¸£ Ï†

  renameâ¸¢varâ¸£ : âˆ€ {Ï„ Î“â‚ Î“â‚‚} â†’ Î“â‚ âŠ´â¸¢Ï†â¸£ Î“â‚‚ â†’ Ï„ âˆˆâ™¯ Î“â‚ â†’ Ï„ âˆˆâ™¯ Î“â‚‚
  renameâ¸¢varâ¸£ (x âˆ· Ï†) Zero = x
  renameâ¸¢varâ¸£ (xâ‚‚ âˆ· Ï†) (Suc xâ‚) = renameâ¸¢varâ¸£ Ï† xâ‚

  xRx[âŠ´â¸¢Ï†â¸£] : reflexive _âŠ´â¸¢Ï†â¸£_
  xRx[âŠ´â¸¢Ï†â¸£] {[]} = []
  xRx[âŠ´â¸¢Ï†â¸£] {Ï„ âˆ· Î“} = Zero âˆ· introâ¸¢Ï†â¸£ xRx[âŠ´â¸¢Ï†â¸£]

  _âŒ¾[âŠ´â¸¢Ï†â¸£]_ : transitive _âŠ´â¸¢Ï†â¸£_
  _ âŒ¾[âŠ´â¸¢Ï†â¸£] [] = []
  (xâ‚‚ âˆ· Ï†â‚‚) âŒ¾[âŠ´â¸¢Ï†â¸£] (Zero âˆ· Ï†â‚) = xâ‚‚ âˆ· ((xâ‚‚ âˆ· Ï†â‚‚) âŒ¾[âŠ´â¸¢Ï†â¸£] Ï†â‚)
  (xâ‚‚ âˆ· Ï†â‚‚) âŒ¾[âŠ´â¸¢Ï†â¸£] (Suc xâ‚ âˆ· Ï†â‚) = renameâ¸¢varâ¸£ Ï†â‚‚ xâ‚ âˆ· ((xâ‚‚ âˆ· Ï†â‚‚) âŒ¾[âŠ´â¸¢Ï†â¸£] Ï†â‚)

  instance
    Reflexive[âŠ´â¸¢Ï†â¸£] : Reflexive _âŠ´â¸¢Ï†â¸£_
    Reflexive[âŠ´â¸¢Ï†â¸£] = record { xRx = xRx[âŠ´â¸¢Ï†â¸£] }
    Transitive[âŠ´â¸¢Ï†â¸£] : Transitive _âŠ´â¸¢Ï†â¸£_
    Transitive[âŠ´â¸¢Ï†â¸£] = record { _âŒ¾_ = _âŒ¾[âŠ´â¸¢Ï†â¸£]_ }

  renameâ¸¢termâ¸£ : âˆ€ {Ï„ Î“â‚ Î“â‚‚} â†’ Î“â‚ âŠ´â¸¢Ï†â¸£ Î“â‚‚ â†’ Î“â‚ âŠ¢â™¯ Ï„ â†’ Î“â‚‚ âŠ¢â™¯ Ï„
  renameâ¸¢termâ¸£ Ï† (Bool b) = Bool b
  renameâ¸¢termâ¸£ Ï† (âŸ¨ifâŸ© eâ‚ âŸ¨thenâŸ© eâ‚‚ âŸ¨elseâŸ© eâ‚ƒ â€– Îµ) = âŸ¨ifâŸ© renameâ¸¢termâ¸£ Ï† eâ‚ âŸ¨thenâŸ© renameâ¸¢termâ¸£ Ï† eâ‚‚ âŸ¨elseâŸ© renameâ¸¢termâ¸£ Ï† eâ‚ƒ â€– Îµ
  renameâ¸¢termâ¸£ Ï† (Var x) = Var (renameâ¸¢varâ¸£ Ï† x)
  renameâ¸¢termâ¸£ Ï† (âŸ¨Î»âŸ© e) = âŸ¨Î»âŸ© (renameâ¸¢termâ¸£ (Zero âˆ· introâ¸¢Ï†â¸£ Ï†) e)
  renameâ¸¢termâ¸£ Ï† (eâ‚ âŸ¨â‹…âŸ© eâ‚‚ â€– Îµâ‚ , Îµâ‚‚) = renameâ¸¢termâ¸£ Ï† eâ‚ âŸ¨â‹…âŸ© renameâ¸¢termâ¸£ Ï† eâ‚‚ â€– Îµâ‚ , Îµâ‚‚
  renameâ¸¢termâ¸£ Ï† (Rec e) = {!!}
  renameâ¸¢termâ¸£ Ï† (Proj e Îµ) = Proj {!!} Îµ
  renameâ¸¢termâ¸£ Ï† (e â¦‚â¦‚ Îµ) = renameâ¸¢termâ¸£ Ï† e â¦‚â¦‚ Îµ

  swapâ¸¢Ï†â¸£ : âˆ€ {Î“ Ï„â‚ Ï„â‚‚} â†’ (Ï„â‚ âˆ· (Ï„â‚‚ âˆ· Î“)) âŠ´â¸¢Ï†â¸£ (Ï„â‚‚ âˆ· (Ï„â‚ âˆ· Î“))
  swapâ¸¢Ï†â¸£ = (Suc Zero) âˆ· (Zero âˆ· (introâ¸¢Ï†â¸£ (introâ¸¢Ï†â¸£ xRx)))

  cutâ¸¢varâ¸£ : âˆ€ {Î“â‚ Î“â‚‚ Ï„â‚ Ï„â‚‚}
    â†’ Î“â‚‚ âŠ´â¸¢Ï†â¸£ (Ï„â‚ âˆ· Î“â‚)
    â†’ Ï„â‚‚ âˆˆâ™¯ Î“â‚‚
    â†’ Î“â‚ âŠ¢â™¯ Ï„â‚
    â†’ Î“â‚ âŠ¢â™¯ Ï„â‚‚
  cutâ¸¢varâ¸£ (Zero âˆ· Ï†) Zero esub = esub
  cutâ¸¢varâ¸£ (Suc xâ‚‚ âˆ· Ï†) Zero esub = Var xâ‚‚
  cutâ¸¢varâ¸£ (xâ‚‚ âˆ· Ï†) (Suc xâ‚) esub = cutâ¸¢varâ¸£ Ï† xâ‚ esub
  
  cutsub : âˆ€ {Î“â‚ Î“â‚‚ Ï„â‚ Ï„â‚‚}
    â†’ Î“â‚‚ âŠ´â¸¢Ï†â¸£ (Ï„â‚ âˆ· Î“â‚)
    â†’ Î“â‚‚ âŠ¢â™¯ Ï„â‚‚
    â†’ Î“â‚ âŠ¢â™¯ Ï„â‚
    â†’ Î“â‚ âŠ¢â™¯ Ï„â‚‚
  cutsub Ï† (Bool b) esub = Bool b
  cutsub Ï† (âŸ¨ifâŸ© eâ‚ âŸ¨thenâŸ© eâ‚‚ âŸ¨elseâŸ© eâ‚ƒ â€– Îµ) esub = âŸ¨ifâŸ© cutsub Ï† eâ‚ esub âŸ¨thenâŸ© cutsub Ï† eâ‚‚ esub âŸ¨elseâŸ© cutsub Ï† eâ‚ƒ esub â€– Îµ
  cutsub Ï† (Var x) esub = cutâ¸¢varâ¸£ Ï† x esub
  cutsub Ï† (âŸ¨Î»âŸ© e) esub = âŸ¨Î»âŸ© (cutsub (swapâ¸¢Ï†â¸£ âŒ¾ Zero âˆ· introâ¸¢Ï†â¸£ Ï†) e (renameâ¸¢termâ¸£ (introâ¸¢Ï†â¸£ xRx) esub))
  cutsub Ï† (eâ‚ âŸ¨â‹…âŸ© eâ‚‚ â€– Îµâ‚ , Îµâ‚‚) esub = cutsub Ï† eâ‚ esub âŸ¨â‹…âŸ© cutsub Ï† eâ‚‚ esub â€– Îµâ‚ , Îµâ‚‚
  cutsub Ï† (Rec e) esub = {!!}
  cutsub Ï† (Proj e Îµ) esub = {!!}
  cutsub Ï† (e â¦‚â¦‚ Îµ) esub = cutsub Ï† e esub â¦‚â¦‚ Îµ

  cut : âˆ€ {Î“ Ï„â‚ Ï„â‚‚}
    â†’ Ï„â‚ âˆ· Î“ âŠ¢â™¯ Ï„â‚‚
    â†’ Î“ âŠ¢â™¯ Ï„â‚
    â†’ Î“ âŠ¢â™¯ Ï„â‚‚
  cut e esub = cutsub xRx e esub
