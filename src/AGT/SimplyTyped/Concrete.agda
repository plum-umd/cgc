module AGT.SimplyTyped.Concrete where

open import Prelude
open import POSet

infixr  4 _âŸ¨â†’âŸ©_
infix   8 _âŠ¢_
infix   8 _âˆˆ_
infix   8 _âŠ´áµ—_
infixr  9 _âŒ¾â¸¢âŠ´áµ—â¸£_
infixr 10 _âˆ·_

------------
-- [type] --
------------

data type : Set where
  âŠ¥ : type
  âŸ¨ğ”¹âŸ© : type
  _âŸ¨â†’âŸ©_ : type â†’ type â†’ type

---------------------
-- order on [type] --
---------------------

data _âŠ´áµ—_ : type â†’ type â†’ Set where
  âŠ¥ : âˆ€ {Ï„} â†’ âŠ¥ âŠ´áµ— Ï„
  âŸ¨ğ”¹âŸ© : âŸ¨ğ”¹âŸ© âŠ´áµ— âŸ¨ğ”¹âŸ©
  _âŸ¨â†’âŸ©_ : âˆ€ {Ï„â‚â‚ Ï„â‚‚â‚ Ï„â‚â‚‚ Ï„â‚‚â‚‚} â†’ Ï„â‚â‚ âŠ´áµ— Ï„â‚â‚‚ â†’ Ï„â‚‚â‚ âŠ´áµ— Ï„â‚‚â‚‚ â†’ (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚) âŠ´áµ— (Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚)

xRxâ¸¢âŠ´áµ—â¸£ : reflexive _âŠ´áµ—_
xRxâ¸¢âŠ´áµ—â¸£ {âŠ¥} = âŠ¥
xRxâ¸¢âŠ´áµ—â¸£ {âŸ¨ğ”¹âŸ©} = âŸ¨ğ”¹âŸ©
xRxâ¸¢âŠ´áµ—â¸£ {Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚} = xRxâ¸¢âŠ´áµ—â¸£ âŸ¨â†’âŸ© xRxâ¸¢âŠ´áµ—â¸£

_âŒ¾â¸¢âŠ´áµ—â¸£_ : transitive _âŠ´áµ—_
_ âŒ¾â¸¢âŠ´áµ—â¸£ âŠ¥ = âŠ¥
âŸ¨ğ”¹âŸ© âŒ¾â¸¢âŠ´áµ—â¸£ âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
(Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚) âŒ¾â¸¢âŠ´áµ—â¸£ (Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚) = Ï„â‚â‚ âŒ¾â¸¢âŠ´áµ—â¸£ Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚ âŒ¾â¸¢âŠ´áµ—â¸£ Ï„â‚‚â‚‚

instance
  Reflexive[âŠ´áµ—] : Reflexive _âŠ´áµ—_
  Reflexive[âŠ´áµ—] = record { xRx = xRxâ¸¢âŠ´áµ—â¸£ }
  Transitive[âŠ´áµ—] : Transitive _âŠ´áµ—_
  Transitive[âŠ´áµ—] = record { _âŒ¾_ = _âŒ¾â¸¢âŠ´áµ—â¸£_ }
  PreOrder[type] : PreOrder zeroË¡ type
  PreOrder[type] = record { _âŠ´_ = _âŠ´áµ—_ }

-------------------------------
-- [dom], [cod] and [equate] --
-------------------------------

domáµ— : type â†’ type
domáµ— (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = Ï„â‚
domáµ— _ = âŠ¥

domâº : âŸª â‡§ type â‡’ â‡§ type âŸ«
domâº = witness-x (curryâ¸¢Î»â†‘â¸£ idâ¸¢Î»â†‘â¸£) $ mk[witness] domáµ— ppr
  where
    ppr : proper (_âŠ´_ â‡‰ _âŠ´_) domáµ—
    ppr âŠ¥ = âŠ¥
    ppr âŸ¨ğ”¹âŸ© = âŠ¥
    ppr (âŠ´â‚ âŸ¨â†’âŸ© âŠ´â‚‚) = âŠ´â‚
  
codáµ— : type â†’ type
codáµ— (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = Ï„â‚‚
codáµ— _ = âŠ¥

codâº : âŸª â‡§ type â‡’ â‡§ type âŸ«
codâº = witness-x (curryâ¸¢Î»â†‘â¸£ idâ¸¢Î»â†‘â¸£) $ mk[witness] codáµ— ppr
  where
    ppr : proper (_âŠ´_ â‡‰ _âŠ´_) codáµ—
    ppr âŠ¥ = âŠ¥
    ppr âŸ¨ğ”¹âŸ© = âŠ¥
    ppr (âŠ´â‚ âŸ¨â†’âŸ© âŠ´â‚‚) = âŠ´â‚‚

equate : type â†’ type â†’ type
equate âŸ¨ğ”¹âŸ© âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
equate (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚) (Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚) = equate Ï„â‚â‚ Ï„â‚â‚‚ âŸ¨â†’âŸ© equate Ï„â‚‚â‚ Ï„â‚‚â‚‚
equate _ _ = âŠ¥

right-zero[equate] : âˆ€ Ï„ â†’ equate Ï„ âŠ¥ â‰¡ âŠ¥
right-zero[equate] âŠ¥ = â†¯
right-zero[equate] âŸ¨ğ”¹âŸ© = â†¯
right-zero[equate] (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚) = â†¯

equateâº : âŸª â‡§ type â‡’ â‡§ type â‡’ â‡§ type âŸ«
equateâº = witness-x (curryâ¸¢Î»â†‘â¸£ $ curryâ¸¢Î»â†‘â¸£ idâ¸¢Î»â†‘â¸£) $ mk[witness] equate ppr
  where
    ppr : proper (_âŠ´_ â‡‰ _âŠ´_ â‡‰ _âŠ´_) equate
    ppr âŸ¨ğ”¹âŸ© âŸ¨ğ”¹âŸ© = âŸ¨ğ”¹âŸ©
    ppr (Ï„â‚â‚ âŸ¨â†’âŸ© Ï„â‚‚â‚) (Ï„â‚â‚‚ âŸ¨â†’âŸ© Ï„â‚‚â‚‚) = ppr Ï„â‚â‚ Ï„â‚â‚‚ âŸ¨â†’âŸ© ppr Ï„â‚‚â‚ Ï„â‚‚â‚‚
    ppr âŠ¥ _ = âŠ¥
    ppr {Ï„â‚} {Ï„â‚‚} _ âŠ¥ rewrite right-zero[equate] Ï„â‚ =  âŠ¥
    ppr âŸ¨ğ”¹âŸ© (_ âŸ¨â†’âŸ© _) =  âŠ¥
    ppr (_ âŸ¨â†’âŸ© _) âŸ¨ğ”¹âŸ© =  âŠ¥

-----------
-- terms --
-----------

data context : Set where
  [] : context
  _âˆ·_ : type â†’ context â†’ context

data _âˆˆ_ : type â†’ context â†’ Set where
  Zero : âˆ€ {Î“ Ï„} â†’ Ï„ âˆˆ Ï„ âˆ· Î“
  Suc : âˆ€ {Î“ Ï„â‚ Ï„â‚‚} â†’ Ï„â‚ âˆˆ Î“ â†’ Ï„â‚ âˆˆ Ï„â‚‚ âˆ· Î“

data _âŠ¢_ : context â†’ type â†’ Set where
  âŸ¨ğ”¹âŸ© : âˆ€ {Î“} â†’ ğ”¹ â†’ Î“ âŠ¢ âŸ¨ğ”¹âŸ©
  âŸ¨ifâŸ©_âŸ¨thenâŸ©_âŸ¨elseâŸ© : âˆ€ {Î“ Ï„â‚ Ï„â‚‚}
    â†’ Î“ âŠ¢ âŸ¨ğ”¹âŸ©
    â†’ Î“ âŠ¢ Ï„â‚
    â†’ Î“ âŠ¢ Ï„â‚‚
    â†’ Î“ âŠ¢ equate Ï„â‚ Ï„â‚‚
  Var : âˆ€ {Î“ Ï„}
    â†’ Ï„ âˆˆ Î“
    â†’ Î“ âŠ¢ Ï„
  âŸ¨Î»âŸ© : âˆ€ {Î“ Ï„â‚ Ï„â‚‚}
    â†’ Ï„â‚ âˆ· Î“ âŠ¢ Ï„â‚‚
    â†’ Î“ âŠ¢ (Ï„â‚ âŸ¨â†’âŸ© Ï„â‚‚)
  _âŸ¨â‹…âŸ©_â€–_ : âˆ€ {Î“ Ï„â‚ Ï„â‚‚}
    â†’ Î“ âŠ¢ Ï„â‚
    â†’ Î“ âŠ¢ Ï„â‚‚
    â†’ Ï„â‚‚ â‰¡ domáµ— Ï„â‚
    â†’ Î“ âŠ¢ codáµ— Ï„â‚
  _â¦‚_ : âˆ€ {Î“ Ï„â‚ Ï„â‚‚}
    â†’ Î“ âŠ¢ Ï„â‚
    â†’ Ï„â‚ â‰¡ Ï„â‚‚
    â†’ Î“ âŠ¢ Ï„â‚‚
