module Prelude.Data.FMap where

open import Prelude.Core
open import Prelude.Classes
open import Prelude.Orders
open import Prelude.Data.AddTop

-- infixr 11 _â‡°_
-- infixr 11 â‡°[]
-- infixr 40 _â‹„_â‹„_âˆ·_

module _ {â„“ â„“Ê³} {K V : Set â„“} {{_ : Order â„“Ê³ K}} where
  _â§ºá¶ [_]_ : list (K âˆ§ V) â†’ (V â†’ V â†’ V) â†’ list (K âˆ§ V) â†’ list (K âˆ§ V)
  [] â§ºá¶ [ _ ] kvs = kvs
  kvs â§ºá¶ [ _ ] [] = kvs
  (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) â§ºá¶ [ f ] (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) with kâ‚ â‹š kâ‚‚
  â€¦ | [<] = âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· (kvsâ‚ â§ºá¶ [ f ] (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚))
  â€¦ | [â‰¡] = âŸ¨ kâ‚ , f vâ‚ vâ‚‚ âŸ© âˆ· (kvsâ‚ â§ºá¶ [ f ] kvsâ‚‚) 
  â€¦ | [>] = âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· ((âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) â§ºá¶ [ f ] kvsâ‚‚)

  _â‹‡á¶ [_]_ : list (K âˆ§ V) â†’ (V â†’ V â†’ V) â†’ list (K âˆ§ V) â†’ list (K âˆ§ V)
  kvs â‹‡á¶ [ f ] [] = []
  [] â‹‡á¶ [ f ] kvs = []
  (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) â‹‡á¶ [ f ] (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) with kâ‚ â‹š kâ‚‚
  â€¦ | [<] = kvsâ‚ â‹‡á¶ [ f ] (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚)
  â€¦ | [â‰¡] = âŸ¨ kâ‚ , f vâ‚ vâ‚‚ âŸ© âˆ· (kvsâ‚ â‹‡á¶ [ f ] kvsâ‚‚)
  â€¦ | [>] = (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) â‹‡á¶ [ f ] kvsâ‚‚

  â´_â†¦_âµá¶  : K â†’ V â†’ list (K âˆ§ V)
  â´ k â†¦ v âµá¶  = âŸ¨ k , v âŸ© âˆ· []

  _[_â†¦_]á¶  : list (K âˆ§ V) â†’ K â†’ V â†’ list (K âˆ§ V)
  kvs [ k â†¦ v ]á¶  = â´ k â†¦ v âµá¶  â§ºá¶ [ const ] kvs

  _[_] : list (K âˆ§ V) â†’ K â†’ option V
  [] [ _ ] = None
  (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs) [ k ] with k â‹š kâ€²
  â€¦ | [<] = None
  â€¦ | [â‰¡] = Some vâ€²
  â€¦ | [>] = kvs [ k ]

  _âˆˆ?_ : K â†’ list (K âˆ§ V) â†’ â€¼
  k âˆˆ? [] = âœ—
  k âˆˆ? (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs) with k â‹š kâ€²
  â€¦ | [<] = âœ—
  â€¦ | [â‰¡] = âœ“
  â€¦ | [>] = k âˆˆ? kvs

  data _âˆˆ_ : K â†’ list (K âˆ§ V) â†’ Set where
    Zero : âˆ€ {k v kvs} â†’ k âˆˆ (âŸ¨ k , v âŸ© âˆ· kvs)
    Succ : âˆ€ {k kâ€² vâ€² kvs} â†’ k âˆˆ kvs â†’ k âˆˆ (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs)

  data _âˆ‰_ : K â†’ list (K âˆ§ V) â†’ Set â„“ where
    [] : âˆ€ {k} â†’ k âˆ‰ []
    _âˆ·_ : âˆ€ {k kâ€² vâ€² kvs}
      â†’ k â‰¢ kâ€²
      â†’ k âˆ‰ kvs
      â†’ k âˆ‰ (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs)

  data âŸ¨_â†¦_âŸ©âˆˆ_ : K â†’ V â†’ list (K âˆ§ V) â†’ Set where
    Zero : âˆ€ {k v kvs} â†’ âŸ¨ k â†¦ v âŸ©âˆˆ (âŸ¨ k , v âŸ© âˆ· kvs)
    Succ : âˆ€ {k v kâ€² vâ€² kvs} â†’ âŸ¨ k â†¦ v âŸ©âˆˆ kvs â†’ âŸ¨ k â†¦ v âŸ©âˆˆ (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs)

  sound[âˆ‰] : âˆ€ {k kvs} â†’ k âˆ‰ kvs â†’ Â¬ (k âˆˆ kvs)
  sound[âˆ‰] {k} {âŸ¨ .k , vâ€² âŸ© âˆ· kvs} (kâ‰¢k âˆ· kâˆ‰kvs) Zero = kâ‰¢k â†¯
  sound[âˆ‰] {k} {âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs} (kâ‰¢kâ€² âˆ· kâˆ‰kvs) (Succ kâˆˆkvs) = sound[âˆ‰] kâˆ‰kvs kâˆˆkvs

  sound[â†¦âˆ‰] : âˆ€ {k v kvs} â†’ k âˆ‰ kvs â†’ Â¬ (âŸ¨ k â†¦ v âŸ©âˆˆ kvs)
  sound[â†¦âˆ‰] {k} {v} {âŸ¨ .k , .v âŸ© âˆ· kvs} (kâ‰¢k âˆ· kâˆ‰kvs) Zero = kâ‰¢k â†¯
  sound[â†¦âˆ‰] {k} {v} {âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs} (kâ‰¢kâ€² âˆ· kâˆ‰kvs) (Succ kâˆˆkvs) = sound[â†¦âˆ‰] kâˆ‰kvs kâˆˆkvs

  data _âˆˆ!á´¾_ (k : K) (kvs : list (K âˆ§ V)) : Set â„“ where
    âœ“ : k âˆˆ kvs â†’ k âˆˆ!á´¾ kvs
    âœ— : k âˆ‰ kvs â†’ k âˆˆ!á´¾ kvs

  data _âˆˆ!á´¸_â€–[_,_] (k : K) (kvs : list (K âˆ§ V)) : â€¼ â†’ k âˆˆ!á´¾ kvs â†’ Set where
    âœ“ : âˆ€ {E : k âˆˆ kvs} â†’ k âˆˆ!á´¸ kvs â€–[ âœ“ , âœ“ E ]
    âœ— : âˆ€ {E : k âˆ‰ kvs} â†’ k âˆˆ!á´¸ kvs â€–[ âœ— , âœ— E ]

  data _â†¦âˆˆ!á´¾_ (k : K) (kvs : list (K âˆ§ V)) : Set â„“ where
    âœ“ : âˆ€ {v} â†’ âŸ¨ k â†¦ v âŸ©âˆˆ kvs â†’ k â†¦âˆˆ!á´¾ kvs
    âœ— : k âˆ‰ kvs â†’ k â†¦âˆˆ!á´¾ kvs

  data _â†¦âˆˆ!á´¸_â€–[_,_] (k : K) (kvs : list (K âˆ§ V)) : option V â†’ k â†¦âˆˆ!á´¾ kvs â†’ Set â„“ where
    âœ“ : âˆ€ {v} {E : âŸ¨ k â†¦ v âŸ©âˆˆ kvs} â†’ k â†¦âˆˆ!á´¸ kvs â€–[ Some v , âœ“ E ]
    âœ— : âˆ€ {E : k âˆ‰ kvs} â†’ k â†¦âˆˆ!á´¸ kvs â€–[ None , âœ— E ]

  syntax âŠ†[] _âŠ‘_ kvsâ‚ kvsâ‚‚ = kvsâ‚ âŠ†[ _âŠ‘_ ] kvsâ‚‚
  data âŠ†[] (_âŠ‘_ : V â†’ V â†’ Set â„“) : list (K âˆ§ V) â†’ list (K âˆ§ V) â†’ Set â„“ where
    [] : âˆ€ {kvs}
      â†’ [] âŠ†[ _âŠ‘_ ] kvs
    _â‹„_âˆ·_ : âˆ€ {k v vâ€² kvsâ‚ kvsâ‚‚}
      â†’ âŸ¨ k â†¦ vâ€² âŸ©âˆˆ kvsâ‚‚
      â†’ v âŠ‘ vâ€²
      â†’ kvsâ‚ âŠ†[ _âŠ‘_ ] kvsâ‚‚ â†’ (âŸ¨ k , v âŸ© âˆ· kvsâ‚) âŠ†[ _âŠ‘_ ] kvsâ‚‚
  syntax âŠˆ[] _âŠ‘_ kvsâ‚ kvsâ‚‚ = kvsâ‚ âŠˆ[ _âŠ‘_ ] kvsâ‚‚
  data âŠˆ[] (_âŠ‘_ : V â†’ V â†’ Set â„“) : list (K âˆ§ V) â†’ list (K âˆ§ V) â†’ Set â„“ where
    Zeroâˆ‰ : âˆ€ {k v kvsâ‚ kvsâ‚‚}
      â†’ k âˆ‰ kvsâ‚‚
      â†’ âŸ¨ k , v âŸ© âˆ· kvsâ‚ âŠˆ[ _âŠ‘_ ] kvsâ‚‚
    Zeroâˆˆ : âˆ€ {k v vâ€² kvsâ‚ kvsâ‚‚}
      â†’ âŸ¨ k â†¦ vâ€² âŸ©âˆˆ kvsâ‚‚
      â†’ Â¬ (v âŠ‘ vâ€²)
      â†’ âŸ¨ k , v âŸ© âˆ· kvsâ‚ âŠˆ[ _âŠ‘_ ] kvsâ‚‚
    Succ : âˆ€ {k v kvsâ‚ kvsâ‚‚}
      â†’ kvsâ‚ âŠˆ[ _âŠ‘_ ] kvsâ‚‚
      â†’ (âŸ¨ k , v âŸ© âˆ· kvsâ‚) âŠˆ[ _âŠ‘_ ] kvsâ‚‚

  syntax âŠ†!á´¾[] _âŠ‘_ kvsâ‚ kvsâ‚‚ = kvsâ‚ âŠ†?á´¾[ _âŠ‘_ ] kvsâ‚‚
  data âŠ†!á´¾[] (_âŠ‘_ : V â†’ V â†’ Set â„“) (kvsâ‚ kvsâ‚‚ : list (K âˆ§ V)) : Set â„“ where
    âœ“ : kvsâ‚ âŠ†[ _âŠ‘_ ] kvsâ‚‚ â†’ kvsâ‚ âŠ†?á´¾[ _âŠ‘_ ] kvsâ‚‚
    âœ— : kvsâ‚‚ âŠˆ[ _âŠ‘_ ] kvsâ‚‚ â†’ kvsâ‚ âŠ†?á´¾[ _âŠ‘_ ] kvsâ‚‚

  syntax âŠ†!á´¸[] _âŠ‘_ kvsâ‚ kvsâ‚‚ r rá´¾ = kvsâ‚ âŠ†?á´¸[ _âŠ‘_ ] kvsâ‚‚ â€–[ r , rá´¾ ]
  data âŠ†!á´¸[] (_âŠ‘_ : V â†’ V â†’ Set â„“) (kvsâ‚ kvsâ‚‚ : list (K âˆ§ V)) : â€¼ â†’ kvsâ‚ âŠ†?á´¾[ _âŠ‘_ ] kvsâ‚‚ â†’ Set â„“ where
    âœ“ : âˆ€ {E : kvsâ‚ âŠ†[ _âŠ‘_ ] kvsâ‚‚} â†’ kvsâ‚ âŠ†?á´¸[ _âŠ‘_ ] kvsâ‚‚ â€–[ âœ“ , âœ“ E ]
    âœ— : âˆ€ {E : kvsâ‚‚ âŠˆ[ _âŠ‘_ ] kvsâ‚‚} â†’ kvsâ‚ âŠ†?á´¸[ _âŠ‘_ ] kvsâ‚‚ â€–[ âœ— , âœ— E ]

  data sorted : add-âŠ¤ K â†’ list (K âˆ§ V) â†’ Set (â„“ âŠ”á´¸ â„“Ê³) where
    [] : sorted âŠ¤ []
    _âˆ·_ : âˆ€ {b k v kvs} â†’ âŸ¨ k âŸ© < b â†’ sorted b kvs â†’ sorted âŸ¨ k âŸ© (âŸ¨ k , v âŸ© âˆ· kvs)

  _<[_]â€–[_,_] : âˆ€ {b} k kvs â†’ âŸ¨ k âŸ© < b â†’ sorted b kvs â†’ k âˆ‰ kvs
  k <[ []                ]â€–[ k<b      , Ïƒ        ] = []
  k <[ âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs ]â€–[ âŸ¨ k<kâ€² âŸ© , kâ€²<b âˆ· Ïƒ ] = strict[<]/â‰¡[ K ] k<kâ€² âˆ· (k <[ kvs ]â€–[ kâ€²<b âŠš âŸ¨ k<kâ€² âŸ© , Ïƒ ])

  sortedâ‰¤ : âˆ€ {b} k kvs â†’ sorted b kvs â†’ k âˆˆ kvs â†’ b â‰¤ âŸ¨ k âŸ©
  sortedâ‰¤ .k (âŸ¨ k , v âŸ© âˆ· kvs) (k<b âˆ· Ïƒ) Zero = xRx
  sortedâ‰¤ k (âŸ¨ kâ€² , v âŸ© âˆ· kvs) (kâ€²<b âˆ· Ïƒ) (Succ âˆˆ) = sortedâ‰¤ k kvs Ïƒ âˆˆ âŠš weaken[â‰º] kâ€²<b

  â†¦â†’âˆˆ : âˆ€ k v kvs â†’ âŸ¨ k â†¦ v âŸ©âˆˆ kvs â†’ k âˆˆ kvs
  â†¦â†’âˆˆ k v (âŸ¨ .k , .v âŸ© âˆ· kvs) Zero = Zero
  â†¦â†’âˆˆ k v (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs) (Succ âˆˆâ‚€) = Succ (â†¦â†’âˆˆ k v kvs âˆˆâ‚€)

  uniq : âˆ€ {k vâ‚ vâ‚‚ b kvs} â†’ sorted b kvs â†’ âŸ¨ k â†¦ vâ‚ âŸ©âˆˆ kvs â†’ âŸ¨ k â†¦ vâ‚‚ âŸ©âˆˆ kvs â†’ vâ‚ â‰¡ vâ‚‚
  uniq Ïƒ Zero Zero = â†¯
  uniq {k} {_} {_} {_} {âŸ¨ .k , v âŸ© âˆ· kvs} (<â‚ âˆ· Ïƒ) Zero (Succ â†¦â‚‚) = exfalso (sound[â†¦âˆ‰] (k <[ kvs ]â€–[ <â‚ , Ïƒ ]) â†¦â‚‚)
  uniq {k} {_} {_} {_} {âŸ¨ .k , v âŸ© âˆ· kvs} (<â‚ âˆ· Ïƒ) (Succ â†¦â‚) Zero = exfalso (sound[â†¦âˆ‰] (k <[ kvs ]â€–[ <â‚ , Ïƒ ]) â†¦â‚)
  uniq (<â‚ âˆ· Ïƒ) (Succ â†¦â‚) (Succ â†¦â‚‚) = uniq Ïƒ â†¦â‚ â†¦â‚‚

  movealong : âˆ€ {k v kvsâ‚ kvsâ‚‚ _âŠ‘_} â†’ kvsâ‚ âŠ†[ _âŠ‘_ ] (âŸ¨ k , v âŸ© âˆ· kvsâ‚‚) â†’ k âˆ‰ kvsâ‚ â†’ kvsâ‚ âŠ†[ _âŠ‘_ ] kvsâ‚‚
  movealong [] âˆ‰â‚ = []
  movealong (Zero â‹„ âŠ‘â‚ âˆ· âŠ†â‚) (â‰¢â‚ âˆ· âˆ‰â‚) = exfalso (â‰¢â‚ â†¯)
  movealong {k} {v} (Succ âˆˆâ‚ â‹„ âŠ‘â‚ âˆ· âŠ†â‚) (â‰¢â‚ âˆ· âˆ‰â‚) = âˆˆâ‚ â‹„ âŠ‘â‚ âˆ· movealong âŠ†â‚ âˆ‰â‚

  extá¶  : âˆ€ {bâ‚} kvsâ‚ {bâ‚‚} kvsâ‚‚ _âŠ‘_ {{_ : Antisymmetric _âŠ‘_}} â†’ sorted bâ‚ kvsâ‚ â†’ sorted bâ‚‚ kvsâ‚‚ â†’ kvsâ‚ âŠ†[ _âŠ‘_ ] kvsâ‚‚ â†’ kvsâ‚‚ âŠ†[ _âŠ‘_ ] kvsâ‚ â†’ kvsâ‚ â‰¡ kvsâ‚‚
  extá¶  .[] .[] _âŠ‘_ Ïƒâ‚ Ïƒâ‚‚ [] [] = â†¯
  extá¶  .[] (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) _âŠ‘_ Ïƒâ‚ Ïƒâ‚‚ [] (() â‹„ âŠ‘â‚‚ âˆ· âŠ†â‚‚)
  extá¶  (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) .[] _âŠ‘_ Ïƒâ‚ Ïƒâ‚‚ (() â‹„ âŠ‘â‚ âˆ· âŠ†â‚) []
  extá¶  (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) _âŠ‘_ (<â‚ âˆ· Ïƒâ‚) (<â‚‚ âˆ· Ïƒâ‚‚) (âˆˆâ‚ â‹„ âŠ‘â‚ âˆ· âŠ†â‚) (âˆˆâ‚‚ â‹„ âŠ‘â‚‚ âˆ· âŠ†â‚‚) with kâ‚ â‹šá´¾ kâ‚‚
  â€¦ | [<] <â‚â‚‚ = exfalso (sound[â†¦âˆ‰] (kâ‚ <[ âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚ ]â€–[ âŸ¨ <â‚â‚‚ âŸ© , <â‚‚ âˆ· Ïƒâ‚‚ ]) âˆˆâ‚)
  â€¦ | [>] >â‚â‚‚ = exfalso (sound[â†¦âˆ‰] (kâ‚‚ <[ âŸ¨ kâ‚  , vâ‚ âŸ© âˆ· kvsâ‚ ]â€–[ âŸ¨ >â‚â‚‚ âŸ© , <â‚ âˆ· Ïƒâ‚ ]) âˆˆâ‚‚)
  â€¦ | [â‰¡] â‰¡â‚â‚‚ rewrite
      â‰¡â‚â‚‚ | uniq (<â‚ âˆ· Ïƒâ‚) âˆˆâ‚‚ Zero | uniq (<â‚‚ âˆ· Ïƒâ‚‚) âˆˆâ‚ Zero | â‹ˆ âŠ‘â‚ âŠ‘â‚‚
    | extá¶  kvsâ‚ kvsâ‚‚ _âŠ‘_ Ïƒâ‚ Ïƒâ‚‚ (movealong âŠ†â‚ (kâ‚‚ <[ kvsâ‚ ]â€–[ <â‚ , Ïƒâ‚ ])) (movealong âŠ†â‚‚ (kâ‚‚ <[ kvsâ‚‚ ]â€–[ <â‚‚ , Ïƒâ‚‚ ])) = â†¯

  sound[âŠ†] : âˆ€ {kvsâ‚ kvsâ‚‚ _âŠ‘_} â†’ kvsâ‚ âŠ†[ _âŠ‘_ ] kvsâ‚‚ â†’ âˆ€ {k v} â†’ âŸ¨ k â†¦ v âŸ©âˆˆ kvsâ‚ â†’ âˆƒ vâ€² ğ‘ ğ‘¡ âŸ¨ k â†¦ vâ€² âŸ©âˆˆ kvsâ‚‚ âˆ§ v âŠ‘ vâ€²
  sound[âŠ†] (_â‹„_âˆ·_ {k} {v} {vâ€²} kâ†¦vâ€² vâŠ‘vâ€² âŠ†â‚€) Zero = âŸ¨âˆƒ vâ€² , âŸ¨ kâ†¦vâ€² , vâŠ‘vâ€² âŸ© âŸ©
  sound[âŠ†] (_â‹„_âˆ·_ {k} {v} {vâ€²} kâ†¦vâ€² vâŠ‘vâ€² âŠ†â‚€) (Succ kâ†¦v) = sound[âŠ†] âŠ†â‚€ kâ†¦v

  complete[âŠ†] : âˆ€ kvsâ‚ kvsâ‚‚ _âŠ‘_ â†’ (âˆ€ {k v} â†’ âŸ¨ k â†¦ v âŸ©âˆˆ kvsâ‚ â†’ âˆƒ vâ€² ğ‘ ğ‘¡ âŸ¨ k â†¦ vâ€² âŸ©âˆˆ kvsâ‚‚ âˆ§ v âŠ‘ vâ€²) â†’ kvsâ‚ âŠ†[ _âŠ‘_ ] kvsâ‚‚
  complete[âŠ†] [] kvsâ‚‚ _âŠ‘_ F = []
  complete[âŠ†] (âŸ¨ k , v âŸ© âˆ· kvsâ‚) kvsâ‚‚ _âŠ‘_ F with F Zero
  â€¦ | âŸ¨âˆƒ vâ€² , âŸ¨ kâ†¦vâ€² , vâŠ‘vâ€² âŸ© âŸ© = kâ†¦vâ€² â‹„ vâŠ‘vâ€² âˆ· (complete[âŠ†] kvsâ‚ kvsâ‚‚ _âŠ‘_ (Î» kâ†¦v â†’ F (Succ kâ†¦v)))

  data âˆˆâˆ¨ (f : V â†’ V â†’ V) k v kvsâ‚ kvsâ‚‚ : Set â„“ where
    Inl : âŸ¨ k â†¦ v âŸ©âˆˆ kvsâ‚ â†’ k âˆ‰ kvsâ‚‚ â†’ âˆˆâˆ¨ f k v kvsâ‚ kvsâ‚‚
    Inr : âŸ¨ k â†¦ v âŸ©âˆˆ kvsâ‚‚ â†’ k âˆ‰ kvsâ‚ â†’ âˆˆâˆ¨ f k v kvsâ‚ kvsâ‚‚
    Inlr : âˆ€ vâ‚ vâ‚‚ â†’ âŸ¨ k â†¦ vâ‚ âŸ©âˆˆ kvsâ‚ â†’ âŸ¨ k â†¦ vâ‚‚ âŸ©âˆˆ kvsâ‚‚ â†’ v â‰¡ f vâ‚ vâ‚‚ â†’ âˆˆâˆ¨ f k v kvsâ‚ kvsâ‚‚

  left-unit[â§º]á¶  : âˆ€ f kvs â†’ [] â§ºá¶ [ f ] kvs â‰¡ kvs
  left-unit[â§º]á¶  f kvsâ‚ = â†¯

  right-unit[â§º]á¶  : âˆ€ f kvs â†’ kvs â§ºá¶ [ f ] [] â‰¡ kvs
  right-unit[â§º]á¶  f [] = â†¯
  right-unit[â§º]á¶  f (kv âˆ· kvs) = â†¯

  âˆˆâˆ¨! : âˆ€ {bâ‚ bâ‚‚} f k v kvsâ‚ kvsâ‚‚ â†’ sorted bâ‚ kvsâ‚ â†’ sorted bâ‚‚ kvsâ‚‚ â†’ âŸ¨ k â†¦ v âŸ©âˆˆ (kvsâ‚ â§ºá¶ [ f ] kvsâ‚‚) â†’ âˆˆâˆ¨ f k v kvsâ‚ kvsâ‚‚
  âˆˆâˆ¨! f k v [] kvsâ‚‚ Ïƒâ‚ Ïƒâ‚‚ âˆˆâ‚€ = Inr âˆˆâ‚€ []
  âˆˆâˆ¨! f k v kvsâ‚ [] Ïƒâ‚ Ïƒâ‚‚ âˆˆâ‚€ rewrite right-unit[â§º]á¶  f kvsâ‚ = Inl âˆˆâ‚€ []
  âˆˆâˆ¨! f k v (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) Ïƒâ‚ Ïƒâ‚‚ âˆˆâ‚€ with kâ‚ â‹š kâ‚‚ | kâ‚ â‹šá´¾ kâ‚‚ | kâ‚ â‹šá´¸ kâ‚‚
  âˆˆâˆ¨! f k v (âŸ¨ .k , .v âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (kâ‚<bâ‚ âˆ· Ïƒâ‚) (kâ‚‚<bâ‚‚ âˆ· Ïƒâ‚‚) Zero | [<] | [<] 1<2 | [<] = Inl Zero (k <[ âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚ ]â€–[ âŸ¨ 1<2 âŸ© , kâ‚‚<bâ‚‚ âˆ· Ïƒâ‚‚ ])
  âˆˆâˆ¨! f k v (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (kâ‚<bâ‚ âˆ· Ïƒâ‚) (kâ‚‚<bâ‚‚ âˆ· Ïƒâ‚‚) (Succ âˆˆâ‚€) | [<] | [<] 1<2 | [<] with âˆˆâˆ¨! f k v kvsâ‚ (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) Ïƒâ‚ (kâ‚‚<bâ‚‚ âˆ· Ïƒâ‚‚) âˆˆâ‚€
  â€¦ | Inl âˆˆâ‚ âˆ‰â‚‚ = Inl (Succ âˆˆâ‚) âˆ‰â‚‚
  â€¦ | Inr âˆˆâ‚‚ âˆ‰â‚ = Inr âˆˆâ‚‚ (E âˆ· {!!})
    where
      E : k â‰¢  kâ‚
      E â‰¡â‚€ with strict[â‰º][ _â‰¤â¸¢add-âŠ¤â¸£_  , _<â¸¢add-âŠ¤â¸£_ ] {âŸ¨ kâ‚ âŸ©} {âŸ¨ k âŸ©}
      â€¦ | F rewrite â‰¡â‚€ = F {!!} {!!}
      -- {- {! Î» kâ‰¡kâ‚ â†’ strict[â‰º] (extend[â‰º]/R âŸ¨ 1<2 âŸ© (sortedâ‰¤ k (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (kâ‚‚<bâ‚‚ âˆ· Ïƒâ‚‚) (â†¦â†’âˆˆ _ _ _ âˆˆâ‚‚))) (â—‡ kâ‰¡kâ‚)!} -} âˆ· {!!}) -- {!!}
  â€¦ | Inlr vâ‚â€² vâ‚‚â€² âˆˆâ‚ âˆˆâ‚‚ â‰¡â‚â‚‚ = {!!}
  âˆˆâˆ¨! f k v (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (kâ‚<bâ‚ âˆ· Ïƒâ‚) (kâ‚‚<bâ‚‚ âˆ· Ïƒâ‚‚) âˆˆâ‚€ | [â‰¡] | [â‰¡] 1â‰¡2 | [â‰¡] = {!!}
  âˆˆâˆ¨! f k v (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (kâ‚<bâ‚ âˆ· Ïƒâ‚) (kâ‚‚<bâ‚‚ âˆ· Ïƒâ‚‚) âˆˆâ‚€ | [>] | [>] 1>2 | [>] = {!!}

  associative[â§º]á¶  : âˆ€ f kvsâ‚ kvsâ‚‚ kvsâ‚ƒ â†’ (âˆ€ x y z â†’ f (f x y) z â‰¡ f x (f y z)) â†’ (kvsâ‚ â§ºá¶ [ f ] kvsâ‚‚) â§ºá¶ [ f ] kvsâ‚ƒ â‰¡ kvsâ‚ â§ºá¶ [ f ] (kvsâ‚‚ â§ºá¶ [ f ] kvsâ‚ƒ)
  associative[â§º]á¶  f [] kvsâ‚‚ kvsâ‚ƒ assoc[f] = â†¯
  associative[â§º]á¶  f kvsâ‚ [] kvsâ‚ƒ assoc[f] rewrite right-unit[â§º]á¶  f kvsâ‚ = â†¯
  associative[â§º]á¶  f kvsâ‚ kvsâ‚‚ [] assoc[f] rewrite right-unit[â§º]á¶  f (kvsâ‚ â§ºá¶ [ f ] kvsâ‚‚) | right-unit[â§º]á¶  f kvsâ‚‚ = â†¯
  associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f]
    with kâ‚ â‹šá´¾ kâ‚‚ | kâ‚‚ â‹šá´¾ kâ‚ƒ
  associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f] | [<] 1<2 | [<] 2<3
    rewrite â‹š[<] kâ‚ kâ‚‚ 1<2 | â‹š[<] kâ‚‚ kâ‚ƒ 2<3 = {!!}
  associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f] | [<] 1<2 | [â‰¡] 2â‰¡3 = {!!}
  associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f] | [<] 1<2 | [>] 2>3 = {!!}
  associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f] | [â‰¡] 1<2 | [<] 2<3 = {!!}
  associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f] | [â‰¡] 1<2 | [â‰¡] 2â‰¡3 = {!!}
  associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f] | [â‰¡] 1<2 | [>] 2>3 = {!!}
  associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f] | [>] 1<2 | [<] 2<3 = {!!}
  associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f] | [>] 1<2 | [â‰¡] 2â‰¡3 = {!!}
  associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f] | [>] 1<2 | [>] 2>3 = {!!}
  -- associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f] with kâ‚ â‹šá´¾ kâ‚‚ | kâ‚ â‹šá´¾ kâ‚ƒ | kâ‚‚ â‹šá´¾ kâ‚ƒ
  -- â€¦ | [<] 1<2 | [<] 1<3 | [<] 2<3
  --   rewrite â‹š[<] kâ‚ kâ‚‚ 1<2 | â‹š[<] kâ‚‚ kâ‚ƒ 2<3 | â‹š[<] kâ‚ kâ‚ƒ 1<3 | â‹š[<] kâ‚ kâ‚‚ 1<2
  --   | associative[â§º]á¶  f kvsâ‚ (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f]
  --   | â‹š[<] kâ‚‚ kâ‚ƒ 2<3 = â†¯
  -- â€¦ | [<] 1<2 | [<] 1<3 | [â‰¡] 2â‰¡3
  --   rewrite 2â‰¡3 | â‹š[<] kâ‚ kâ‚ƒ 1<3 | â‹š[â‰¡] kâ‚ƒ kâ‚ƒ â†¯ | â‹š[<] kâ‚ kâ‚ƒ 1<3
  --   | associative[â§º]á¶  f kvsâ‚ (âŸ¨ kâ‚ƒ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f]
  --   | â‹š[â‰¡] kâ‚ƒ kâ‚ƒ â†¯ = â†¯
  -- â€¦ | [<] 1<2 | [<] 1<3 | [>] 2>3
  --   rewrite â‹š[<] kâ‚ kâ‚‚ 1<2 | â‹š[>] kâ‚‚ kâ‚ƒ 2>3 | â‹š[<] kâ‚ kâ‚ƒ 1<3
  --   | associative[â§º]á¶  f kvsâ‚ (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) (âŸ¨ kâ‚ƒ , vâ‚ƒ âŸ© âˆ· kvsâ‚ƒ) assoc[f]
  --   | â‹š[>] kâ‚‚ kâ‚ƒ 2>3 = â†¯
  -- â€¦ | [<] 1<2 | [â‰¡] 1â‰¡3 | [<] 2<3 rewrite 1â‰¡3 = exfalso (Â¬â—‡[<][ K ] 2<3 1<2)
  -- â€¦ | [<] 1<2 | [â‰¡] 1â‰¡3 | [â‰¡] 2â‰¡3 rewrite 1â‰¡3 | 2â‰¡3 = exfalso (Â¬xRx[<][ K ] 1<2)
  -- â€¦ | [<] 1<2 | [â‰¡] 1â‰¡3 | [>] 2>3
  --   rewrite 1â‰¡3 | â‹š[<] kâ‚ƒ kâ‚‚ 1<2 | â‹š[>] kâ‚‚ kâ‚ƒ 2>3 | â‹š[â‰¡] kâ‚ƒ kâ‚ƒ â†¯
  --   | associative[â§º]á¶  f kvsâ‚ (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) kvsâ‚ƒ assoc[f] = â†¯
  -- â€¦ | [<] 1<2 | [>] 1>3 | [<] 2<3 = exfalso (Â¬xRx[<][ K ] (1>3 âŠš[<][ K ] 2<3 âŠš[<][ K ] 1<2))
  -- â€¦ | [<] 1<2 | [>] 1>3 | [â‰¡] 2â‰¡3 rewrite 2â‰¡3 = exfalso (Â¬â—‡[<][ K ] 1<2 1>3)
  -- â€¦ | [<] 1<2 | [>] 1>3 | [>] 2>3
  --   rewrite â‹š[<] kâ‚ kâ‚‚ 1<2 | â‹š[>] kâ‚‚ kâ‚ƒ 2>3 | â‹š[>] kâ‚ kâ‚ƒ 1>3
  --   | â—‡ (associative[â§º]á¶  f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) kvsâ‚ƒ assoc[f])
  --   | â‹š[<] kâ‚ kâ‚‚ 1<2
  --   = â†¯
  -- â€¦ | _ | _ | _ = {!!}

  commutative[â§ºá¶ ] : âˆ€ f kvsâ‚ kvsâ‚‚ â†’ (âˆ€ x y â†’ f x y â‰¡ f y x) â†’ kvsâ‚ â§ºá¶ [ f ] kvsâ‚‚ â‰¡ kvsâ‚‚ â§ºá¶ [ f ] kvsâ‚
  commutative[â§ºá¶ ] f [] kvsâ‚‚ comm[f] rewrite right-unit[â§º]á¶  f kvsâ‚‚ = â†¯
  commutative[â§ºá¶ ] f kvsâ‚ [] comm[f] rewrite right-unit[â§º]á¶  f kvsâ‚ = â†¯
  commutative[â§ºá¶ ] f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) comm[f] with kâ‚ â‹š kâ‚‚ | kâ‚ â‹šá´¾ kâ‚‚ | kâ‚ â‹šá´¸ kâ‚‚
  â€¦ | [<] | [<] 1<2 | [<] rewrite â‹š[>] kâ‚‚ kâ‚ 1<2 | commutative[â§ºá¶ ] f kvsâ‚ (âŸ¨ kâ‚‚ , vâ‚‚ âŸ© âˆ· kvsâ‚‚) comm[f] = â†¯
  â€¦ | [â‰¡] | [â‰¡] 1â‰¡2 | [â‰¡] rewrite 1â‰¡2 | â‹š[â‰¡] kâ‚‚ kâ‚‚ â†¯ | comm[f] vâ‚ vâ‚‚ | commutative[â§ºá¶ ] f kvsâ‚ kvsâ‚‚ comm[f] = â†¯
  â€¦ | [>] | [>] 1>2 | [>] rewrite â‹š[<] kâ‚‚ kâ‚ 1>2 | commutative[â§ºá¶ ] f (âŸ¨ kâ‚ , vâ‚ âŸ© âˆ· kvsâ‚) kvsâ‚‚ comm[f] = â†¯

  â†¦âˆˆ[â§º]/LR : âˆ€ {bâ‚ bâ‚‚} k vâ‚ vâ‚‚ f kvsâ‚ kvsâ‚‚ â†’ sorted bâ‚ kvsâ‚ â†’ sorted bâ‚‚ kvsâ‚‚ â†’ âŸ¨ k â†¦ vâ‚ âŸ©âˆˆ kvsâ‚ â†’ âŸ¨ k â†¦ vâ‚‚ âŸ©âˆˆ kvsâ‚‚ â†’ âŸ¨ k â†¦ f vâ‚ vâ‚‚ âŸ©âˆˆ (kvsâ‚ â§ºá¶ [ f ] kvsâ‚‚)
  â†¦âˆˆ[â§º]/LR k vâ‚ vâ‚‚ f (âŸ¨ .k , .vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ .k , .vâ‚‚ âŸ© âˆ· kvsâ‚‚) (_ âˆ· Ïƒâ‚) (_ âˆ· Ïƒâ‚‚) Zero Zero rewrite â‹š[â‰¡] k k â†¯ = Zero
  â†¦âˆˆ[â§º]/LR k vâ‚ vâ‚‚ f (âŸ¨ .k , .vâ‚ âŸ© âˆ· kvsâ‚) (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvsâ‚‚) (k<bâ‚ âˆ· Ïƒâ‚) (kâ€²<bâ‚‚ âˆ· Ïƒâ‚‚) Zero (Succ âˆˆâ‚‚) with k â‹š kâ€² | k â‹šá´¾ kâ€² | k â‹šá´¸ kâ€²
  â€¦ | [<] | [<] k<kâ€² | [<] = exfalso (sound[â†¦âˆ‰] (k <[ kvsâ‚‚ ]â€–[ kâ€²<bâ‚‚ âŠš âŸ¨ k<kâ€² âŸ© , Ïƒâ‚‚ ]) âˆˆâ‚‚)
  â€¦ | [â‰¡] | [â‰¡] kâ‰¡kâ€² | [â‰¡] rewrite kâ‰¡kâ€² = exfalso (sound[â†¦âˆ‰] (kâ€² <[ kvsâ‚‚ ]â€–[ kâ€²<bâ‚‚ , Ïƒâ‚‚ ]) âˆˆâ‚‚)
  â€¦ | [>] | [>] k>kâ€² | [>] = Succ (â†¦âˆˆ[â§º]/LR k vâ‚ vâ‚‚ f (âŸ¨ k , vâ‚ âŸ© âˆ· kvsâ‚) kvsâ‚‚ (k<bâ‚ âˆ· Ïƒâ‚) Ïƒâ‚‚ Zero âˆˆâ‚‚)
  â†¦âˆˆ[â§º]/LR k vâ‚ vâ‚‚ f (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvsâ‚) (âŸ¨ .k , .vâ‚‚ âŸ© âˆ· kvsâ‚‚) (kâ€²<bâ‚ âˆ· Ïƒâ‚) (kâ€²<bâ‚‚ âˆ· Ïƒâ‚‚) (Succ âˆˆâ‚) Zero with kâ€² â‹š k | kâ€² â‹šá´¾ k | kâ€² â‹šá´¸ k
  â€¦ | [<] | [<] kâ€²<k | [<] = Succ (â†¦âˆˆ[â§º]/LR k vâ‚ vâ‚‚ f kvsâ‚ (âŸ¨ k , vâ‚‚ âŸ© âˆ· kvsâ‚‚) Ïƒâ‚ (kâ€²<bâ‚‚ âˆ· Ïƒâ‚‚) âˆˆâ‚ Zero)
  â€¦ | [â‰¡] | [â‰¡] kâ€²â‰¡k | [â‰¡] rewrite kâ€²â‰¡k = exfalso (sound[â†¦âˆ‰] (k <[ kvsâ‚ ]â€–[ kâ€²<bâ‚ , Ïƒâ‚ ]) âˆˆâ‚)
  â€¦ | [>] | [>] kâ€²>k | [>] = exfalso (sound[â†¦âˆ‰] (k <[ kvsâ‚ ]â€–[ kâ€²<bâ‚ âŠš âŸ¨ kâ€²>k âŸ© , Ïƒâ‚ ]) âˆˆâ‚)
  â†¦âˆˆ[â§º]/LR k vâ‚ vâ‚‚ f (âŸ¨ kâ‚â€² , vâ‚â€² âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚â€² , vâ‚‚â€² âŸ© âˆ· kvsâ‚‚) (kâ€²<bâ‚ âˆ· Ïƒâ‚) (kâ€²<bâ‚‚ âˆ· Ïƒâ‚‚) (Succ âˆˆâ‚) (Succ âˆˆâ‚‚) with kâ‚â€² â‹š kâ‚‚â€² | kâ‚â€² â‹šá´¾ kâ‚‚â€² | kâ‚â€² â‹šá´¸ kâ‚‚â€²
  â€¦ | [<] | [<] kâ€²<k | [<] = Succ (â†¦âˆˆ[â§º]/LR k vâ‚ vâ‚‚ f kvsâ‚ (âŸ¨ kâ‚‚â€² , vâ‚‚â€² âŸ© âˆ· kvsâ‚‚) Ïƒâ‚ (kâ€²<bâ‚‚ âˆ· Ïƒâ‚‚) âˆˆâ‚ (Succ âˆˆâ‚‚))
  â€¦ | [â‰¡] | [â‰¡] kâ€²â‰¡k | [â‰¡] rewrite kâ€²â‰¡k = Succ (â†¦âˆˆ[â§º]/LR k vâ‚ vâ‚‚ f kvsâ‚ kvsâ‚‚ Ïƒâ‚ Ïƒâ‚‚ âˆˆâ‚ âˆˆâ‚‚)
  â€¦ | [>] | [>] kâ€²>k | [>] = Succ (â†¦âˆˆ[â§º]/LR k vâ‚ vâ‚‚ f (âŸ¨ kâ‚â€² , vâ‚â€² âŸ© âˆ· kvsâ‚) kvsâ‚‚ (kâ€²<bâ‚ âˆ· Ïƒâ‚) Ïƒâ‚‚ (Succ âˆˆâ‚) âˆˆâ‚‚)

  â†¦âˆˆ[â§º]/L : âˆ€ {bâ‚ bâ‚‚} k v f kvsâ‚ kvsâ‚‚ â†’ sorted bâ‚ kvsâ‚ â†’ sorted bâ‚‚ kvsâ‚‚ â†’ âŸ¨ k â†¦ v âŸ©âˆˆ kvsâ‚ â†’ k âˆ‰ kvsâ‚‚ â†’ âŸ¨ k â†¦ v âŸ©âˆˆ (kvsâ‚ â§ºá¶ [ f ] kvsâ‚‚)
  â†¦âˆˆ[â§º]/L k v f (âŸ¨ .k , .v âŸ© âˆ· kvsâ‚) .[] Ïƒâ‚ Ïƒâ‚‚ Zero [] = Zero
  â†¦âˆˆ[â§º]/L k v f (âŸ¨ .k , .v âŸ© âˆ· kvsâ‚) (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvsâ‚‚) Ïƒâ‚ (kâ€²<bâ‚‚ âˆ· Ïƒâ‚‚) Zero (kâ‰¢kâ€² âˆ· âˆ‰â‚‚) with k â‹š kâ€² | k â‹šá´¾ kâ€² | k â‹šá´¸ kâ€²
  â€¦ | [<] | [<] kâ€²<k | [<] = Zero
  â€¦ | [â‰¡] | [â‰¡] kâ€²â‰¡k | [â‰¡] rewrite kâ€²â‰¡k = exfalso (kâ‰¢kâ€² â†¯)
  â€¦ | [>] | [>] kâ€²>k | [>] = Succ (â†¦âˆˆ[â§º]/L k v f (âŸ¨ k , v âŸ© âˆ· kvsâ‚) kvsâ‚‚ Ïƒâ‚ Ïƒâ‚‚ Zero âˆ‰â‚‚)
  â†¦âˆˆ[â§º]/L k v f (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvsâ‚) .[] (kâ€²<bâ‚ âˆ· Ïƒâ‚) Ïƒâ‚‚ (Succ âˆˆâ‚) [] = Succ âˆˆâ‚
  â†¦âˆˆ[â§º]/L k v f (âŸ¨ kâ‚â€² , vâ‚â€² âŸ© âˆ· kvsâ‚) (âŸ¨ kâ‚‚â€² , vâ‚‚â€² âŸ© âˆ· kvsâ‚‚) (kâ‚â€²<bâ‚ âˆ· Ïƒâ‚) (kâ‚‚â€²<bâ‚‚ âˆ· Ïƒâ‚‚) (Succ âˆˆâ‚) (xâ‚ âˆ· âˆ‰â‚‚) with kâ‚â€² â‹š kâ‚‚â€² | kâ‚â€² â‹šá´¾ kâ‚‚â€² | kâ‚â€² â‹šá´¸ kâ‚‚â€²
  â€¦ | [<] | [<] kâ€²<k | [<] = Succ (â†¦âˆˆ[â§º]/L k v f kvsâ‚ (âŸ¨ kâ‚‚â€² , vâ‚‚â€² âŸ© âˆ· kvsâ‚‚) Ïƒâ‚ (kâ‚‚â€²<bâ‚‚ âˆ· Ïƒâ‚‚) âˆˆâ‚ (xâ‚ âˆ· âˆ‰â‚‚))
  â€¦ | [â‰¡] | [â‰¡] kâ€²â‰¡k | [â‰¡] rewrite kâ€²â‰¡k = Succ (â†¦âˆˆ[â§º]/L k v f kvsâ‚ kvsâ‚‚ Ïƒâ‚ Ïƒâ‚‚ âˆˆâ‚ âˆ‰â‚‚)
  â€¦ | [>] | [>] kâ€²>k | [>] = Succ (â†¦âˆˆ[â§º]/L k v f (âŸ¨ kâ‚â€² , vâ‚â€² âŸ© âˆ· kvsâ‚) kvsâ‚‚ (kâ‚â€²<bâ‚ âˆ· Ïƒâ‚) Ïƒâ‚‚ (Succ âˆˆâ‚) âˆ‰â‚‚)
  
  _[_]á´¾â€–_ : âˆ€ {b} kvs k â†’ sorted b kvs â†’ k â†¦âˆˆ!á´¾ kvs
  [] [ k ]á´¾â€– _ = âœ— []
  (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs) [ k ]á´¾â€– (kâ€²<b âˆ· Ïƒ) with k â‹šá´¾ kâ€²
  â€¦ | [<] k<kâ€² = âœ— (strict[<]/â‰¡[ K ] k<kâ€² âˆ· (k <[ kvs ]â€–[ kâ€²<b âŠš âŸ¨ k<kâ€² âŸ© , Ïƒ ] ))
  â€¦ | [â‰¡] kâ‰¡kâ€² rewrite kâ‰¡kâ€² = âœ“ Zero
  â€¦ | [>] k>kâ€² with kvs [ k ]á´¾â€– Ïƒ
  â€¦ | âœ“ kâˆˆkvs = âœ“ (Succ kâˆˆkvs)
  â€¦ | âœ— kâˆ‰kvs = âœ— ((Î» kâ‰¡kâ€² â†’ strict[<]/â‰¡[ K ] k>kâ€² (â—‡ kâ‰¡kâ€²)) âˆ· kâˆ‰kvs)

  _[_]á´¸â€–_ : âˆ€ {b} kvs k (Ïƒ : sorted b kvs) â†’ k â†¦âˆˆ!á´¸ kvs â€–[ kvs [ k ] ,  kvs [ k ]á´¾â€– Ïƒ ]
  [] [ k ]á´¸â€– Ïƒ = âœ—
  (âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs) [ k ]á´¸â€– (kâ€²<b âˆ· Ïƒ) with k â‹š kâ€² | k â‹šá´¾ kâ€² | k â‹šá´¸ kâ€²
  â€¦ | [<] | [<] k<kâ€² | [<] = âœ—
  â€¦ | [â‰¡] | [â‰¡] kâ‰¡kâ€² | [â‰¡] rewrite kâ‰¡kâ€² = âœ“
  â€¦ | [>] | [>] k>kâ€² | [>] with kvs [ k ] | kvs [ k ]á´¾â€– Ïƒ | kvs [ k ]á´¸â€– Ïƒ
  â€¦ | None | âœ— kâˆ‰kvs | âœ— = âœ—
  â€¦ | Some v | âœ“ kâˆˆkvs | âœ“ = âœ“

  _âˆˆ?á´¾_â€–_ : âˆ€ {b} k kvs â†’ sorted b kvs â†’ k âˆˆ!á´¾ kvs
  k âˆˆ?á´¾ [] â€– Ïƒ = âœ— []
  k âˆˆ?á´¾ âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs â€– (kâ€²<b âˆ· Ïƒ) with k â‹šá´¾ kâ€²
  â€¦ | [<] k<kâ€² = âœ— ((strict[<]/â‰¡[ K ] k<kâ€²) âˆ· (k <[ kvs ]â€–[ kâ€²<b âŠš âŸ¨ k<kâ€² âŸ© , Ïƒ ]))
  â€¦ | [â‰¡] kâ‰¡kâ€² rewrite kâ‰¡kâ€² = âœ“ Zero
  â€¦ | [>] k>kâ€² with k âˆˆ?á´¾ kvs â€– Ïƒ
  â€¦ | âœ“ kâˆˆkvs = âœ“ (Succ kâˆˆkvs)
  â€¦ | âœ— kâˆ‰kvs = âœ— ((Î» kâ‰¡kâ€² â†’ strict[<]/â‰¡[ K ] k>kâ€² (â—‡ kâ‰¡kâ€²)) âˆ· kâˆ‰kvs)

  _âˆˆ?á´¸_â€–_ : âˆ€ {b} k kvs (Ïƒ : sorted b kvs) â†’ k âˆˆ!á´¸ kvs â€–[ k âˆˆ? kvs , k âˆˆ?á´¾ kvs â€– Ïƒ ]
  k âˆˆ?á´¸ [] â€– Ïƒ = âœ—
  k âˆˆ?á´¸ âŸ¨ kâ€² , vâ€² âŸ© âˆ· kvs â€– (kâ€²<b âˆ· Ïƒ) with k â‹š kâ€² | k â‹šá´¾ kâ€² | k â‹šá´¸ kâ€²
  â€¦ | [<] | [<] k<kâ€² | [<] = âœ—
  â€¦ | [â‰¡] | [â‰¡] kâ‰¡kâ€² | [â‰¡] rewrite kâ‰¡kâ€² = âœ“
  â€¦ | [>] | [>] k>kâ€² | [>] with k âˆˆ? kvs | k âˆˆ?á´¾ kvs â€– Ïƒ | k âˆˆ?á´¸ kvs â€– Ïƒ
  â€¦ | âœ— | âœ— kâˆ‰kvs | âœ— = âœ—
  â€¦ | âœ“ | âœ“ kâˆˆkvs | âœ“ = âœ“

syntax â‡°[] K V b = K â‡°[ b ] V
â‡°[] : âˆ€ {â„“ â„“Ê³} (K : Set â„“) {{_ : Order â„“Ê³ K}} (V : Set â„“) â†’ add-âŠ¤ K â†’ Set (â„“ âŠ”á´¸ â„“Ê³)
K â‡°[ b ] V = âˆƒá´µ xs â¦‚ list (K âˆ§ V) ğ‘ ğ‘¡ sorted b xs

data _â‡°_ {â„“ â„“Ê³} (K : Set â„“) {{_ : Order â„“Ê³ K}} (V : Set â„“) : Set (â„“ âŠ”á´¸ â„“Ê³) where
  âŸ¨_âŸ© : âˆ€ {b} â†’ K â‡°[ b ] V â†’ K â‡° V

-- data â‡°[] {â„“ â„“Ê³} (A : Set â„“) {{_ : Order â„“Ê³ A}} (B : Set â„“) : add-âŠ¤ A â†’ Set (â„“ âŠ”á´¸ â„“Ê³) where
--   [] : A â‡°[ âŠ¤ ] B
--   _â‹„_â‹„_âˆ·_ : âˆ€ {b} (x : A) â†’ B â†’ âŸ¨ x âŸ© < b â†’ A â‡°[ b ] B â†’ A â‡°[ âŸ¨ x âŸ© ] B

-- data _â‡°_ {â„“ â„“Ê³} (A : Set â„“) {{_ : Order â„“Ê³ A}} (B : Set â„“) : Set (â„“ âŠ”á´¸ â„“Ê³) where
--   FM : âˆ€ {b} â†’ A â‡°[ b ] B â†’ A â‡° B
-- 
-- module _ {â„“ â„“Ê³} {A : Set â„“} {{_ : Order â„“Ê³ A}} {B : Set â„“} where
--   infixr 22 â©Œáµ‡[]
--   infixr 22 â©Œ[]
--   infix 14 âŸ¨_â†¦_âŸ©âˆˆáµ‡_
--   infix 14 âŸ¨_â†¦_âŸ©âˆˆ_
--   infix 14 _â†¦âˆˆáµ‡_
--   infix 14 _â†¦âˆˆ_
--   infix 14 _â†¦âˆ‰áµ‡_
--   infix 14 _â†¦âˆ‰_
-- 
--   syntax â©Œáµ‡[] f xs ys = xs â©Œáµ‡[ f ] ys
--   â©Œáµ‡[] : âˆ€ {bâ‚ bâ‚‚} â†’ (B â†’ B â†’ B) â†’ A â‡°[ bâ‚ ] B â†’ A â‡°[ bâ‚‚ ] B â†’ A â‡°[ bâ‚ â©“ bâ‚‚ ] B
--   â©Œáµ‡[] {.âŠ¤} {bâ‚‚} f [] ys rewrite left-unit[âŠ¤]/â‰¤[ bâ‚‚ ] = ys
--   â©Œáµ‡[] {bâ‚} {.âŠ¤} f xs [] rewrite right-unit[âŠ¤]/â‰¤[ bâ‚ ] = xs
--   â©Œáµ‡[] f (xâ‚ â‹„ yâ‚ â‹„ <â‚ âˆ· xsâ‚) (xâ‚‚ â‹„ yâ‚‚ â‹„ <â‚‚ âˆ· xsâ‚‚) with xâ‚ â‹šá´¾ xâ‚‚
--   â€¦ | [<] xâ‚<xâ‚‚ = {!!} -- xâ‚ â‹„ yâ‚ â‹„ tight[â©“]/<[ add-âŠ¤ A ] <â‚ âŸ¨ xâ‚<xâ‚‚ âŸ© âˆ· (xsâ‚ â©Œáµ‡[ f ] xâ‚‚ â‹„ yâ‚‚ â‹„ <â‚‚ âˆ· xsâ‚‚)
--   â€¦ | [â‰¡] xâ‚â‰¡xâ‚‚ rewrite xâ‚â‰¡xâ‚‚ = {!!} -- xâ‚‚ â‹„ f yâ‚ yâ‚‚ â‹„ tight[â©“]/<[ add-âŠ¤ A ] <â‚ <â‚‚ âˆ· (xsâ‚ â©Œáµ‡[ f ] xsâ‚‚)
--   â€¦ | [>] xâ‚>xâ‚‚ = {!!} -- xâ‚‚ â‹„ yâ‚‚ â‹„ tight[â©“]/<[ add-âŠ¤ A ] âŸ¨ xâ‚>xâ‚‚ âŸ© <â‚‚ âˆ· (xâ‚ â‹„ yâ‚ â‹„ <â‚ âˆ· xsâ‚ â©Œáµ‡[ f ] xsâ‚‚)
-- 
--   _[_]áµ‡ : âˆ€ {b} â†’ A â‡°[ b ] B â†’ A â†’ option B
--   [] [ x ]áµ‡ = None
--   (xâ€² â‹„ yâ€² â‹„ <Ë£ âˆ· xs) [ x ]áµ‡ = {!!}
-- 
--   data âŸ¨_â†¦_âŸ©âˆˆáµ‡_ : âˆ€ {b} â†’ A â†’ B â†’ A â‡°[ b ] B â†’ Set (â„“ âŠ”á´¸ â„“Ê³) where
--     Zero : âˆ€ {x y b <Ë£} {xs : A â‡°[ b ] B}
--       â†’ âŸ¨ x â†¦ y âŸ©âˆˆáµ‡ x â‹„ y â‹„ <Ë£ âˆ· xs
--     Succ : âˆ€ {x y xâ€² yâ€² b <Ë£} {xs : A â‡°[ b ] B}
--       â†’ âŸ¨ x â†¦ y âŸ©âˆˆáµ‡ xs
--       â†’ âŸ¨ x â†¦ y âŸ©âˆˆáµ‡ xâ€² â‹„ yâ€² â‹„ <Ë£ âˆ· xs
--   
--   data _â†¦âˆˆáµ‡_ : âˆ€ {b} â†’ A â†’ A â‡°[ b ] B â†’ Set (â„“ âŠ”á´¸ â„“Ê³) where
--     Zero : âˆ€ {x y b <Ë£} {xs : A â‡°[ b ] B}
--       â†’ x â†¦âˆˆáµ‡ x â‹„ y â‹„ <Ë£ âˆ· xs
--     Succ : âˆ€ {x xâ€² yâ€² b <Ë£} {xs : A â‡°[ b ] B}
--       â†’ x â†¦âˆˆáµ‡ xs
--       â†’ x â†¦âˆˆáµ‡ xâ€² â‹„ yâ€² â‹„ <Ë£ âˆ· xs
-- 
--   data _â†¦âˆ‰áµ‡_ : âˆ€ {b} â†’ A â†’ A â‡°[ b ] B â†’ Set (â„“ âŠ”á´¸ â„“Ê³) where
--     Zero : âˆ€ {x}
--       â†’ x â†¦âˆ‰áµ‡ []
--     Succ : âˆ€ {x xâ€² yâ€² b <Ë£} {xs : A â‡°[ b ] B}
--       â†’ x â‰¢ xâ€²
--       â†’ x â†¦âˆ‰áµ‡ xs
--       â†’ x â†¦âˆ‰áµ‡ (xâ€² â‹„ yâ€² â‹„ <Ë£ âˆ· xs)
-- 
--   dec[âˆˆ]â¸¢fmapâ€²/>â¸£ : âˆ€ {b} x (xs : A â‡°[ b ] B) â†’ âŸ¨ x âŸ© < b â†’ x â†¦âˆ‰áµ‡ xs
--   dec[âˆˆ]â¸¢fmapâ€²/>â¸£ x [] >Ë£ = Zero
--   dec[âˆˆ]â¸¢fmapâ€²/>â¸£ x (xâ€² â‹„ yâ€² â‹„ <Ë£ âˆ· xs) >Ë£ = Succ (Î» xâ‰¡xâ€² â†’ strict[<][ add-âŠ¤ A ] >Ë£ âŸ¨ xRx[â‰¡][â‰¤] (â—‡ xâ‰¡xâ€²) âŸ©) (dec[âˆˆ]â¸¢fmapâ€²/>â¸£ x xs (<Ë£ âŠš >Ë£))
-- 
--   dec[âˆˆ]â¸¢fmapâ€²/â‰¤â¸£ : âˆ€ {b} x (xs : A â‡°[ b ] B) â†’ (âˆƒ y ğ‘ ğ‘¡ âŸ¨ x â†¦ y âŸ©âˆˆáµ‡ xs) âˆ¨ x â†¦âˆ‰áµ‡ xs
--   dec[âˆˆ]â¸¢fmapâ€²/â‰¤â¸£ x [] = Inr Zero
--   dec[âˆˆ]â¸¢fmapâ€²/â‰¤â¸£ x (_â‹„_â‹„_âˆ·_ {b} xâ€² yâ€² <Ë£ xs) with x â‹šá´¾ xâ€²
--   â€¦ | [<] x<xâ€² = Inr (dec[âˆˆ]â¸¢fmapâ€²/>â¸£ x (xâ€² â‹„ yâ€² â‹„ <Ë£ âˆ· xs) âŸ¨ x<xâ€² âŸ©)
--   â€¦ | [â‰¡] xâ‰¡xâ€² rewrite xâ‰¡xâ€² = Inl âˆƒâŸ¨ yâ€² , Zero âŸ©
--   â€¦ | [>] x>xâ€² with âŸ¨ x âŸ© â‹šá´¾ b
--   dec[âˆˆ]â¸¢fmapâ€²/â‰¤â¸£ x (xâ€² â‹„ yâ€² â‹„ <Ë£ âˆ· xs) | [>] x>xâ€² | [<] x<b = Inr (Succ (Î» xâ‰¡xâ€² â†’ strict[<][ A ] x>xâ€² (xRx[â‰¡][â‰¤] xâ‰¡xâ€²)) (dec[âˆˆ]â¸¢fmapâ€²/>â¸£ x xs x<b))
--   dec[âˆˆ]â¸¢fmapâ€²/â‰¤â¸£ x (xâ€² â‹„ yâ€² â‹„ <Ë£â‚ âˆ· (.x â‹„ yâ€²â€² â‹„ <Ë£â‚‚ âˆ· xs)) | [>] x>xâ€² | [â‰¡] â†¯ = Inl âˆƒâŸ¨ yâ€²â€² , Succ Zero âŸ©
--   dec[âˆˆ]â¸¢fmapâ€²/â‰¤â¸£ x (xâ€² â‹„ yâ€² â‹„ <Ë£ âˆ· xs) | [>] x>xâ€² | [>] x>b with dec[âˆˆ]â¸¢fmapâ€²/â‰¤â¸£ x xs
--   â€¦ | Inl âˆƒâŸ¨ y , âˆˆÊ¸ âŸ© = Inl âˆƒâŸ¨ y , Succ âˆˆÊ¸ âŸ©
--   â€¦ | Inr âˆ‰Ë£ = Inr (Succ (Î» xâ‰¡xâ€² â†’ strict[<][ add-âŠ¤ A ] (x>b âŠš <Ë£) âŸ¨ xRx[â‰¡][â‰¤] xâ‰¡xâ€² âŸ©) âˆ‰Ë£)
-- 
-- 
--   syntax â©Œ[] f xs ys = xs â©Œ[ f ] ys
--   â©Œ[] : (B â†’ B â†’ B) â†’ A â‡° B â†’ A â‡° B â†’ A â‡° B
--   â©Œ[] f (FM xs) (FM ys) = FM (xs â©Œáµ‡[ f ] ys)
-- 
--   data âŸ¨_â†¦_âŸ©âˆˆ_ : A â†’ B â†’ A â‡° B â†’ Set (â„“ âŠ”á´¸ â„“Ê³) where
--     FM : âˆ€ {x y b} {xs : A â‡°[ b ] B}
--       â†’ âŸ¨ x â†¦ y âŸ©âˆˆáµ‡ xs
--       â†’ âŸ¨ x â†¦ y âŸ©âˆˆ FM xs
-- 
--   data _â†¦âˆˆ_ : A â†’ A â‡° B â†’ Set (â„“ âŠ”á´¸ â„“Ê³) where
--     FM : âˆ€ {x b} {xs : A â‡°[ b ] B}
--       â†’ x â†¦âˆˆáµ‡ xs
--       â†’ x â†¦âˆˆ FM xs
-- 
--   data _â†¦âˆ‰_ : A â†’ A â‡° B â†’ Set (â„“ âŠ”á´¸ â„“Ê³) where
--     FM : âˆ€ {x b} {xs : A â‡°[ b ] B}
--       â†’ x â†¦âˆ‰áµ‡ xs
--       â†’ x â†¦âˆ‰ FM xs
--   
--   data _â«‘áµ‡_ : âˆ€ {bâ‚ bâ‚‚} â†’ A â‡°[ bâ‚ ] B â†’ A â‡°[ bâ‚‚ ] B â†’ Set (â„“ âŠ”á´¸ â„“Ê³) where
--     [] : âˆ€ {b} {xs : A â‡°[ b ] B} â†’ [] â«‘áµ‡ xs
--     Hit : âˆ€ {x y bâ‚ <Ë£â‚ bâ‚‚ <Ë£â‚‚} {xsâ‚ : A â‡°[ bâ‚ ] B} {xsâ‚‚ : A â‡°[ bâ‚‚ ] B}
--       â†’ xsâ‚ â«‘áµ‡ xsâ‚‚
--       â†’ (x â‹„ y â‹„ <Ë£â‚ âˆ· xsâ‚) â«‘áµ‡ (x â‹„ y â‹„ <Ë£â‚‚ âˆ· xsâ‚‚)
--     Miss : âˆ€ {xâ‚ yâ‚ bâ‚ <Ë£â‚ xâ‚‚ yâ‚‚ bâ‚‚ <Ë£â‚‚} {xsâ‚ : A â‡°[ bâ‚ ] B} {xsâ‚‚ : A â‡°[ bâ‚‚ ] B}
--       â†’ (xâ‚ â‹„ yâ‚ â‹„ <Ë£â‚ âˆ· xsâ‚) â«‘áµ‡ xsâ‚‚
--       â†’ (xâ‚ â‹„ yâ‚ â‹„ <Ë£â‚ âˆ· xsâ‚) â«‘áµ‡ (xâ‚‚ â‹„ yâ‚‚ â‹„ <Ë£â‚‚ âˆ· xsâ‚‚)
-- 
--   data _â«‘â¸¢fmapâ¸£_ : A â‡° B â†’ A â‡° B â†’ Set (â„“ âŠ”á´¸ â„“Ê³) where
--     FM : âˆ€ {bâ‚ bâ‚‚} {xsâ‚ : A â‡°[ bâ‚ ] B} {xsâ‚‚ : A â‡°[ bâ‚‚ ] B}
--       â†’ xsâ‚ â«‘áµ‡ xsâ‚‚
--       â†’ FM xsâ‚ â«‘â¸¢fmapâ¸£ FM xsâ‚‚
-- 
--   âˆ…â¸¢â‡°â¸£ : A â‡° B
--   âˆ…â¸¢â‡°â¸£ = FM []
--   postulate
--     sound[â«‘]áµ‡ : âˆ€ {x bâ‚ bâ‚‚} {xsâ‚ : A â‡°[ bâ‚ ] B} {xsâ‚‚ : A â‡°[ bâ‚‚ ] B} â†’ xsâ‚ â«‘áµ‡ xsâ‚‚ â†’ x â†¦âˆˆáµ‡ xsâ‚ â†’ x â†¦âˆˆáµ‡ xsâ‚‚
--     complete[â«‘]áµ‡ : âˆ€ {bâ‚ bâ‚‚} {xsâ‚ : A â‡°[ bâ‚ ] B} {xsâ‚‚ : A â‡°[ bâ‚‚ ] B} â†’ (âˆ€ {x} â†’ x â†¦âˆˆáµ‡ xsâ‚ â†’ x â†¦âˆˆáµ‡ xsâ‚‚) â†’ xsâ‚ â«‘áµ‡ xsâ‚‚
--     _[_] : A â‡° B â†’ A â†’ option B
--     -- _[_]! : âˆ€ (xs : A â‡° B) (x : A) â†’ (x âˆ‰ xs) âˆ¨ (âˆƒ v ğ‘ ğ‘¡ âŸ¨ x â†¦ v âŸ©âˆˆ xs)
--     unique/âˆˆ : âˆ€ {xs : A â‡° B} {x : A} {y : B} â†’ âŸ¨ x â†¦ y âŸ©âˆˆ xs â†’ xs [ x ] â‰¡ Some y
--     unique/âˆ‰ : âˆ€ {xs : A â‡° B} {x : A} â†’ x â†¦âˆ‰ xs â†’ xs [ x ] â‰¡ None
--     _[_â€–_]â¸¢â‡°â¸£ : âˆ€ (xs : A â‡° B) (x : A) â†’ x â†¦âˆˆ xs â†’ B
--     _[_â†¦_]â¸¢â‡°â¸£ : A â‡° B â†’ A â†’ B â†’ A â‡° B
-- 
--   -- LOH: defein âŸ¨x x âŸ©âˆˆáµ‡[ xs ], give it a better name, and complete sound/complete
