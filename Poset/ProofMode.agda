module Poset.ProofMode where

open import Prelude
open import Poset.Poset
open import Poset.Fun
open import Poset.Classes
open import Poset.Lib

abstract
  âŸ¬_âŸ­ : âˆ€ {â„“} {A : Poset â„“} (x : âŸª A âŸ«) â†’ âŸª A âŸ«
  âŸ¬ x âŸ­ = x

  unfold[âŸ¬_âŸ­] : âˆ€ {â„“} {A : Poset â„“} (x : âŸª A âŸ«) â†’ âŸ¬ x âŸ­ â‰¡ x
  unfold[âŸ¬ x âŸ­] = â†¯

inj[âŸ¬âŸ­] : âˆ€ {â„“} {A : Poset â„“} {x y : âŸª A âŸ«} â†’ âŸ¬ x âŸ­ â‰¡ âŸ¬ y âŸ­ â†’ x â‰¡ y
inj[âŸ¬âŸ­] {x = x} {y} rewrite unfold[âŸ¬ x âŸ­] | unfold[âŸ¬ y âŸ­] = id
  
_â¦‰_â¦Š_â‡°_ : âˆ€ {â„“â‚} â„“â‚‚ {A : Poset â„“â‚} (_R_ : âˆ€ {â„“} {A : Poset â„“} â†’ relation â„“ âŸª A âŸ«) â†’ relation (â„“â‚ âŠ”á´¸ â†‘á´¸ â„“â‚‚) âŸª A âŸ«
_â¦‰_â¦Š_â‡°_ â„“â‚‚ {A} _R_ xâ‚ xâ‚‚ = âˆ€ {B : Poset â„“â‚‚} {y : âŸª B âŸ«} {k : âŸª A â†— B âŸ«} â†’ (k â‹… xâ‚‚) R y â†’ (k â‹… xâ‚) R y 

module ProofMode
  (_R_ : âˆ€ {â„“} {A : Poset â„“} â†’ relation â„“ âŸª A âŸ«)
  {{R-Refl : âˆ€ {â„“} {A : Poset â„“} â†’ Reflexive (_R_ {A = A})}}
  {{R-Transitive : âˆ€ {â„“} {A : Poset â„“} â†’ Transitive (_R_ {A = A})}}
  (res[fx][â†—] :
     âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {B : Poset â„“â‚‚} {f g : âŸª A â†— B âŸ«} {x y : âŸª A âŸ«}
     â†’ f R g â†’ x R y â†’ (f â‹… x) R (g â‹… y))
  (_â¦‰Râ¦Š_â‡°_ : âˆ€ {â„“â‚} â„“â‚‚ {A : Poset â„“â‚} â†’ relation (â„“â‚ âŠ”á´¸ â†‘á´¸ â„“â‚‚) âŸª A âŸ«)
  (mk[â‡°] : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {xâ‚ xâ‚‚ : âŸª A âŸ«} â†’ â„“â‚‚ â¦‰ _R_ â¦Š xâ‚ â‡° xâ‚‚ â†’ â„“â‚‚ â¦‰Râ¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­)
  (un[â‡°] : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {xâ‚ xâ‚‚ : âŸª A âŸ«} â†’ â„“â‚‚ â¦‰Râ¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­ â†’ â„“â‚‚ â¦‰ _R_ â¦Š xâ‚ â‡° xâ‚‚)
  where
  open Logical[â†—] _R_ res[fx][â†—]

  [proof-mode]_âˆ : âˆ€ {â„“} {A : Poset â„“} {xâ‚ xâ‚‚ : âŸª A âŸ«} â†’ â„“ â¦‰Râ¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­ â†’ xâ‚ R xâ‚‚
  [proof-mode] F âˆ = un[â‡°] F {k = idâ™®} (xRx {{R-Refl}})

  infixr 0  _â€£_
  _â€£_ : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {xâ‚ xâ‚‚ xâ‚ƒ : âŸª A âŸ«} â†’ â„“â‚‚ â¦‰Râ¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­ â†’ â„“â‚‚ â¦‰Râ¦Š âŸ¬ xâ‚‚ âŸ­ â‡° âŸ¬ xâ‚ƒ âŸ­ â†’ â„“â‚‚ â¦‰Râ¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚ƒ âŸ­
  _â€£_ G F = mk[â‡°] $ Î» {B} {y} {k} â†’ un[â‡°] G {k = k} âˆ˜ un[â‡°] F {k = k}

  [[_]] : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} (x : âŸª A âŸ«) â†’ â„“â‚‚ â¦‰Râ¦Š âŸ¬ x âŸ­ â‡° âŸ¬ x âŸ­
  [[ x ]] = mk[â‡°] id

  âŸ…_âŸ† : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {xâ‚ xâ‚‚ : âŸª A âŸ«} â†’ xâ‚ R xâ‚‚ â†’ â„“â‚‚ â¦‰Râ¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­
  âŸ… xâ‚Rxâ‚‚ âŸ† = mk[â‡°] $ Î» {B} {y} {k} P â†’ _âŠš_ {{R-Transitive}} P (res[â€¢x][â†—] {f = k} xâ‚Rxâ‚‚)

  âŸ…_âŸ†â¸¢â‰¡â¸£ : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} â†’ {xâ‚ xâ‚‚ : âŸª A âŸ«} (P : xâ‚ â‰¡ xâ‚‚) â†’ â„“â‚‚ â¦‰Râ¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­
  âŸ… xâ‚â‰¡xâ‚‚ âŸ†â¸¢â‰¡â¸£ = âŸ… xRx[â‰¡] xâ‚â‰¡xâ‚‚ âŸ†

  [focus-in_] :
    âˆ€ {â„“â‚ â„“â‚‚ â„“â‚ƒ} {A : Poset â„“â‚} {B : Poset â„“â‚‚} (op : âŸª A â†— B âŸ«) {x : âŸª A âŸ«} {y : âŸª A âŸ«}
    â†’ â„“â‚ƒ â¦‰Râ¦Š âŸ¬ x âŸ­ â‡° âŸ¬ y âŸ­ â†’ â„“â‚ƒ â¦‰Râ¦Š âŸ¬ op â‹… x âŸ­ â‡° âŸ¬ op â‹… y âŸ­
  [focus-in op ] xâ‡°y = mk[â‡°] $ Î» {D} {z} {k} â†’ un[â‡°] xâ‡°y {k = k âˆ˜â™® op}

  [focus-left_ğ‘œğ‘“_] :
    âˆ€ {â„“â‚ â„“â‚‚ â„“â‚ƒ â„“â‚„} {A : Poset â„“â‚} {B : Poset â„“â‚‚} {C : Poset â„“â‚ƒ} (op : âŸª A â†— B â†— C âŸ«) (z : âŸª B âŸ«) {x y : âŸª A âŸ«} 
    â†’ â„“â‚„ â¦‰Râ¦Š âŸ¬ x âŸ­ â‡° âŸ¬ y âŸ­ â†’ â„“â‚„ â¦‰Râ¦Š âŸ¬ op â‹… x â‹… z âŸ­ â‡° âŸ¬ op â‹… y â‹… z âŸ­
  [focus-left op ğ‘œğ‘“ z ] xâ‡°y = mk[â‡°] $ Î» {_ _ k} â†’ un[â‡°] xâ‡°y {k = k âˆ˜â™® flipâ™® â‹… op â‹… z}

  [focus-right_ğ‘œğ‘“_] :
    âˆ€ {â„“â‚ â„“â‚‚ â„“â‚ƒ â„“â‚„} {A : Poset â„“â‚} {B : Poset â„“â‚‚} {C : Poset â„“â‚ƒ} (op : âŸª A â†— B â†— C âŸ«) (z : âŸª A âŸ«) {x y : âŸª B âŸ«}
    â†’ â„“â‚„ â¦‰Râ¦Š âŸ¬ x âŸ­ â‡° âŸ¬ y âŸ­ â†’ â„“â‚„ â¦‰Râ¦Š âŸ¬ op â‹… z â‹… x âŸ­ â‡° âŸ¬ op â‹… z â‹… y âŸ­
  [focus-right op ğ‘œğ‘“ z ] xâ‡°y = mk[â‡°] $ Î» {_ _ k} â†’ un[â‡°] xâ‡°y {k = k âˆ˜â™® op â‹… z}

  module Â§-Reflexive[â‰ˆ]
    {{R-Refl[â‰ˆ] : âˆ€ {â„“} {A : Poset â„“} â†’ Reflexiveá´³ _â‰ˆâ™®_ (_R_ {A = A})}}
    where
    âŸ…_âŸ†â¸¢â‰ˆâ¸£ : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} â†’ {xâ‚ xâ‚‚ : âŸª A âŸ«} (P : xâ‚ â‰ˆâ™® xâ‚‚) â†’ â„“â‚‚ â¦‰Râ¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­
    âŸ… xâ‚â‰ˆxâ‚‚ âŸ†â¸¢â‰ˆâ¸£ = âŸ… xRxá´³ xâ‚â‰ˆxâ‚‚ âŸ†

data _â¦‰âŠ‘â¦Š_â‡°_ {â„“â‚} â„“â‚‚ {A : Poset â„“â‚} : relation (â„“â‚ âŠ”á´¸ â†‘á´¸ â„“â‚‚) âŸª A âŸ« where
  mk[â¦‰âŠ‘â¦Š]-â‰¡ : âˆ€ {xâ‚ xâ‚‚ xâ‚ƒ xâ‚„ : âŸª A âŸ«} â†’ xâ‚ƒ â‰¡ âŸ¬ xâ‚ âŸ­ â†’ xâ‚„ â‰¡ âŸ¬ xâ‚‚ âŸ­ â†’ â„“â‚‚ â¦‰ _âŠ‘â™®_ â¦Š xâ‚ â‡° xâ‚‚ â†’ â„“â‚‚ â¦‰âŠ‘â¦Š xâ‚ƒ â‡° xâ‚„

mk[â¦‰âŠ‘â¦Š] : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {xâ‚ xâ‚‚ : âŸª A âŸ«} â†’ â„“â‚‚ â¦‰ _âŠ‘â™®_ â¦Š xâ‚ â‡° xâ‚‚ â†’ â„“â‚‚ â¦‰âŠ‘â¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­
mk[â¦‰âŠ‘â¦Š] = mk[â¦‰âŠ‘â¦Š]-â‰¡ â†¯ â†¯

un[â¦‰âŠ‘â¦Š] : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {xâ‚ xâ‚‚ : âŸª A âŸ«} â†’ â„“â‚‚ â¦‰âŠ‘â¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­ â†’ â„“â‚‚ â¦‰ _âŠ‘â™®_ â¦Š xâ‚ â‡° xâ‚‚
un[â¦‰âŠ‘â¦Š] (mk[â¦‰âŠ‘â¦Š]-â‰¡ Eâ‚ Eâ‚‚ P) {B} {y} {k} rewrite inj[âŸ¬âŸ­] Eâ‚ | inj[âŸ¬âŸ­] Eâ‚‚ = P {B} {y} {k}

module ProofMode[âŠ‘] where
  open ProofMode _âŠ‘â™®_ res[fx][â†—]â¸¢âŠ‘â¸£ _â¦‰âŠ‘â¦Š_â‡°_ mk[â¦‰âŠ‘â¦Š] un[â¦‰âŠ‘â¦Š] public
  open Â§-Reflexive[â‰ˆ] public

open ProofMode[âŠ‘] using () renaming
  ( [proof-mode]_âˆ     to [proof-mode]â¸¢âŠ‘â¸£_âˆ
  ; _â€£_                to _â€£â¸¢âŠ‘â¸£_
  ; [[_]]              to [[_]]â¸¢âŠ‘â¸£
  ; âŸ…_âŸ†                to âŸ…_âŸ†â¸¢âŠ‘â¸£
  ; âŸ…_âŸ†â¸¢â‰¡â¸£             to âŸ…_âŸ†â¸¢âŠ‘-â‰¡â¸£
  ; [focus-in_]        to [focus-in_]â¸¢âŠ‘â¸£
  ; [focus-left_ğ‘œğ‘“_]   to [focus-left_ğ‘œğ‘“_]â¸¢âŠ‘â¸£
  ; [focus-right_ğ‘œğ‘“_]  to [focus-right_ğ‘œğ‘“_]â¸¢âŠ‘â¸£
  ; âŸ…_âŸ†â¸¢â‰ˆâ¸£             to âŸ…_âŸ†â¸¢âŠ‘-â‰ˆâ¸£
  ) public

data _â¦‰â‰ˆâ¦Š_â‡°_ {â„“â‚} â„“â‚‚ {A : Poset â„“â‚} : relation (â„“â‚ âŠ”á´¸ â†‘á´¸ â„“â‚‚) âŸª A âŸ« where
  mk[â¦‰â‰ˆâ¦Š]-â‰¡ : âˆ€ {xâ‚ xâ‚‚ xâ‚ƒ xâ‚„ : âŸª A âŸ«} â†’ xâ‚ƒ â‰¡ âŸ¬ xâ‚ âŸ­ â†’ xâ‚„ â‰¡ âŸ¬ xâ‚‚ âŸ­ â†’ â„“â‚‚ â¦‰ _â‰ˆâ™®_ â¦Š xâ‚ â‡° xâ‚‚ â†’ â„“â‚‚ â¦‰â‰ˆâ¦Š xâ‚ƒ â‡° xâ‚„

mk[â¦‰â‰ˆâ¦Š] : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {xâ‚ xâ‚‚ : âŸª A âŸ«} â†’ â„“â‚‚ â¦‰ _â‰ˆâ™®_ â¦Š xâ‚ â‡° xâ‚‚ â†’ â„“â‚‚ â¦‰â‰ˆâ¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­
mk[â¦‰â‰ˆâ¦Š] = mk[â¦‰â‰ˆâ¦Š]-â‰¡ â†¯ â†¯

un[â¦‰â‰ˆâ¦Š] : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {xâ‚ xâ‚‚ : âŸª A âŸ«} â†’ â„“â‚‚ â¦‰â‰ˆâ¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­ â†’ â„“â‚‚ â¦‰ _â‰ˆâ™®_ â¦Š xâ‚ â‡° xâ‚‚
un[â¦‰â‰ˆâ¦Š] (mk[â¦‰â‰ˆâ¦Š]-â‰¡ Eâ‚ Eâ‚‚ P) {B} {y} {k} rewrite inj[âŸ¬âŸ­] Eâ‚ | inj[âŸ¬âŸ­] Eâ‚‚ = P {B} {y} {k}

module ProofMode[â‰ˆ] where
  open ProofMode _â‰ˆâ™®_ res[fx][â†—]â¸¢â‰ˆâ¸£ _â¦‰â‰ˆâ¦Š_â‡°_ mk[â¦‰â‰ˆâ¦Š] un[â¦‰â‰ˆâ¦Š] public
open ProofMode[â‰ˆ] using () renaming
  ( [proof-mode]_âˆ    to [proof-mode]â¸¢â‰ˆâ¸£_âˆ
  ; _â€£_                to _â€£â¸¢â‰ˆâ¸£_
  ; [[_]]            to [[_]]â¸¢â‰ˆâ¸£
  ; âŸ…_âŸ†              to âŸ…_âŸ†â¸¢â‰ˆ-â‰ˆâ¸£
  ; âŸ…_âŸ†â¸¢â‰¡â¸£            to âŸ…_âŸ†â¸¢â‰ˆ-â‰¡â¸£
  ; [focus-in_]       to [focus-in_]â¸¢â‰ˆâ¸£
  ; [focus-left_ğ‘œğ‘“_]  to [focus-left_ğ‘œğ‘“_]â¸¢â‰ˆâ¸£
  ; [focus-right_ğ‘œğ‘“_] to [focus-right_ğ‘œğ‘“_]â¸¢â‰ˆâ¸£
  ) public

data _â¦‰â‰¡â¦Š_â‡°_ {â„“â‚} â„“â‚‚ {A : Poset â„“â‚} : relation (â„“â‚ âŠ”á´¸ â†‘á´¸ â„“â‚‚) âŸª A âŸ« where
  mk[â¦‰â‰¡â¦Š]-â‰¡ : âˆ€ {xâ‚ xâ‚‚ xâ‚ƒ xâ‚„ : âŸª A âŸ«} â†’ xâ‚ƒ â‰¡ âŸ¬ xâ‚ âŸ­ â†’ xâ‚„ â‰¡ âŸ¬ xâ‚‚ âŸ­ â†’ â„“â‚‚ â¦‰ _â‰¡_ â¦Š xâ‚ â‡° xâ‚‚ â†’ â„“â‚‚ â¦‰â‰¡â¦Š xâ‚ƒ â‡° xâ‚„

mk[â¦‰â‰¡â¦Š] : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {xâ‚ xâ‚‚ : âŸª A âŸ«} â†’ â„“â‚‚ â¦‰ _â‰¡_ â¦Š xâ‚ â‡° xâ‚‚ â†’ â„“â‚‚ â¦‰â‰¡â¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­
mk[â¦‰â‰¡â¦Š] = mk[â¦‰â‰¡â¦Š]-â‰¡ â†¯ â†¯

un[â¦‰â‰¡â¦Š] : âˆ€ {â„“â‚ â„“â‚‚} {A : Poset â„“â‚} {xâ‚ xâ‚‚ : âŸª A âŸ«} â†’ â„“â‚‚ â¦‰â‰¡â¦Š âŸ¬ xâ‚ âŸ­ â‡° âŸ¬ xâ‚‚ âŸ­ â†’ â„“â‚‚ â¦‰ _â‰¡_ â¦Š xâ‚ â‡° xâ‚‚
un[â¦‰â‰¡â¦Š] (mk[â¦‰â‰¡â¦Š]-â‰¡ Eâ‚ Eâ‚‚ P) {B} {y} {k} rewrite inj[âŸ¬âŸ­] Eâ‚ | inj[âŸ¬âŸ­] Eâ‚‚ = P {B} {y} {k}

module ProofMode[â‰¡] where
  open ProofMode _â‰¡_ res[â€¢xy] _â¦‰â‰¡â¦Š_â‡°_ mk[â¦‰â‰¡â¦Š] un[â¦‰â‰¡â¦Š] public
open ProofMode[â‰¡] using () renaming
  ( [proof-mode]_âˆ     to [proof-mode]â¸¢â‰¡â¸£_âˆ
  ; _â€£_                to _â€£â¸¢â‰¡â¸£_
  ; [[_]]              to [[_]]â¸¢â‰¡â¸£
  ; âŸ…_âŸ†                to âŸ…_âŸ†â¸¢â‰¡-â‰¡â¸£
  ; [focus-in_]        to [focus-in_]â¸¢â‰¡â¸£
  ; [focus-left_ğ‘œğ‘“_]   to [focus-left_ğ‘œğ‘“_]â¸¢â‰¡â¸£
  ; [focus-right_ğ‘œğ‘“_]  to [focus-right_ğ‘œğ‘“_]â¸¢â‰¡â¸£
  ) public
