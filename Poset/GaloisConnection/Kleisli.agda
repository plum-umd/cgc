module Poset.GaloisConnection.Kleisli where

open import Prelude
open import Poset.Poset
open import Poset.Fun
open import Poset.Power
open import Poset.Product
open import Poset.Lib
open import Poset.ProofMode
open import Poset.PowerMonad

open import Poset.GaloisConnection.Classical

infixr 11 _РЄёрхљ_
infixr 11 _РєЌРИбРЄёрхљРИБ_
infixr 30 _РіџРИбРЄёрхљРИБ_

record _РЄёрхљ_ {РёЊ} (A B : Poset РёЊ) : Set (РєЉр┤И РёЊ) where
  field
    ╬▒рхљ[_] : РЪф A РєЌ Рёў B РЪФ
    ╬│рхљ[_] : РЪф B РєЌ Рёў A РЪФ
    extensiveрхљ[_] : returnРЎ« РіЉРЎ« ╬│рхљ[_] РЪљ ╬▒рхљ[_]
    reductiveрхљ[_] : ╬▒рхљ[_] РЪљ ╬│рхљ[_] РіЉРЎ« returnРЎ«
open _РЄёрхљ_ public

РЪдextensiveрхљРЪД : Рѕђ {РёЊ} {A B : Poset РёЊ} {╬▒ : РЪф A РєЌ Рёў B РЪФ} {╬│ : РЪф B РєЌ Рёў A РЪФ} Рєњ returnРЎ« РіЉРЎ« ╬│ РЪљ ╬▒ Рєћ (Рѕђ {x} Рєњ x РІ┐ ╬│ *РЎ« РІЁ (╬▒ РІЁ x))
РЪдextensiveрхљРЪД {A = A} {B} {╬▒} {╬│} = РЪе LHS , RHS РЪЕ
  where
    LHS : returnРЎ« РіЉРЎ« ╬│ РЪљ ╬▒ Рєњ Рѕђ {x} Рєњ x РІ┐ ╬│ *РЎ« РІЁ (╬▒ РІЁ x)
    LHS expansive = ¤ђРѓЂ РЪдreturnРіЉXРЪД $ res[f][РєЌ]РИбРіЉРИБ expansive
    RHS : (Рѕђ {x} Рєњ x РІ┐ ╬│ *РЎ« РІЁ (╬▒ РІЁ x)) Рєњ returnРЎ« РіЉРЎ« ╬│ РЪљ ╬▒
    RHS sound = ext[РєЌ]РИбРіЉРИБ $ ¤ђРѓѓ РЪдreturnРіЉXРЪД sound

РЪдreductiveрхљРЪД : Рѕђ {РёЊ} {A B : Poset РёЊ} {╬▒ : РЪф A РєЌ Рёў B РЪФ} {╬│ : РЪф B РєЌ Рёў A РЪФ} Рєњ ╬▒ РЪљ ╬│ РіЉРЎ« returnРЎ« Рєћ (Рѕђ {xРЎ» yРЎ»} Рєњ yРЎ» РІ┐ ╬▒ *РЎ« РІЁ (╬│ РІЁ xРЎ») Рєњ yРЎ» РіЉРЎ« xРЎ»)
РЪдreductiveрхљРЪД {A = A} {B} {╬▒} {╬│} = РЪе LHS , RHS РЪЕ
  where
    LHS : ╬▒ РЪљ ╬│ РіЉРЎ« returnРЎ« Рєњ Рѕђ {xРЎ» yРЎ»} Рєњ yРЎ» РІ┐ ╬▒ *РЎ« РІЁ (╬│ РІЁ xРЎ») Рєњ yРЎ» РіЉРЎ« xРЎ»
    LHS contractive xРЎ»Рѕѕ╬▒[╬│[yРЎ»]] = ¤ђРѓЂ РЪдreturnРіЉXРЪД $ res[f][РєЌ]РИбРіЉРИБ contractive Ріџ ¤ђРѓѓ РЪдreturnРіЉXРЪД xРЎ»Рѕѕ╬▒[╬│[yРЎ»]]

    RHS : (Рѕђ {xРЎ» yРЎ»} Рєњ yРЎ» РІ┐ ╬▒ *РЎ« РІЁ (╬│ РІЁ xРЎ») Рєњ yРЎ» РіЉРЎ« xРЎ») Рєњ ╬▒ РЪљ ╬│ РіЉРЎ« returnРЎ«
    RHS complete = ext[РєЌ]РИбРіЉРИБ $ ext[Рёў]РИбРіЉРИБ $ complete

soundрхљ[_] : Рѕђ {РёЊ} {A B : Poset РёЊ} (AРЄёB : A РЄёрхљ B) Рєњ Рѕђ {x} Рєњ x РІ┐ ╬│рхљ[ AРЄёB ] *РЎ« РІЁ (╬▒рхљ[ AРЄёB ] РІЁ x)
soundрхљ[ AРЄёB ] = ¤ђРѓЂ РЪдextensiveрхљРЪД extensiveрхљ[ AРЄёB ]

completeрхљ[_] : Рѕђ {РёЊ} {A B : Poset РёЊ} (AРЄёB : A РЄёрхљ B) Рєњ Рѕђ {xРЎ» yРЎ»} Рєњ yРЎ» РІ┐ ╬▒рхљ[ AРЄёB ] *РЎ« РІЁ (╬│рхљ[ AРЄёB ] РІЁ xРЎ») Рєњ yРЎ» РіЉРЎ« xРЎ»
completeрхљ[ AРЄёB ] = ¤ђРѓЂ РЪдreductiveрхљРЪД reductiveрхљ[ AРЄёB ]

left-unit-extensive[РЪљ]рхљ[_] : Рѕђ {РёЊ} {A BРѓЂ BРѓѓ : Poset РёЊ} (РЄёBРЄё : BРѓЂ РЄёрхљ BРѓѓ) {f : РЪф A РєЌ Рёў BРѓЂ РЪФ} Рєњ f РіЉРЎ« (╬│рхљ[ РЄёBРЄё ] РЪљ ╬▒рхљ[ РЄёBРЄё ]) РЪљ f
left-unit-extensive[РЪљ]рхљ[ РЄёBРЄё ] {f} = let open ProofMode[РіЉ] in [proof-mode]
  do [[ f ]]
   РђБ РЪЁ РЌЄ left-unit[РЪљ] РЪєРИбРЅѕРИБ
   РђБ [[ returnРЎ« РЪљ f ]]
   РђБ [focus-left [РЪљ] ­ЮЉю­ЮЉЊ f ] РЪЁ extensiveрхљ[ РЄёBРЄё ] РЪє
   РђБ [[ (╬│рхљ[ РЄёBРЄё ] РЪљ ╬▒рхљ[ РЄёBРЄё ]) РЪљ f ]]
   Рѕј

right-unit-extensive[РЪљ]рхљ[_] : Рѕђ {РёЊ} {AРѓЂ AРѓѓ B : Poset РёЊ} (РЄёAРЄё : AРѓЂ РЄёрхљ AРѓѓ) {f : РЪф AРѓЂ РєЌ Рёў B РЪФ} Рєњ f РіЉРЎ« f РЪљ ╬│рхљ[ РЄёAРЄё ] РЪљ ╬▒рхљ[ РЄёAРЄё ]
right-unit-extensive[РЪљ]рхљ[ РЄёAРЄё ] {f} = let open ProofMode[РіЉ] in [proof-mode]
  do [[ f ]]
   РђБ РЪЁ РЌЄ right-unit[РЪљ] РЪєРИбРЅѕРИБ
   РђБ [[ f РЪљ returnРЎ« ]]
   РђБ [focus-right [РЪљ] ­ЮЉю­ЮЉЊ f ] РЪЁ extensiveрхљ[ РЄёAРЄё ] РЪє
   РђБ [[ f РЪљ ╬│рхљ[ РЄёAРЄё ] РЪљ ╬▒рхљ[ РЄёAРЄё ] ]]
   Рѕј

left-unit-reductive[РЪљ]рхљ[_] : Рѕђ {РёЊ} {A BРѓЂ BРѓѓ : Poset РёЊ} (РЄёBРЄё : BРѓЂ РЄёрхљ BРѓѓ) {f : РЪф A РєЌ Рёў BРѓѓ РЪФ} Рєњ (╬▒рхљ[ РЄёBРЄё ] РЪљ ╬│рхљ[ РЄёBРЄё ]) РЪљ f РіЉРЎ« f
left-unit-reductive[РЪљ]рхљ[ РЄёBРЄё ] {f} = let open ProofMode[РіЉ] in [proof-mode]
  do [[ (╬▒рхљ[ РЄёBРЄё ] РЪљ ╬│рхљ[ РЄёBРЄё ]) РЪљ f ]]
   РђБ [focus-left [РЪљ] ­ЮЉю­ЮЉЊ f ] РЪЁ reductiveрхљ[ РЄёBРЄё ] РЪє
   РђБ [[ returnРЎ« РЪљ f ]]
   РђБ РЪЁ left-unit[РЪљ] РЪєРИбРЅѕРИБ
   РђБ [[ f ]]
   Рѕј

right-unit-reductive[РЪљ]рхљ[_] : Рѕђ {РёЊ} {AРѓЂ AРѓѓ B : Poset РёЊ} (РЄёAРЄё : AРѓЂ РЄёрхљ AРѓѓ) {f : РЪф AРѓѓ РєЌ Рёў B РЪФ} Рєњ f РЪљ ╬▒рхљ[ РЄёAРЄё ] РЪљ ╬│рхљ[ РЄёAРЄё ] РіЉРЎ« f
right-unit-reductive[РЪљ]рхљ[ РЄёAРЄё ] {f} = let open ProofMode[РіЉ] in [proof-mode]
  do [[ f РЪљ ╬▒рхљ[ РЄёAРЄё ] РЪљ ╬│рхљ[ РЄёAРЄё ] ]]
   РђБ [focus-right [РЪљ] ­ЮЉю­ЮЉЊ f ] РЪЁ reductiveрхљ[ РЄёAРЄё ] РЪє
   РђБ [[ f РЪљ returnРЎ« ]]
   РђБ РЪЁ right-unit[РЪљ] РЪєРИбРЅѕРИБ
   РђБ [[ f ]]
   Рѕј

weaken[╬▒]рхљ : Рѕђ {РёЊ} {A B : Poset РёЊ} (AРЄёBРѓЂ AРЄёBРѓѓ : A РЄёрхљ B) Рєњ ╬│рхљ[ AРЄёBРѓѓ ] РіЉРЎ« ╬│рхљ[ AРЄёBРѓЂ ] Рєњ ╬▒рхљ[ AРЄёBРѓЂ ] РіЉРЎ« ╬▒рхљ[ AРЄёBРѓѓ ]
weaken[╬▒]рхљ AРЄёBРѓЂ AРЄёBРѓѓ ╬│РѓѓРіЉ╬│РѓЂ = let open ProofMode[РіЉ] in [proof-mode]
  do [[ ╬▒рхљ[ AРЄёBРѓЂ ] ]]
   РђБ РЪЁ right-unit-extensive[РЪљ]рхљ[ AРЄёBРѓѓ ] РЪє
   РђБ [[ ╬▒рхљ[ AРЄёBРѓЂ ] РЪљ ╬│рхљ[ AРЄёBРѓѓ ] РЪљ ╬▒рхљ[ AРЄёBРѓѓ ] ]]
   РђБ [focus-right [РЪљ] ­ЮЉю­ЮЉЊ ╬▒рхљ[ AРЄёBРѓЂ ] ] $ [focus-left [РЪљ] ­ЮЉю­ЮЉЊ ╬▒рхљ[ AРЄёBРѓѓ ] ] РЪЁ ╬│РѓѓРіЉ╬│РѓЂ РЪє
   РђБ [[ ╬▒рхљ[ AРЄёBРѓЂ ] РЪљ ╬│рхљ[ AРЄёBРѓЂ ] РЪљ ╬▒рхљ[ AРЄёBРѓѓ ] ]]
   РђБ РЪЁ РЌЄ associative[РЪљ] РЪєРИбРЅѕРИБ
   РђБ [[ (╬▒рхљ[ AРЄёBРѓЂ ] РЪљ ╬│рхљ[ AРЄёBРѓЂ ]) РЪљ ╬▒рхљ[ AРЄёBРѓѓ ] ]]
   РђБ РЪЁ left-unit-reductive[РЪљ]рхљ[ AРЄёBРѓЂ ] РЪє
   РђБ [[ ╬▒рхљ[ AРЄёBРѓѓ ] ]]
   Рѕј

unique[╬▒]рхљ : Рѕђ {РёЊ} {A B : Poset РёЊ} (AРЄёBРѓЂ AРЄёBРѓѓ : A РЄёрхљ B) Рєњ ╬│рхљ[ AРЄёBРѓЂ ] РЅѕРЎ« ╬│рхљ[ AРЄёBРѓѓ ] Рєњ ╬▒рхљ[ AРЄёBРѓЂ ] РЅѕРЎ« ╬▒рхљ[ AРЄёBРѓѓ ]
unique[╬▒]рхљ AРЄёBРѓЂ AРЄёBРѓѓ ╬│РѓЂРЅѕ╬│Рѓѓ = РІѕр┤│ (weaken[╬▒]рхљ AРЄёBРѓЂ AРЄёBРѓѓ $ xRxр┤│ $ РЌЄ ╬│РѓЂРЅѕ╬│Рѓѓ) (weaken[╬▒]рхљ AРЄёBРѓѓ AРЄёBРѓЂ $ xRxр┤│ ╬│РѓЂРЅѕ╬│Рѓѓ)

weaken[╬│]рхљ : Рѕђ {РёЊ} {A B : Poset РёЊ} (AРЄёBРѓЂ AРЄёBРѓѓ : A РЄёрхљ B) Рєњ ╬▒рхљ[ AРЄёBРѓѓ ] РіЉРЎ« ╬▒рхљ[ AРЄёBРѓЂ ] Рєњ ╬│рхљ[ AРЄёBРѓЂ ] РіЉРЎ« ╬│рхљ[ AРЄёBРѓѓ ]
weaken[╬│]рхљ AРЄёBРѓЂ AРЄёBРѓѓ ╬▒РѓѓРіЉ╬▒РѓЂ = let open ProofMode[РіЉ] in [proof-mode]
  do [[ ╬│рхљ[ AРЄёBРѓЂ ] ]]
   РђБ РЪЁ left-unit-extensive[РЪљ]рхљ[ AРЄёBРѓѓ ] РЪє
   РђБ [[ (╬│рхљ[ AРЄёBРѓѓ ] РЪљ ╬▒рхљ[ AРЄёBРѓѓ ]) РЪљ ╬│рхљ[ AРЄёBРѓЂ ] ]]
   РђБ [focus-left [РЪљ] ­ЮЉю­ЮЉЊ ╬│рхљ[ AРЄёBРѓЂ ] ] $ [focus-right [РЪљ] ­ЮЉю­ЮЉЊ ╬│рхљ[ AРЄёBРѓѓ ] ] РЪЁ ╬▒РѓѓРіЉ╬▒РѓЂ РЪє
   РђБ [[ (╬│рхљ[ AРЄёBРѓѓ ] РЪљ ╬▒рхљ[ AРЄёBРѓЂ ]) РЪљ ╬│рхљ[ AРЄёBРѓЂ ] ]]
   РђБ РЪЁ associative[РЪљ] РЪєРИбРЅѕРИБ
   РђБ [[ ╬│рхљ[ AРЄёBРѓѓ ] РЪљ ╬▒рхљ[ AРЄёBРѓЂ ] РЪљ ╬│рхљ[ AРЄёBРѓЂ ] ]]
   РђБ РЪЁ right-unit-reductive[РЪљ]рхљ[ AРЄёBРѓЂ ] РЪє
   РђБ [[ ╬│рхљ[ AРЄёBРѓѓ ] ]]
   Рѕј

unique[╬│]рхљ : Рѕђ {РёЊ} {A B : Poset РёЊ} (AРЄёBРѓЂ AРЄёBРѓѓ : A РЄёрхљ B) Рєњ ╬▒рхљ[ AРЄёBРѓЂ ] РЅѕРЎ« ╬▒рхљ[ AРЄёBРѓѓ ] Рєњ ╬│рхљ[ AРЄёBРѓЂ ] РЅѕРЎ« ╬│рхљ[ AРЄёBРѓѓ ]
unique[╬│]рхљ AРЄёBРѓЂ AРЄёBРѓѓ ╬▒РѓЂРЅѕ╬▒Рѓѓ = РІѕр┤│ (weaken[╬│]рхљ AРЄёBРѓЂ AРЄёBРѓѓ $ xRxр┤│ $ РЌЄ ╬▒РѓЂРЅѕ╬▒Рѓѓ) (weaken[╬│]рхљ AРЄёBРѓѓ AРЄёBРѓЂ $ xRxр┤│ ╬▒РѓЂРЅѕ╬▒Рѓѓ)

_РіџРИбРЄёрхљРИБ_ : Рѕђ {РёЊ} {A B C : Poset РёЊ} Рєњ B РЄёрхљ C Рєњ A РЄёрхљ B Рєњ A РЄёрхљ C
BРЄёC РіџРИбРЄёрхљРИБ AРЄёB = record
  { ╬▒рхљ[_] = ╬▒рхљ[ BРЄёC ] РЪљ ╬▒рхљ[ AРЄёB ]
  ; ╬│рхљ[_] = ╬│рхљ[ AРЄёB ] РЪљ ╬│рхљ[ BРЄёC ]
  ; extensiveрхљ[_] = let open ProofMode[РіЉ] in [proof-mode]
      do [[ returnРЎ« ]]
       РђБ РЪЁ extensiveрхљ[ AРЄёB ] РЪє
       РђБ [[ ╬│рхљ[ AРЄёB ] РЪљ ╬▒рхљ[ AРЄёB ] ]]
       РђБ [focus-left [РЪљ] ­ЮЉю­ЮЉЊ ╬▒рхљ[ AРЄёB ] ] begin
           do [[ ╬│рхљ[ AРЄёB ] ]]
            РђБ РЪЁ right-unit-extensive[РЪљ]рхљ[ BРЄёC ] РЪє
            РђБ [[ ╬│рхљ[ AРЄёB ] РЪљ (╬│рхљ[ BРЄёC ] РЪљ ╬▒рхљ[ BРЄёC ]) ]]
            РђБ РЪЁ РЌЄ associative[РЪљ] РЪєРИбРЅѕРИБ
            РђБ [[ (╬│рхљ[ AРЄёB ] РЪљ ╬│рхљ[ BРЄёC ]) РЪљ ╬▒рхљ[ BРЄёC ] ]]
           end
       РђБ [[ ((╬│рхљ[ AРЄёB ] РЪљ ╬│рхљ[ BРЄёC ]) РЪљ ╬▒рхљ[ BРЄёC ]) РЪљ ╬▒рхљ[ AРЄёB ] ]]
       РђБ РЪЁ associative[РЪљ] РЪєРИбРЅѕРИБ
       РђБ [[ (╬│рхљ[ AРЄёB ] РЪљ ╬│рхљ[ BРЄёC ]) РЪљ (╬▒рхљ[ BРЄёC ] РЪљ ╬▒рхљ[ AРЄёB ]) ]]
       Рѕј
  ; reductiveрхљ[_] = let open ProofMode[РіЉ] in [proof-mode]
      do [[ (╬▒рхљ[ BРЄёC ] РЪљ ╬▒рхљ[ AРЄёB ]) РЪљ (╬│рхљ[ AРЄёB ] РЪљ ╬│рхљ[ BРЄёC ]) ]]
       РђБ РЪЁ РЌЄ associative[РЪљ] РЪєРИбРЅѕРИБ
       РђБ [[ ((╬▒рхљ[ BРЄёC ] РЪљ ╬▒рхљ[ AРЄёB ]) РЪљ ╬│рхљ[ AРЄёB ]) РЪљ ╬│рхљ[ BРЄёC ] ]]
       РђБ [focus-left [РЪљ] ­ЮЉю­ЮЉЊ ╬│рхљ[ BРЄёC ] ] begin
           do [[ (╬▒рхљ[ BРЄёC ] РЪљ ╬▒рхљ[ AРЄёB ]) РЪљ ╬│рхљ[ AРЄёB ] ]]
            РђБ РЪЁ associative[РЪљ] РЪєРИбРЅѕРИБ
            РђБ [[ ╬▒рхљ[ BРЄёC ] РЪљ ╬▒рхљ[ AРЄёB ] РЪљ ╬│рхљ[ AРЄёB ] ]]
            РђБ РЪЁ right-unit-reductive[РЪљ]рхљ[ AРЄёB ] РЪє
            РђБ [[ ╬▒рхљ[ BРЄёC ] ]]
           end
       РђБ [[ ╬▒рхљ[ BРЄёC ] РЪљ ╬│рхљ[ BРЄёC ] ]]
       РђБ РЪЁ reductiveрхљ[ BРЄёC ] РЪє
       РђБ [[ returnРЎ« ]]
       Рѕј
  }

_РєЌРИбРЄёрхљРИБ_ : Рѕђ {РёЊ} {AРѓЂ AРѓѓ BРѓЂ BРѓѓ : Poset РёЊ} Рєњ AРѓЂ РЄёрхљ AРѓѓ Рєњ BРѓЂ РЄёрхљ BРѓѓ Рєњ (AРѓЂ РєЌ Рёў BРѓЂ) РЄё (AРѓѓ РєЌ Рёў BРѓѓ)
_РєЌРИбРЄёрхљРИБ_ {AРѓЂ = AРѓЂ} {AРѓѓ} {BРѓЂ} {BРѓѓ} РЄёAРЄё РЄёBРЄё = record
  { ╬▒[_] = wrap[РЪљ] РІЁ ╬▒рхљ[ РЄёBРЄё ] РІЁ ╬│рхљ[ РЄёAРЄё ]
  ; ╬│[_] = wrap[РЪљ] РІЁ ╬│рхљ[ РЄёBРЄё ] РІЁ ╬▒рхљ[ РЄёAРЄё ]
  ; extensive[_] = ext[РєЌ]РИбРіЉРИБ $ ╬╗ {f} Рєњ let open ProofMode[РіЉ] in [proof-mode]
      do [[ f ]]
       РђБ РЪЁ left-unit-extensive[РЪљ]рхљ[ РЄёBРЄё ] РЪє
       РђБ [[ (╬│рхљ[ РЄёBРЄё ] РЪљ ╬▒рхљ[ РЄёBРЄё ]) РЪљ f ]]
       РђБ РЪЁ associative[РЪљ] РЪєРИбРЅѕРИБ
       РђБ [[ ╬│рхљ[ РЄёBРЄё ] РЪљ ╬▒рхљ[ РЄёBРЄё ] РЪљ f ]]
       РђБ РЪЁ right-unit-extensive[РЪљ]рхљ[ РЄёAРЄё ] РЪє
       РђБ [[ (╬│рхљ[ РЄёBРЄё ] РЪљ ╬▒рхљ[ РЄёBРЄё ] РЪљ f) РЪљ ╬│рхљ[ РЄёAРЄё ] РЪљ ╬▒рхљ[ РЄёAРЄё ] ]]
       РђБ РЪЁ associative[РЪљ] РЪєРИбРЅѕРИБ
       РђБ [[ ╬│рхљ[ РЄёBРЄё ] РЪљ (╬▒рхљ[ РЄёBРЄё ] РЪљ f) РЪљ ╬│рхљ[ РЄёAРЄё ] РЪљ ╬▒рхљ[ РЄёAРЄё ] ]]
       РђБ [focus-right [РЪљ] ­ЮЉю­ЮЉЊ ╬│рхљ[ РЄёBРЄё ] ] begin
           do [[ (╬▒рхљ[ РЄёBРЄё ] РЪљ f) РЪљ ╬│рхљ[ РЄёAРЄё ] РЪљ ╬▒рхљ[ РЄёAРЄё ] ]]
            РђБ РЪЁ РЌЄ associative[РЪљ] РЪєРИбРЅѕРИБ
            РђБ [[ ((╬▒рхљ[ РЄёBРЄё ] РЪљ f) РЪљ ╬│рхљ[ РЄёAРЄё ]) РЪљ ╬▒рхљ[ РЄёAРЄё ] ]]
            РђБ [focus-left [РЪљ] ­ЮЉю­ЮЉЊ ╬▒рхљ[ РЄёAРЄё ] ] РЪЁ associative[РЪљ] РЪєРИбРЅѕРИБ
            РђБ [[ (╬▒рхљ[ РЄёBРЄё ] РЪљ f РЪљ ╬│рхљ[ РЄёAРЄё ]) РЪљ ╬▒рхљ[ РЄёAРЄё ] ]]
           end
       РђБ [[ ╬│рхљ[ РЄёBРЄё ] РЪљ (╬▒рхљ[ РЄёBРЄё ] РЪљ f РЪљ ╬│рхљ[ РЄёAРЄё ]) РЪљ ╬▒рхљ[ РЄёAРЄё ] ]]
       РђБ [[ (wrap[РЪљ] РІЁ ╬│рхљ[ РЄёBРЄё ] РІЁ ╬▒рхљ[ РЄёAРЄё ] РѕўРЎ« wrap[РЪљ] РІЁ ╬▒рхљ[ РЄёBРЄё ] РІЁ ╬│рхљ[ РЄёAРЄё ]) РІЁ f ]]
       Рѕј
  ; reductive[_] = ext[РєЌ]РИбРіЉРИБ $ ╬╗ {f} Рєњ let open ProofMode[РіЉ] in [proof-mode]
      do [[ (wrap[РЪљ] РІЁ ╬▒рхљ[ РЄёBРЄё ] РІЁ ╬│рхљ[ РЄёAРЄё ] РѕўРЎ« wrap[РЪљ] РІЁ ╬│рхљ[ РЄёBРЄё ] РІЁ ╬▒рхљ[ РЄёAРЄё ]) РІЁ f ]]
       РђБ [[ ╬▒рхљ[ РЄёBРЄё ] РЪљ (╬│рхљ[ РЄёBРЄё ] РЪљ f РЪљ ╬▒рхљ[ РЄёAРЄё ]) РЪљ ╬│рхљ[ РЄёAРЄё ] ]]
       РђБ [focus-right [РЪљ] ­ЮЉю­ЮЉЊ ╬▒рхљ[ РЄёBРЄё ] ] begin
           do [[ (╬│рхљ[ РЄёBРЄё ] РЪљ f РЪљ ╬▒рхљ[ РЄёAРЄё ]) РЪљ ╬│рхљ[ РЄёAРЄё ] ]]
            РђБ РЪЁ associative[РЪљ] РЪєРИбРЅѕРИБ
            РђБ [[ ╬│рхљ[ РЄёBРЄё ] РЪљ (f РЪљ ╬▒рхљ[ РЄёAРЄё ]) РЪљ ╬│рхљ[ РЄёAРЄё ] ]]
            РђБ [focus-right [РЪљ] ­ЮЉю­ЮЉЊ ╬│рхљ[ РЄёBРЄё ] ] begin
                do [[ (f РЪљ ╬▒рхљ[ РЄёAРЄё ]) РЪљ ╬│рхљ[ РЄёAРЄё ] ]]
                 РђБ РЪЁ associative[РЪљ] РЪєРИбРЅѕРИБ
                 РђБ [[ f РЪљ ╬▒рхљ[ РЄёAРЄё ] РЪљ ╬│рхљ[ РЄёAРЄё ] ]]
                 РђБ РЪЁ right-unit-reductive[РЪљ]рхљ[ РЄёAРЄё ] РЪє
                 РђБ [[ f ]]
                end
           end
       РђБ [[ ╬▒рхљ[ РЄёBРЄё ] РЪљ ╬│рхљ[ РЄёBРЄё ] РЪљ f ]]
       РђБ РЪЁ РЌЄ associative[РЪљ] РЪєРИбРЅѕРИБ
       РђБ [[ (╬▒рхљ[ РЄёBРЄё ] РЪљ ╬│рхљ[ РЄёBРЄё ]) РЪљ f ]]
       РђБ РЪЁ left-unit-reductive[РЪљ]рхљ[ РЄёBРЄё ] РЪє
       РђБ [[ f ]]
       Рѕј
  }

-- infixr 4 _╬▒РЄё╬│рхљРИбРЎ«РИБ_
-- record _╬▒РЄё╬│рхљРИбРЎ«РИБ_ {РёЊ} (A B : Set РёЊ) {{A-PO : PreOrder РёЊ A}} {{B-PO : PreOrder РёЊ B}} : Set (РєЉр┤И РёЊ) where
--   field
--     ╬▒рхљРИбРЎ«РИБ : A Рєњ B Рєњ Set РёЊ
--     monotonic[╬▒рхљРИбРЎ«РИБ] : proper (_Рі┤_ РЄЅ _Ріх_ РЄЅ [Рєњ]) ╬▒рхљРИбРЎ«РИБ
--     ╬│рхљРИбРЎ«РИБ : B Рєњ A Рєњ Set РёЊ
--     monotonic[╬│рхљРИбРЎ«РИБ] : proper (_Рі┤_ РЄЅ _Ріх_ РЄЅ [Рєњ]) ╬│рхљРИбРЎ«РИБ
--     sound[╬▒╬│рхљ]РИбРЎ«РИБ : Рѕђ {x : A} Рєњ РѕЃ x^ ­ЮЉа­ЮЉА ╬▒рхљРИбРЎ«РИБ x x^ ├Ќ ╬│рхљРИбРЎ«РИБ x^ x
--     complete[╬▒╬│рхљ]РИбРЎ«РИБ : Рѕђ {xРѓЂ^ xРѓѓ^ x} Рєњ ╬│рхљРИбРЎ«РИБ xРѓЂ^ x Рєњ ╬▒рхљРИбРЎ«РИБ x xРѓѓ^ Рєњ xРѓѓ^ Рі┤ xРѓЂ^
-- 
-- mk[╬▒РЄё╬│рхљ]РИбРЎ«РИБ :
--   Рѕђ {РёЊ} {A B : Set РёЊ}
--     {{A-PO : PreOrder РёЊ A}} {{A-REX : Reflexive (_Рі┤_ {A = A})}}
--     {{B-PO : PreOrder РёЊ B}} {{B-REX : Reflexive (_Рі┤_ {A = B})}}
--   Рєњ A ╬▒РЄё╬│рхљРИбРЎ«РИБ B Рєњ РЄД A ╬▒РЄё╬│рхљ РЄД B
-- mk[╬▒РЄё╬│рхљ]РИбРЎ«РИБ {A = A} {B} AРЄёB = record
--   { ╬▒рхљ[_] = ╬▒
--   ; ╬│рхљ[_] = ╬│
--   ; extensiveрхљ[_] = ¤ђРѓѓ РЪдextensiveрхљРЪД $ ╬╗ {x} Рєњ sound {x}
--   ; reductiveрхљ[_] = ¤ђРѓѓ РЪдreductiveрхљРЪД complete
--   }
--   where
--     open _╬▒РЄё╬│рхљРИбРЎ«РИБ_ AРЄёB
--     ╬▒ : РЪф РЄД A РєЌ Рёў (РЄД B) РЪФ
--     ╬▒ = witness (curryРИб╬╗РЎ«РИБ idРИб¤ЅРЎ«РИБ) $ mk[witness] ╬▒рхљРИбРЎ«РИБ monotonic[╬▒рхљРИбРЎ«РИБ]
--     ╬│ : РЪф РЄД B РєЌ Рёў (РЄД A) РЪФ
--     ╬│ = witness (curryРИб╬╗РЎ«РИБ idРИб¤ЅРЎ«РИБ) $ mk[witness] ╬│рхљРИбРЎ«РИБ monotonic[╬│рхљРИбРЎ«РИБ]
--     sound : Рѕђ {x} Рєњ x РІ┐ ╬│ * РІЁ (╬▒ РІЁ x)
--     sound {РЎ«РЪе x РЪЕ} with sound[╬▒╬│рхљ]РИбРЎ«РИБ {x}
--     ... | РѕЃ x^ ,, x^Рѕѕ╬▒[x] , xРѕѕ╬│[x^]  = РѕЃРёў РЎ« x^ ,, x^Рѕѕ╬▒[x] ,, xРѕѕ╬│[x^]
--     complete : Рѕђ {x^ y^} Рєњ x^ РІ┐ ╬▒ * РІЁ (╬│ РІЁ y^) Рєњ x^ РіЉ y^
--     complete (РѕЃРёў x ,, xРѕѕ╬│[x^] ,, y^Рѕѕ╬▒[x]) = intro[РіЉРЎГ] $ complete[╬▒╬│рхљ]РИбРЎ«РИБ xРѕѕ╬│[x^] y^Рѕѕ╬▒[x]
-- 
-- xRxРИб╬▒РЄё╬│рхљРИБ : Рѕђ {РёЊ} {A : Poset РёЊ} Рєњ A ╬▒РЄё╬│рхљ A
-- xRxРИб╬▒РЄё╬│рхљРИБ = record
--   { ╬▒рхљ[_] = return
--   ; ╬│рхљ[_] = return
--   ; extensiveрхљ[_] = xRx[] $ РЌЄ left-unit[РЪљ]
--   ; reductiveрхљ[_] = xRx[] left-unit[РЪљ]
--   }
-- 
-- ╬▒РЄё╬│рхљРєњ╬▒РЄё╬│ : Рѕђ {РёЊ} {A B : Poset РёЊ} Рєњ A ╬▒РЄё╬│рхљ B Рєњ Рёў A ╬▒РЄё╬│ Рёў B
-- ╬▒РЄё╬│рхљРєњ╬▒РЄё╬│ AРЄёB = record
--   { ╬▒[_] = ╬▒рхљ[ AРЄёB ] *
--   ; ╬│[_] = ╬│рхљ[ AРЄёB ] *
--   ; extensive[_] = let open ProofMode[РіЉ] in [proof-mode]
--       do [[ idрхњ ]]
--        РђБ РЪЁ РЌЄ left-unit[*/ext] РЪєРИбРЅѕРИБ
--        РђБ [[ return * ]]
--        РђБ [focus-in [*] ] РЪЁ extensiveрхљ[ AРЄёB ] РЪє
--        РђБ [[ (╬│рхљ[ AРЄёB ] РЪљ ╬▒рхљ[ AРЄёB ]) * ]]
--        РђБ РЪЁ associative[РЪљ]РИбРѕўРЎ«РИБ РЪєРИбРЅѕРИБ
--        РђБ [[ ╬│рхљ[ AРЄёB ] * РѕўРЎ« ╬▒рхљ[ AРЄёB ] * ]]
--        Рѕј
--   ; reductive[_] = let open ProofMode[РіЉ] in [proof-mode]
--       do [[ ╬▒рхљ[ AРЄёB ] * РѕўРЎ« ╬│рхљ[ AРЄёB ] * ]]
--        РђБ РЪЁ РЌЄ associative[РЪљ]РИбРѕўРЎ«РИБ РЪєРИбРЅѕРИБ
--        РђБ [[ (╬▒рхљ[ AРЄёB ] РЪљ ╬│рхљ[ AРЄёB ]) * ]]
--        РђБ [focus-in [*] ] РЪЁ reductiveрхљ[ AРЄёB ] РЪє
--        РђБ [[ return * ]]
--        РђБ РЪЁ left-unit[*/ext] РЪєРИбРЅѕРИБ
--        РђБ [[ idрхњ ]]
--        Рѕј
--   }
-- 
-- _├ЌРИб╬▒РЄё╬│рхљРИБ_ : Рѕђ {РёЊ} {AРѓЂ AРѓѓ BРѓЂ BРѓѓ : Poset РёЊ} Рєњ AРѓЂ ╬▒РЄё╬│рхљ BРѓЂ Рєњ AРѓѓ ╬▒РЄё╬│рхљ BРѓѓ Рєњ (AРѓЂ РЪе├ЌРЪЕ AРѓѓ) ╬▒РЄё╬│рхљ (BРѓЂ РЪе├ЌРЪЕ BРѓѓ)
-- _├ЌРИб╬▒РЄё╬│рхљРИБ_ {РёЊ} {AРѓЂ} {AРѓѓ} {BРѓЂ} {BРѓѓ} AРѓЂРЄёBРѓЂ AРѓѓРЄёBРѓѓ = mk[╬▒РЄё╬│рхљ]РИбРЎ«РИБ $ record
--   { ╬▒рхљРИбРЎ«РИБ = ╬▒
--   ; monotonic[╬▒рхљРИбРЎ«РИБ] = monotonic[╬▒]
--   ; ╬│рхљРИбРЎ«РИБ = ╬│
--   ; monotonic[╬│рхљРИбРЎ«РИБ] = monotonic[╬│]
--   ; sound[╬▒╬│рхљ]РИбРЎ«РИБ = sound
--   ; complete[╬▒╬│рхљ]РИбРЎ«РИБ = complete
--   }
--   where
--     ╬▒ : prod AРѓЂ AРѓѓ Рєњ prod BРѓЂ BРѓѓ Рєњ Set РёЊ
--     ╬▒ (x , y) (x^ , y^) = (x^ РІ┐ ╬▒рхљ[ AРѓЂРЄёBРѓЂ ] РІЁ x) ├Ќ (y^ РІ┐ ╬▒рхљ[ AРѓѓРЄёBРѓѓ ] РІЁ y)
--     abstract
--       monotonic[╬▒] : proper (_Рі┤_ РЄЅ _Ріх_ РЄЅ [Рєњ]) ╬▒
--       monotonic[╬▒] (xРѓЂРіЉxРѓѓ , yРѓЂРіЉyРѓѓ) (xРѓЂ^РіњxРѓѓ^ , yРѓЂ^РіњyРѓѓ^) (xРѓЂ^Рѕѕ╬▒[xРѓЂ] , yРѓЂ^Рѕѕ╬▒[yРѓЂ]) =
--           res-X-x[¤Ѕ]РИбРіЉРИБ (res-x[╬╗]РИбРіЉРИБ {f = ╬▒рхљ[ AРѓЂРЄёBРѓЂ ]} xРѓЂРіЉxРѓѓ) xРѓЂ^РіњxРѓѓ^ xРѓЂ^Рѕѕ╬▒[xРѓЂ]
--         , res-X-x[¤Ѕ]РИбРіЉРИБ (res-x[╬╗]РИбРіЉРИБ {f = ╬▒рхљ[ AРѓѓРЄёBРѓѓ ]} yРѓЂРіЉyРѓѓ) yРѓЂ^РіњyРѓѓ^ yРѓЂ^Рѕѕ╬▒[yРѓЂ]
--     ╬│ : prod BРѓЂ BРѓѓ Рєњ prod AРѓЂ AРѓѓ Рєњ Set РёЊ
--     ╬│ (x^ , y^) (x , y) = (x РІ┐ ╬│рхљ[ AРѓЂРЄёBРѓЂ ] РІЁ x^) ├Ќ (y РІ┐ ╬│рхљ[ AРѓѓРЄёBРѓѓ ] РІЁ y^)
--     abstract
--       monotonic[╬│] : proper (_Рі┤_ РЄЅ _Ріх_ РЄЅ [Рєњ]) ╬│
--       monotonic[╬│] (xРѓЂ^РіЉxРѓѓ^ , yРѓЂ^РіЉyРѓѓ^) (xРѓЂРіњxРѓѓ , yРѓЂРіњyРѓѓ) (xРѓЂРѕѕ╬│[xРѓЂ^] , yРѓЂРѕѕ╬│[yРѓЂ^]) =
--           res-X-x[¤Ѕ]РИбРіЉРИБ (res-x[╬╗]РИбРіЉРИБ {f = ╬│рхљ[ AРѓЂРЄёBРѓЂ ]} xРѓЂ^РіЉxРѓѓ^) xРѓЂРіњxРѓѓ xРѓЂРѕѕ╬│[xРѓЂ^]
--         , res-X-x[¤Ѕ]РИбРіЉРИБ (res-x[╬╗]РИбРіЉРИБ {f = ╬│рхљ[ AРѓѓРЄёBРѓѓ ]} yРѓЂ^РіЉyРѓѓ^) yРѓЂРіњyРѓѓ yРѓЂРѕѕ╬│[yРѓЂ^]
--     sound : Рѕђ {xy : prod AРѓЂ AРѓѓ} Рєњ РѕЃ xy^ ­ЮЉа­ЮЉА ╬▒ xy xy^ ├Ќ ╬│ xy^ xy
--     sound {x , y} with soundрхљ[ AРѓЂРЄёBРѓЂ ] {x} | soundрхљ[ AРѓѓРЄёBРѓѓ ] {y}
--     ... | РѕЃРёў x^ ,, x^Рѕѕ╬▒[x] ,, xРѕѕ╬│[x^] | РѕЃРёў y^ ,, yРѕѕ╬▒[y^] ,, y^Рѕѕ╬│[y] = РѕЃ (x^ , y^) ,, (x^Рѕѕ╬▒[x] , yРѕѕ╬▒[y^]) , (xРѕѕ╬│[x^] , y^Рѕѕ╬│[y])
--     complete : Рѕђ {xyРѓЂ^ xyРѓѓ^ : prod BРѓЂ BРѓѓ} {xy : prod AРѓЂ AРѓѓ} Рєњ ╬│ xyРѓЂ^ xy Рєњ ╬▒ xy xyРѓѓ^ Рєњ xyРѓѓ^ Рі┤ xyРѓЂ^
--     complete {xРѓЂ^ , yРѓЂ^} {xРѓѓ^ , yРѓѓ^} {x , y} (xРѕѕ╬│[xРѓЂ^] , yРѕѕ╬│[yРѓЂ^]) (xРѓѓ^Рѕѕ╬▒[x] , yРѓѓ^Рѕѕ╬▒[y]) =
--         (completeрхљ[ AРѓЂРЄёBРѓЂ ] $ РѕЃРёў x ,, xРѕѕ╬│[xРѓЂ^] ,, xРѓѓ^Рѕѕ╬▒[x])
--       , (completeрхљ[ AРѓѓРЄёBРѓѓ ] $ РѕЃРёў y ,, yРѕѕ╬│[yРѓЂ^] ,, yРѓѓ^Рѕѕ╬▒[y])
