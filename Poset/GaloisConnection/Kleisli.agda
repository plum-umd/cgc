module Poset.GaloisConnection.Kleisli where

open import Prelude
open import Poset.Poset
open import Poset.Fun
open import Poset.Power
open import Poset.Product
open import Poset.Lib
open import Poset.ProofMode
open import Poset.PowerMonad

open import Poset.GaloisConnection.Classical

infixr 11 _â‡„áµ_
infixr 11 _â†—â¸¢â‡„áµâ¸£_
infixr 30 _âŠšâ¸¢â‡„áµâ¸£_

record _â‡„áµ_ {â„“} (A B : Poset â„“) : Set (â†‘á´¸ â„“) where
  field
    Î±áµ[_] : âŸª A â†— â„˜ B âŸ«
    Î³áµ[_] : âŸª B â†— â„˜ A âŸ«
    extensiveáµ[_] : returnâ™® âŠ‘â™® Î³áµ[_] âŸ Î±áµ[_]
    reductiveáµ[_] : Î±áµ[_] âŸ Î³áµ[_] âŠ‘â™® returnâ™®
open _â‡„áµ_ public

âŸ¦extensiveáµâŸ§ : âˆ€ {â„“} {A B : Poset â„“} {Î± : âŸª A â†— â„˜ B âŸ«} {Î³ : âŸª B â†— â„˜ A âŸ«} â†’ returnâ™® âŠ‘â™® Î³ âŸ Î± â†” (âˆ€ {x} â†’ x â‹¿ Î³ *â™® â‹… (Î± â‹… x))
âŸ¦extensiveáµâŸ§ {A = A} {B} {Î±} {Î³} = LHS , RHS
  where
    LHS : returnâ™® âŠ‘â™® Î³ âŸ Î± â†’ âˆ€ {x} â†’ x â‹¿ Î³ *â™® â‹… (Î± â‹… x)
    LHS expansive = Ï€â‚ âŸ¦returnâŠ‘XâŸ§ $ res[f]â¸¢âŠ‘â†—â¸£ expansive
    RHS : (âˆ€ {x} â†’ x â‹¿ Î³ *â™® â‹… (Î± â‹… x)) â†’ returnâ™® âŠ‘â™® Î³ âŸ Î±
    RHS sound = extâ¸¢âŠ‘â†—â¸£ $ Ï€â‚‚ âŸ¦returnâŠ‘XâŸ§ sound

âŸ¦reductiveáµâŸ§ : âˆ€ {â„“} {A B : Poset â„“} {Î± : âŸª A â†— â„˜ B âŸ«} {Î³ : âŸª B â†— â„˜ A âŸ«} â†’ Î± âŸ Î³ âŠ‘â™® returnâ™® â†” (âˆ€ {xâ™¯ yâ™¯} â†’ yâ™¯ â‹¿ Î± *â™® â‹… (Î³ â‹… xâ™¯) â†’ yâ™¯ âŠ‘â™® xâ™¯)
âŸ¦reductiveáµâŸ§ {A = A} {B} {Î±} {Î³} = LHS , RHS
  where
    LHS : Î± âŸ Î³ âŠ‘â™® returnâ™® â†’ âˆ€ {xâ™¯ yâ™¯} â†’ yâ™¯ â‹¿ Î± *â™® â‹… (Î³ â‹… xâ™¯) â†’ yâ™¯ âŠ‘â™® xâ™¯
    LHS contractive xâ™¯âˆˆÎ±[Î³[yâ™¯]] = Ï€â‚ âŸ¦returnâŠ‘XâŸ§ $ res[f]â¸¢âŠ‘â†—â¸£ contractive âŠš Ï€â‚‚ âŸ¦returnâŠ‘XâŸ§ xâ™¯âˆˆÎ±[Î³[yâ™¯]]

    RHS : (âˆ€ {xâ™¯ yâ™¯} â†’ yâ™¯ â‹¿ Î± *â™® â‹… (Î³ â‹… xâ™¯) â†’ yâ™¯ âŠ‘â™® xâ™¯) â†’ Î± âŸ Î³ âŠ‘â™® returnâ™®
    RHS complete = extâ¸¢âŠ‘â†—â¸£ $ extâ¸¢âŠ‘â„˜â¸£ $ complete

soundáµ[_] : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„B : A â‡„áµ B) â†’ âˆ€ {x} â†’ x â‹¿ Î³áµ[ Aâ‡„B ] *â™® â‹… (Î±áµ[ Aâ‡„B ] â‹… x)
soundáµ[ Aâ‡„B ] = Ï€â‚ âŸ¦extensiveáµâŸ§ extensiveáµ[ Aâ‡„B ]

completeáµ[_] : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„B : A â‡„áµ B) â†’ âˆ€ {xâ™¯ yâ™¯} â†’ yâ™¯ â‹¿ Î±áµ[ Aâ‡„B ] *â™® â‹… (Î³áµ[ Aâ‡„B ] â‹… xâ™¯) â†’ yâ™¯ âŠ‘â™® xâ™¯
completeáµ[ Aâ‡„B ] = Ï€â‚ âŸ¦reductiveáµâŸ§ reductiveáµ[ Aâ‡„B ]

left-unit-extensive[âŸ]áµ[_] : âˆ€ {â„“} {A Bâ‚ Bâ‚‚ : Poset â„“} (â‡„Bâ‡„ : Bâ‚ â‡„áµ Bâ‚‚) {f : âŸª A â†— â„˜ Bâ‚ âŸ«} â†’ f âŠ‘â™® (Î³áµ[ â‡„Bâ‡„ ] âŸ Î±áµ[ â‡„Bâ‡„ ]) âŸ f
left-unit-extensive[âŸ]áµ[ â‡„Bâ‡„ ] {f} = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ f ]]
   â€£ âŸ… â—‡ left-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ returnâ™® âŸ f ]]
   â€£ [focus-left [âŸ] ğ‘œğ‘“ f ] âŸ… extensiveáµ[ â‡„Bâ‡„ ] âŸ†
   â€£ [[ (Î³áµ[ â‡„Bâ‡„ ] âŸ Î±áµ[ â‡„Bâ‡„ ]) âŸ f ]]
   âˆ

right-unit-extensive[âŸ]áµ[_] : âˆ€ {â„“} {Aâ‚ Aâ‚‚ B : Poset â„“} (â‡„Aâ‡„ : Aâ‚ â‡„áµ Aâ‚‚) {f : âŸª Aâ‚ â†— â„˜ B âŸ«} â†’ f âŠ‘â™® f âŸ Î³áµ[ â‡„Aâ‡„ ] âŸ Î±áµ[ â‡„Aâ‡„ ]
right-unit-extensive[âŸ]áµ[ â‡„Aâ‡„ ] {f} = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ f ]]
   â€£ âŸ… â—‡ right-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f âŸ returnâ™® ]]
   â€£ [focus-right [âŸ] ğ‘œğ‘“ f ] âŸ… extensiveáµ[ â‡„Aâ‡„ ] âŸ†
   â€£ [[ f âŸ Î³áµ[ â‡„Aâ‡„ ] âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
   âˆ

left-unit-reductive[âŸ]áµ[_] : âˆ€ {â„“} {A Bâ‚ Bâ‚‚ : Poset â„“} (â‡„Bâ‡„ : Bâ‚ â‡„áµ Bâ‚‚) {f : âŸª A â†— â„˜ Bâ‚‚ âŸ«} â†’ (Î±áµ[ â‡„Bâ‡„ ] âŸ Î³áµ[ â‡„Bâ‡„ ]) âŸ f âŠ‘â™® f
left-unit-reductive[âŸ]áµ[ â‡„Bâ‡„ ] {f} = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ (Î±áµ[ â‡„Bâ‡„ ] âŸ Î³áµ[ â‡„Bâ‡„ ]) âŸ f ]]
   â€£ [focus-left [âŸ] ğ‘œğ‘“ f ] âŸ… reductiveáµ[ â‡„Bâ‡„ ] âŸ†
   â€£ [[ returnâ™® âŸ f ]]
   â€£ âŸ… left-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f ]]
   âˆ

right-unit-reductive[âŸ]áµ[_] : âˆ€ {â„“} {Aâ‚ Aâ‚‚ B : Poset â„“} (â‡„Aâ‡„ : Aâ‚ â‡„áµ Aâ‚‚) {f : âŸª Aâ‚‚ â†— â„˜ B âŸ«} â†’ f âŸ Î±áµ[ â‡„Aâ‡„ ] âŸ Î³áµ[ â‡„Aâ‡„ ] âŠ‘â™® f
right-unit-reductive[âŸ]áµ[ â‡„Aâ‡„ ] {f} = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ f âŸ Î±áµ[ â‡„Aâ‡„ ] âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
   â€£ [focus-right [âŸ] ğ‘œğ‘“ f ] âŸ… reductiveáµ[ â‡„Aâ‡„ ] âŸ†
   â€£ [[ f âŸ returnâ™® ]]
   â€£ âŸ… right-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f ]]
   âˆ

weaken[Î±]áµ : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A â‡„áµ B) â†’ Î³áµ[ Aâ‡„Bâ‚‚ ] âŠ‘â™® Î³áµ[ Aâ‡„Bâ‚ ] â†’ Î±áµ[ Aâ‡„Bâ‚ ] âŠ‘â™® Î±áµ[ Aâ‡„Bâ‚‚ ]
weaken[Î±]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î³â‚‚âŠ‘Î³â‚ = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ Î±áµ[ Aâ‡„Bâ‚ ] ]]
   â€£ âŸ… right-unit-extensive[âŸ]áµ[ Aâ‡„Bâ‚‚ ] âŸ†
   â€£ [[ Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] ]]
   â€£ [focus-right [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„Bâ‚ ] ] $ [focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„Bâ‚‚ ] ] âŸ… Î³â‚‚âŠ‘Î³â‚ âŸ†
   â€£ [[ Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] ]]
   â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ (Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚ ]) âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] ]]
   â€£ âŸ… left-unit-reductive[âŸ]áµ[ Aâ‡„Bâ‚ ] âŸ†
   â€£ [[ Î±áµ[ Aâ‡„Bâ‚‚ ] ]]
   âˆ

unique[Î±]áµ : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A â‡„áµ B) â†’ Î³áµ[ Aâ‡„Bâ‚ ] â‰ˆâ™® Î³áµ[ Aâ‡„Bâ‚‚ ] â†’ Î±áµ[ Aâ‡„Bâ‚ ] â‰ˆâ™® Î±áµ[ Aâ‡„Bâ‚‚ ]
unique[Î±]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î³â‚â‰ˆÎ³â‚‚ = â‹ˆ[] (weaken[Î±]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ $ xRx[] $ â—‡ Î³â‚â‰ˆÎ³â‚‚) (weaken[Î±]áµ Aâ‡„Bâ‚‚ Aâ‡„Bâ‚ $ xRx[] Î³â‚â‰ˆÎ³â‚‚)

weaken[Î³]áµ : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A â‡„áµ B) â†’ Î±áµ[ Aâ‡„Bâ‚‚ ] âŠ‘â™® Î±áµ[ Aâ‡„Bâ‚ ] â†’ Î³áµ[ Aâ‡„Bâ‚ ] âŠ‘â™® Î³áµ[ Aâ‡„Bâ‚‚ ]
weaken[Î³]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î±â‚‚âŠ‘Î±â‚ = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ Î³áµ[ Aâ‡„Bâ‚ ] ]]
   â€£ âŸ… left-unit-extensive[âŸ]áµ[ Aâ‡„Bâ‚‚ ] âŸ†
   â€£ [[ (Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚‚ ]) âŸ Î³áµ[ Aâ‡„Bâ‚ ] ]]
   â€£ [focus-left [âŸ] ğ‘œğ‘“ Î³áµ[ Aâ‡„Bâ‚ ] ] $ [focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ Aâ‡„Bâ‚‚ ] ] âŸ… Î±â‚‚âŠ‘Î±â‚ âŸ†
   â€£ [[ (Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚ ]) âŸ Î³áµ[ Aâ‡„Bâ‚ ] ]]
   â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚ ] ]]
   â€£ âŸ… right-unit-reductive[âŸ]áµ[ Aâ‡„Bâ‚ ] âŸ†
   â€£ [[ Î³áµ[ Aâ‡„Bâ‚‚ ] ]]
   âˆ

unique[Î³]áµ : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A â‡„áµ B) â†’ Î±áµ[ Aâ‡„Bâ‚ ] â‰ˆâ™® Î±áµ[ Aâ‡„Bâ‚‚ ] â†’ Î³áµ[ Aâ‡„Bâ‚ ] â‰ˆâ™® Î³áµ[ Aâ‡„Bâ‚‚ ]
unique[Î³]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î±â‚â‰ˆÎ±â‚‚ = â‹ˆ[] (weaken[Î³]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ $ xRx[] $ â—‡ Î±â‚â‰ˆÎ±â‚‚) (weaken[Î³]áµ Aâ‡„Bâ‚‚ Aâ‡„Bâ‚ $ xRx[] Î±â‚â‰ˆÎ±â‚‚)

_âŠšâ¸¢â‡„áµâ¸£_ : âˆ€ {â„“} {A B C : Poset â„“} â†’ B â‡„áµ C â†’ A â‡„áµ B â†’ A â‡„áµ C
Bâ‡„C âŠšâ¸¢â‡„áµâ¸£ Aâ‡„B = record
  { Î±áµ[_] = Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]
  ; Î³áµ[_] = Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]
  ; extensiveáµ[_] = let open ProofMode[âŠ‘] in [proof-mode]
      do [[ returnâ™® ]]
       â€£ âŸ… extensiveáµ[ Aâ‡„B ] âŸ†
       â€£ [[ Î³áµ[ Aâ‡„B ] âŸ Î±áµ[ Aâ‡„B ] ]]
       â€£ [focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„B ] ] begin
           do [[ Î³áµ[ Aâ‡„B ] ]]
            â€£ âŸ… right-unit-extensive[âŸ]áµ[ Bâ‡„C ] âŸ†
            â€£ [[ Î³áµ[ Aâ‡„B ] âŸ (Î³áµ[ Bâ‡„C ] âŸ Î±áµ[ Bâ‡„C ]) ]]
            â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ (Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) âŸ Î±áµ[ Bâ‡„C ] ]]
           end
       â€£ [[ ((Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) âŸ Î±áµ[ Bâ‡„C ]) âŸ Î±áµ[ Aâ‡„B ] ]]
       â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) âŸ (Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) ]]
       âˆ
  ; reductiveáµ[_] = let open ProofMode[âŠ‘] in [proof-mode]
      do [[ (Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) âŸ (Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) ]]
       â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ ((Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) âŸ Î³áµ[ Aâ‡„B ]) âŸ Î³áµ[ Bâ‡„C ] ]]
       â€£ [focus-left [âŸ] ğ‘œğ‘“ Î³áµ[ Bâ‡„C ] ] begin
           do [[ (Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) âŸ Î³áµ[ Aâ‡„B ] ]]
            â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ] âŸ Î³áµ[ Aâ‡„B ] ]]
            â€£ âŸ… right-unit-reductive[âŸ]áµ[ Aâ‡„B ] âŸ†
            â€£ [[ Î±áµ[ Bâ‡„C ] ]]
           end
       â€£ [[ Î±áµ[ Bâ‡„C ] âŸ Î³áµ[ Bâ‡„C ] ]]
       â€£ âŸ… reductiveáµ[ Bâ‡„C ] âŸ†
       â€£ [[ returnâ™® ]]
       âˆ
  }

_â†—â¸¢â‡„áµâ¸£_ : âˆ€ {â„“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : Poset â„“} â†’ Aâ‚ â‡„áµ Aâ‚‚ â†’ Bâ‚ â‡„áµ Bâ‚‚ â†’ (Aâ‚ â†— â„˜ Bâ‚) â‡„ (Aâ‚‚ â†— â„˜ Bâ‚‚)
_â†—â¸¢â‡„áµâ¸£_ {Aâ‚ = Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} â‡„Aâ‡„ â‡„Bâ‡„ = record
  { Î±[_] = wrap[âŸ] â‹… Î±áµ[ â‡„Bâ‡„ ] â‹… Î³áµ[ â‡„Aâ‡„ ]
  ; Î³[_] = wrap[âŸ] â‹… Î³áµ[ â‡„Bâ‡„ ] â‹… Î±áµ[ â‡„Aâ‡„ ]
  ; extensive[_] = extâ¸¢âŠ‘â†—â¸£ $ Î» {f} â†’ let open ProofMode[âŠ‘] in [proof-mode]
      do [[ f ]]
       â€£ âŸ… left-unit-extensive[âŸ]áµ[ â‡„Bâ‡„ ] âŸ†
       â€£ [[ (Î³áµ[ â‡„Bâ‡„ ] âŸ Î±áµ[ â‡„Bâ‡„ ]) âŸ f ]]
       â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ Î³áµ[ â‡„Bâ‡„ ] âŸ Î±áµ[ â‡„Bâ‡„ ] âŸ f ]]
       â€£ âŸ… right-unit-extensive[âŸ]áµ[ â‡„Aâ‡„ ] âŸ†
       â€£ [[ (Î³áµ[ â‡„Bâ‡„ ] âŸ Î±áµ[ â‡„Bâ‡„ ] âŸ f) âŸ Î³áµ[ â‡„Aâ‡„ ] âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ Î³áµ[ â‡„Bâ‡„ ] âŸ (Î±áµ[ â‡„Bâ‡„ ] âŸ f) âŸ Î³áµ[ â‡„Aâ‡„ ] âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ â‡„Bâ‡„ ] ] begin
           do [[ (Î±áµ[ â‡„Bâ‡„ ] âŸ f) âŸ Î³áµ[ â‡„Aâ‡„ ] âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
            â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ ((Î±áµ[ â‡„Bâ‡„ ] âŸ f) âŸ Î³áµ[ â‡„Aâ‡„ ]) âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
            â€£ [focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ â‡„Aâ‡„ ] ] âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ (Î±áµ[ â‡„Bâ‡„ ] âŸ f âŸ Î³áµ[ â‡„Aâ‡„ ]) âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
           end
       â€£ [[ Î³áµ[ â‡„Bâ‡„ ] âŸ (Î±áµ[ â‡„Bâ‡„ ] âŸ f âŸ Î³áµ[ â‡„Aâ‡„ ]) âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
       â€£ [[ (wrap[âŸ] â‹… Î³áµ[ â‡„Bâ‡„ ] â‹… Î±áµ[ â‡„Aâ‡„ ] âˆ˜â™® wrap[âŸ] â‹… Î±áµ[ â‡„Bâ‡„ ] â‹… Î³áµ[ â‡„Aâ‡„ ]) â‹… f ]]
       âˆ
  ; reductive[_] = extâ¸¢âŠ‘â†—â¸£ $ Î» {f} â†’ let open ProofMode[âŠ‘] in [proof-mode]
      do [[ (wrap[âŸ] â‹… Î±áµ[ â‡„Bâ‡„ ] â‹… Î³áµ[ â‡„Aâ‡„ ] âˆ˜â™® wrap[âŸ] â‹… Î³áµ[ â‡„Bâ‡„ ] â‹… Î±áµ[ â‡„Aâ‡„ ]) â‹… f ]]
       â€£ [[ Î±áµ[ â‡„Bâ‡„ ] âŸ (Î³áµ[ â‡„Bâ‡„ ] âŸ f âŸ Î±áµ[ â‡„Aâ‡„ ]) âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ Î±áµ[ â‡„Bâ‡„ ] ] begin
           do [[ (Î³áµ[ â‡„Bâ‡„ ] âŸ f âŸ Î±áµ[ â‡„Aâ‡„ ]) âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
            â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ Î³áµ[ â‡„Bâ‡„ ] âŸ (f âŸ Î±áµ[ â‡„Aâ‡„ ]) âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
            â€£ [focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ â‡„Bâ‡„ ] ] begin
                do [[ (f âŸ Î±áµ[ â‡„Aâ‡„ ]) âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
                 â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
                 â€£ [[ f âŸ Î±áµ[ â‡„Aâ‡„ ] âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
                 â€£ âŸ… right-unit-reductive[âŸ]áµ[ â‡„Aâ‡„ ] âŸ†
                 â€£ [[ f ]]
                end
           end
       â€£ [[ Î±áµ[ â‡„Bâ‡„ ] âŸ Î³áµ[ â‡„Bâ‡„ ] âŸ f ]]
       â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î±áµ[ â‡„Bâ‡„ ] âŸ Î³áµ[ â‡„Bâ‡„ ]) âŸ f ]]
       â€£ âŸ… left-unit-reductive[âŸ]áµ[ â‡„Bâ‡„ ] âŸ†
       â€£ [[ f ]]
       âˆ
  }

-- infixr 4 _Î±â‡„Î³áµâ¸¢â™®â¸£_
-- record _Î±â‡„Î³áµâ¸¢â™®â¸£_ {â„“} (A B : Set â„“) {{A-PO : PreOrder â„“ A}} {{B-PO : PreOrder â„“ B}} : Set (â†‘á´¸ â„“) where
--   field
--     Î±áµâ¸¢â™®â¸£ : A â†’ B â†’ Set â„“
--     monotonic[Î±áµâ¸¢â™®â¸£] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î±áµâ¸¢â™®â¸£
--     Î³áµâ¸¢â™®â¸£ : B â†’ A â†’ Set â„“
--     monotonic[Î³áµâ¸¢â™®â¸£] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î³áµâ¸¢â™®â¸£
--     sound[Î±Î³áµ]â¸¢â™®â¸£ : âˆ€ {x : A} â†’ âˆƒ x^ ğ‘ ğ‘¡ Î±áµâ¸¢â™®â¸£ x x^ Ã— Î³áµâ¸¢â™®â¸£ x^ x
--     complete[Î±Î³áµ]â¸¢â™®â¸£ : âˆ€ {xâ‚^ xâ‚‚^ x} â†’ Î³áµâ¸¢â™®â¸£ xâ‚^ x â†’ Î±áµâ¸¢â™®â¸£ x xâ‚‚^ â†’ xâ‚‚^ âŠ´ xâ‚^
-- 
-- mk[Î±â‡„Î³áµ]â¸¢â™®â¸£ :
--   âˆ€ {â„“} {A B : Set â„“}
--     {{A-PO : PreOrder â„“ A}} {{A-REX : Reflexive (_âŠ´_ {A = A})}}
--     {{B-PO : PreOrder â„“ B}} {{B-REX : Reflexive (_âŠ´_ {A = B})}}
--   â†’ A Î±â‡„Î³áµâ¸¢â™®â¸£ B â†’ â‡§ A Î±â‡„Î³áµ â‡§ B
-- mk[Î±â‡„Î³áµ]â¸¢â™®â¸£ {A = A} {B} Aâ‡„B = record
--   { Î±áµ[_] = Î±
--   ; Î³áµ[_] = Î³
--   ; extensiveáµ[_] = Ï€â‚‚ âŸ¦extensiveáµâŸ§ $ Î» {x} â†’ sound {x}
--   ; reductiveáµ[_] = Ï€â‚‚ âŸ¦reductiveáµâŸ§ complete
--   }
--   where
--     open _Î±â‡„Î³áµâ¸¢â™®â¸£_ Aâ‡„B
--     Î± : âŸª â‡§ A â†— â„˜ (â‡§ B) âŸ«
--     Î± = witness (curryâ¸¢Î»â™®â¸£ idâ¸¢Ï‰â™®â¸£) $ mk[witness] Î±áµâ¸¢â™®â¸£ monotonic[Î±áµâ¸¢â™®â¸£]
--     Î³ : âŸª â‡§ B â†— â„˜ (â‡§ A) âŸ«
--     Î³ = witness (curryâ¸¢Î»â™®â¸£ idâ¸¢Ï‰â™®â¸£) $ mk[witness] Î³áµâ¸¢â™®â¸£ monotonic[Î³áµâ¸¢â™®â¸£]
--     sound : âˆ€ {x} â†’ x â‹¿ Î³ * â‹… (Î± â‹… x)
--     sound {â™®âŸ¨ x âŸ©} with sound[Î±Î³áµ]â¸¢â™®â¸£ {x}
--     ... | âˆƒ x^ ,, x^âˆˆÎ±[x] , xâˆˆÎ³[x^]  = âˆƒâ„˜ â™® x^ ,, x^âˆˆÎ±[x] ,, xâˆˆÎ³[x^]
--     complete : âˆ€ {x^ y^} â†’ x^ â‹¿ Î± * â‹… (Î³ â‹… y^) â†’ x^ âŠ‘ y^
--     complete (âˆƒâ„˜ x ,, xâˆˆÎ³[x^] ,, y^âˆˆÎ±[x]) = intro[âŠ‘â™­] $ complete[Î±Î³áµ]â¸¢â™®â¸£ xâˆˆÎ³[x^] y^âˆˆÎ±[x]
-- 
-- xRxâ¸¢Î±â‡„Î³áµâ¸£ : âˆ€ {â„“} {A : Poset â„“} â†’ A Î±â‡„Î³áµ A
-- xRxâ¸¢Î±â‡„Î³áµâ¸£ = record
--   { Î±áµ[_] = return
--   ; Î³áµ[_] = return
--   ; extensiveáµ[_] = xRx[] $ â—‡ left-unit[âŸ]
--   ; reductiveáµ[_] = xRx[] left-unit[âŸ]
--   }
-- 
-- Î±â‡„Î³áµâ†’Î±â‡„Î³ : âˆ€ {â„“} {A B : Poset â„“} â†’ A Î±â‡„Î³áµ B â†’ â„˜ A Î±â‡„Î³ â„˜ B
-- Î±â‡„Î³áµâ†’Î±â‡„Î³ Aâ‡„B = record
--   { Î±[_] = Î±áµ[ Aâ‡„B ] *
--   ; Î³[_] = Î³áµ[ Aâ‡„B ] *
--   ; extensive[_] = let open ProofMode[âŠ‘] in [proof-mode]
--       do [[ idáµ’ ]]
--        â€£ âŸ… â—‡ left-unit[*/ext] âŸ†â¸¢â‰ˆâ¸£
--        â€£ [[ return * ]]
--        â€£ [focus-in [*] ] âŸ… extensiveáµ[ Aâ‡„B ] âŸ†
--        â€£ [[ (Î³áµ[ Aâ‡„B ] âŸ Î±áµ[ Aâ‡„B ]) * ]]
--        â€£ âŸ… associative[âŸ]â¸¢âˆ˜â™®â¸£ âŸ†â¸¢â‰ˆâ¸£
--        â€£ [[ Î³áµ[ Aâ‡„B ] * âˆ˜â™® Î±áµ[ Aâ‡„B ] * ]]
--        âˆ
--   ; reductive[_] = let open ProofMode[âŠ‘] in [proof-mode]
--       do [[ Î±áµ[ Aâ‡„B ] * âˆ˜â™® Î³áµ[ Aâ‡„B ] * ]]
--        â€£ âŸ… â—‡ associative[âŸ]â¸¢âˆ˜â™®â¸£ âŸ†â¸¢â‰ˆâ¸£
--        â€£ [[ (Î±áµ[ Aâ‡„B ] âŸ Î³áµ[ Aâ‡„B ]) * ]]
--        â€£ [focus-in [*] ] âŸ… reductiveáµ[ Aâ‡„B ] âŸ†
--        â€£ [[ return * ]]
--        â€£ âŸ… left-unit[*/ext] âŸ†â¸¢â‰ˆâ¸£
--        â€£ [[ idáµ’ ]]
--        âˆ
--   }
-- 
-- _Ã—â¸¢Î±â‡„Î³áµâ¸£_ : âˆ€ {â„“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : Poset â„“} â†’ Aâ‚ Î±â‡„Î³áµ Bâ‚ â†’ Aâ‚‚ Î±â‡„Î³áµ Bâ‚‚ â†’ (Aâ‚ âŸ¨Ã—âŸ© Aâ‚‚) Î±â‡„Î³áµ (Bâ‚ âŸ¨Ã—âŸ© Bâ‚‚)
-- _Ã—â¸¢Î±â‡„Î³áµâ¸£_ {â„“} {Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} Aâ‚â‡„Bâ‚ Aâ‚‚â‡„Bâ‚‚ = mk[Î±â‡„Î³áµ]â¸¢â™®â¸£ $ record
--   { Î±áµâ¸¢â™®â¸£ = Î±
--   ; monotonic[Î±áµâ¸¢â™®â¸£] = monotonic[Î±]
--   ; Î³áµâ¸¢â™®â¸£ = Î³
--   ; monotonic[Î³áµâ¸¢â™®â¸£] = monotonic[Î³]
--   ; sound[Î±Î³áµ]â¸¢â™®â¸£ = sound
--   ; complete[Î±Î³áµ]â¸¢â™®â¸£ = complete
--   }
--   where
--     Î± : prod Aâ‚ Aâ‚‚ â†’ prod Bâ‚ Bâ‚‚ â†’ Set â„“
--     Î± (x , y) (x^ , y^) = (x^ â‹¿ Î±áµ[ Aâ‚â‡„Bâ‚ ] â‹… x) Ã— (y^ â‹¿ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] â‹… y)
--     abstract
--       monotonic[Î±] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î±
--       monotonic[Î±] (xâ‚âŠ‘xâ‚‚ , yâ‚âŠ‘yâ‚‚) (xâ‚^âŠ’xâ‚‚^ , yâ‚^âŠ’yâ‚‚^) (xâ‚^âˆˆÎ±[xâ‚] , yâ‚^âˆˆÎ±[yâ‚]) =
--           res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î±áµ[ Aâ‚â‡„Bâ‚ ]} xâ‚âŠ‘xâ‚‚) xâ‚^âŠ’xâ‚‚^ xâ‚^âˆˆÎ±[xâ‚]
--         , res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ]} yâ‚âŠ‘yâ‚‚) yâ‚^âŠ’yâ‚‚^ yâ‚^âˆˆÎ±[yâ‚]
--     Î³ : prod Bâ‚ Bâ‚‚ â†’ prod Aâ‚ Aâ‚‚ â†’ Set â„“
--     Î³ (x^ , y^) (x , y) = (x â‹¿ Î³áµ[ Aâ‚â‡„Bâ‚ ] â‹… x^) Ã— (y â‹¿ Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] â‹… y^)
--     abstract
--       monotonic[Î³] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î³
--       monotonic[Î³] (xâ‚^âŠ‘xâ‚‚^ , yâ‚^âŠ‘yâ‚‚^) (xâ‚âŠ’xâ‚‚ , yâ‚âŠ’yâ‚‚) (xâ‚âˆˆÎ³[xâ‚^] , yâ‚âˆˆÎ³[yâ‚^]) =
--           res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î³áµ[ Aâ‚â‡„Bâ‚ ]} xâ‚^âŠ‘xâ‚‚^) xâ‚âŠ’xâ‚‚ xâ‚âˆˆÎ³[xâ‚^]
--         , res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ]} yâ‚^âŠ‘yâ‚‚^) yâ‚âŠ’yâ‚‚ yâ‚âˆˆÎ³[yâ‚^]
--     sound : âˆ€ {xy : prod Aâ‚ Aâ‚‚} â†’ âˆƒ xy^ ğ‘ ğ‘¡ Î± xy xy^ Ã— Î³ xy^ xy
--     sound {x , y} with soundáµ[ Aâ‚â‡„Bâ‚ ] {x} | soundáµ[ Aâ‚‚â‡„Bâ‚‚ ] {y}
--     ... | âˆƒâ„˜ x^ ,, x^âˆˆÎ±[x] ,, xâˆˆÎ³[x^] | âˆƒâ„˜ y^ ,, yâˆˆÎ±[y^] ,, y^âˆˆÎ³[y] = âˆƒ (x^ , y^) ,, (x^âˆˆÎ±[x] , yâˆˆÎ±[y^]) , (xâˆˆÎ³[x^] , y^âˆˆÎ³[y])
--     complete : âˆ€ {xyâ‚^ xyâ‚‚^ : prod Bâ‚ Bâ‚‚} {xy : prod Aâ‚ Aâ‚‚} â†’ Î³ xyâ‚^ xy â†’ Î± xy xyâ‚‚^ â†’ xyâ‚‚^ âŠ´ xyâ‚^
--     complete {xâ‚^ , yâ‚^} {xâ‚‚^ , yâ‚‚^} {x , y} (xâˆˆÎ³[xâ‚^] , yâˆˆÎ³[yâ‚^]) (xâ‚‚^âˆˆÎ±[x] , yâ‚‚^âˆˆÎ±[y]) =
--         (completeáµ[ Aâ‚â‡„Bâ‚ ] $ âˆƒâ„˜ x ,, xâˆˆÎ³[xâ‚^] ,, xâ‚‚^âˆˆÎ±[x])
--       , (completeáµ[ Aâ‚‚â‡„Bâ‚‚ ] $ âˆƒâ„˜ y ,, yâˆˆÎ³[yâ‚^] ,, yâ‚‚^âˆˆÎ±[y])
