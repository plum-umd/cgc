module Poset.GaloisConnection.Constructive where

open import Prelude
open import Poset.Poset
open import Poset.Fun
open import Poset.Power
open import Poset.Product
open import Poset.ProofMode
open import Poset.Lib
open import Poset.PowerMonad
open import Poset.Option

open import Poset.GaloisConnection.Classical
open import Poset.GaloisConnection.Kleisli

infixr 11 _â‡„á¶œ_
-- infixr 11 _â‡„á¶œâ™­_

record _â‡„á¶œ_ {â„“} (A B : Poset â„“) : Set (â†‘á´¸ â„“) where
  field
    Î·á¶œ[_] : âŸª A â†— B âŸ«
    Î³á¶œ[_] : âŸª B â†— â„˜ A âŸ«
    extensiveá¶œ[_] : returnâ™® âŠ‘â™® Î³á¶œ[_] âŸ pure â‹… Î·á¶œ[_]
    reductiveá¶œ[_] : pure â‹… Î·á¶œ[_] âŸ Î³á¶œ[_] âŠ‘â™® returnâ™®
open _â‡„á¶œ_ public

Î±á¶œ[_] : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„B : A â‡„á¶œ B) â†’ âŸª A â†— â„˜ B âŸ«
Î±á¶œ[ Aâ‡„B ] = pure â‹… Î·á¶œ[ Aâ‡„B ]

extensiveá¶œ[*][_] : âˆ€ {â„“} {A B : Poset â„“} (â‡„Aâ‡„ : A â‡„á¶œ B) {x : âŸª A âŸ«} â†’ returnâ™® â‹… x âŠ‘â™® Î³á¶œ[ â‡„Aâ‡„ ] *â™® â‹… (Î±á¶œ[ â‡„Aâ‡„ ] â‹… x)
extensiveá¶œ[*][ â‡„Aâ‡„ ] {x} = res[f][â†—]â¸¢âŠ‘â¸£ extensiveá¶œ[ â‡„Aâ‡„ ]

reductiveá¶œ[*][_] : âˆ€ {â„“} {A B : Poset â„“} (â‡„Aâ‡„ : A â‡„á¶œ B) {y : âŸª B âŸ«} â†’ Î±á¶œ[ â‡„Aâ‡„ ] *â™® â‹… (Î³á¶œ[ â‡„Aâ‡„ ] â‹… y) âŠ‘â™® returnâ™® â‹… y
reductiveá¶œ[*][ â‡„Aâ‡„ ] = res[f][â†—]â¸¢âŠ‘â¸£ reductiveá¶œ[ â‡„Aâ‡„ ]

extensiveá¶œ[âˆ˜â™®][_] : âˆ€ {â„“} {A B : Poset â„“} (â‡„Aâ‡„ : A â‡„á¶œ B) â†’ idâ™® âŠ‘â™® Î³á¶œ[ â‡„Aâ‡„ ] *â™® âˆ˜â™® Î±á¶œ[ â‡„Aâ‡„ ] *â™®
extensiveá¶œ[âˆ˜â™®][ â‡„Aâ‡„ ] = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ idâ™® ]]
   â€£ âŸ… â—‡ left-unit[*/ext] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ returnâ™® *â™® ]]
   â€£ [focus-in [*] ] begin
       do [[ returnâ™® ]]
        â€£ âŸ… extensiveá¶œ[ â‡„Aâ‡„ ] âŸ†
        â€£ [[ Î³á¶œ[ â‡„Aâ‡„ ] âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
       end
   â€£ [[ (Î³á¶œ[ â‡„Aâ‡„ ] âŸ Î±á¶œ[ â‡„Aâ‡„ ]) *â™® ]]
   â€£ âŸ… associative[*/ext] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ Î³á¶œ[ â‡„Aâ‡„ ] *â™® âˆ˜â™® Î±á¶œ[ â‡„Aâ‡„ ] *â™® ]]
   âˆ

reductiveá¶œ[âˆ˜â™®][_] : âˆ€ {â„“} {A B : Poset â„“} (â‡„Aâ‡„ : A â‡„á¶œ B) â†’ Î±á¶œ[ â‡„Aâ‡„ ] *â™® âˆ˜â™® Î³á¶œ[ â‡„Aâ‡„ ] *â™® âŠ‘â™® idâ™®
reductiveá¶œ[âˆ˜â™®][ â‡„Aâ‡„ ] = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ Î±á¶œ[ â‡„Aâ‡„ ] *â™® âˆ˜â™® Î³á¶œ[ â‡„Aâ‡„ ] *â™® ]]
   â€£ âŸ… â—‡ associative[*/ext] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ (Î±á¶œ[ â‡„Aâ‡„ ] *â™® âˆ˜â™® Î³á¶œ[ â‡„Aâ‡„ ]) *â™® ]]
   â€£ [focus-in [*] ] begin
       do [[ Î±á¶œ[ â‡„Aâ‡„ ] *â™® âˆ˜â™® Î³á¶œ[ â‡„Aâ‡„ ] ]]
        â€£ âŸ… reductiveá¶œ[ â‡„Aâ‡„ ] âŸ†
        â€£ [[ returnâ™® ]]
       end
   â€£ [[ returnâ™® *â™® ]]
   â€£ âŸ… left-unit[*/ext] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ idâ™® ]]
   âˆ

extensiveá¶œ[â‹…][_] : âˆ€ {â„“} {A B : Poset â„“} (â‡„Aâ‡„ : A â‡„á¶œ B) {X : âŸª â„˜ A âŸ«} â†’ X âŠ‘â™® Î³á¶œ[ â‡„Aâ‡„ ] *â™® â‹… (Î±á¶œ[ â‡„Aâ‡„ ] *â™® â‹… X)
extensiveá¶œ[â‹…][ â‡„Aâ‡„ ] = res[f][â†—]â¸¢âŠ‘â¸£ extensiveá¶œ[âˆ˜â™®][ â‡„Aâ‡„ ]

reductiveá¶œ[â‹…][_] : âˆ€ {â„“} {A B : Poset â„“} (â‡„Aâ‡„ : A â‡„á¶œ B) {Y : âŸª â„˜ B âŸ«} â†’ Î±á¶œ[ â‡„Aâ‡„ ] *â™® â‹… (Î³á¶œ[ â‡„Aâ‡„ ] *â™® â‹… Y) âŠ‘â™® Y
reductiveá¶œ[â‹…][ â‡„Aâ‡„ ] = res[f][â†—]â¸¢âŠ‘â¸£ reductiveá¶œ[âˆ˜â™®][ â‡„Aâ‡„ ]

âŸ¦extensiveá¶œâŸ§ : âˆ€ {â„“} {A B : Poset â„“} {Î· : âŸª A â†— B âŸ«} {Î³ : âŸª B â†— â„˜ A âŸ«} â†’ returnâ™® âŠ‘â™® Î³ âŸ pure â‹… Î· â†” (âˆ€ {x} â†’ x â‹¿ Î³ â‹… (Î· â‹… x))
âŸ¦extensiveá¶œâŸ§ {A = A} {B} {Î·} {Î³} = âŸ¨ LHS , RHS âŸ©
  where
    LHS : returnâ™® âŠ‘â™® Î³ âŸ pure â‹… Î· â†’ âˆ€ {x} â†’ x â‹¿ Î³ â‹… (Î· â‹… x)
    LHS expansive = Ï€â‚ âŸ¦returnâŠ‘XâŸ§ $ res[f][â†—]â¸¢âŠ‘â¸£ $ xRxá´³ right-unit[âŸ/pure] âŠš expansive
    RHS : (âˆ€ {x} â†’ x â‹¿ Î³ â‹… (Î· â‹… x)) â†’ returnâ™® âŠ‘â™® Î³ âŸ pure â‹… Î·
    RHS sound = xRx[â‰ˆ]â¸¢âŠ‘â™®â¸£ (â—‡ right-unit[âŸ/pure]) âŠš ext[â†—]â¸¢âŠ‘â¸£ (Ï€â‚‚ âŸ¦returnâŠ‘XâŸ§ sound)

âŸ¦reductiveá¶œâŸ§ : âˆ€ {â„“} {A B : Poset â„“} {Î· : âŸª A â†— B âŸ«} {Î³ : âŸª B â†— â„˜ A âŸ«} â†’ pure â‹… Î· âŸ Î³ âŠ‘â™® returnâ™® â†” (âˆ€ {xâ™¯ x} â†’ x â‹¿ Î³ â‹… xâ™¯ â†’ Î· â‹… x âŠ‘â™® xâ™¯)
âŸ¦reductiveá¶œâŸ§ {A = A} {B} {Î·} {Î³} = âŸ¨ LHS , RHS âŸ©
  where
    LHS : pure â‹… Î· âŸ Î³ âŠ‘â™® returnâ™® â†’ âˆ€ {xâ™¯ x} â†’ x â‹¿ Î³ â‹… xâ™¯ â†’ Î· â‹… x âŠ‘â™® xâ™¯
    LHS contractive {xâ™¯} {x} xâˆˆÎ³[xâ™¯] = Ï€â‚ âŸ¦returnâŠ‘XâŸ§ $ res[f][â†—]â¸¢âŠ‘â¸£ contractive âŠš let open ProofMode[âŠ‘] in [proof-mode]
      do [[ (pure â‹… Î·) â‹… x ]]
       â€£ âŸ… â—‡ right-unit[*] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (pure â‹… Î·) *â™® â‹… (returnâ™® â‹… x) ]]
       â€£ [focus-right [â‹…] ğ‘œğ‘“ (pure â‹… Î·) *â™® ] âŸ… Ï€â‚‚ âŸ¦returnâŠ‘XâŸ§ xâˆˆÎ³[xâ™¯] âŸ†
       â€£ [[ (pure â‹… Î·) *â™® â‹… (Î³ â‹… xâ™¯) ]]
       âˆ
    RHS : (âˆ€ {xâ™¯ x} â†’ x â‹¿ Î³ â‹… xâ™¯ â†’ Î· â‹… x âŠ‘â™® xâ™¯) â†’ pure â‹… Î· âŸ Î³ âŠ‘â™® returnâ™®
    RHS complete = ext[â†—]â¸¢âŠ‘â¸£ $ ext[â„˜]â¸¢âŠ‘â¸£ H
      where
        H : âˆ€ {xâ™¯ yâ™¯} â†’ yâ™¯ â‹¿ (pure â‹… Î·) *â™® â‹… (Î³ â‹… xâ™¯) â†’ yâ™¯ âŠ‘â™® xâ™¯
        H (âˆƒâ„˜ x ,, xâˆˆÎ³[xâ™¯] ,, yâ™¯âŠ‘Î·[x]) = complete xâˆˆÎ³[xâ™¯] âŠš yâ™¯âŠ‘Î·[x]

soundá¶œ[_] : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„B : A â‡„á¶œ B) â†’ âˆ€ {x} â†’ x â‹¿ Î³á¶œ[ Aâ‡„B ] â‹… (Î·á¶œ[ Aâ‡„B ] â‹… x)
soundá¶œ[ Aâ‡„B ] = Ï€â‚ âŸ¦extensiveá¶œâŸ§ extensiveá¶œ[ Aâ‡„B ]

completeá¶œ[_] : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„B : A â‡„á¶œ B) â†’ âˆ€ {xâ™¯ x} â†’ x â‹¿ Î³á¶œ[ Aâ‡„B ] â‹… xâ™¯ â†’ Î·á¶œ[ Aâ‡„B ] â‹… x âŠ‘â™® xâ™¯
completeá¶œ[ Aâ‡„B ] = Ï€â‚ âŸ¦reductiveá¶œâŸ§ reductiveá¶œ[ Aâ‡„B ]

left-unit-extensive[âŸ]á¶œ[_] : âˆ€ {â„“} {A Bâ‚ Bâ‚‚ : Poset â„“} (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª A â†— â„˜ Bâ‚ âŸ«} â†’ f âŠ‘â™® (Î³á¶œ[ â‡„Bâ‡„ ] âŸ Î±á¶œ[ â‡„Bâ‡„ ]) âŸ f
left-unit-extensive[âŸ]á¶œ[ â‡„Bâ‡„ ] {f} = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ f ]]
   â€£ âŸ… â—‡ left-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ returnâ™® âŸ f ]]
   â€£ [focus-left [âŸ] ğ‘œğ‘“ f ] âŸ… extensiveá¶œ[ â‡„Bâ‡„ ] âŸ†
   â€£ [[ (Î³á¶œ[ â‡„Bâ‡„ ] âŸ Î±á¶œ[ â‡„Bâ‡„ ]) âŸ f ]]
   âˆ

right-unit-extensive[âŸ]á¶œ[_] : âˆ€ {â„“} {Aâ‚ Aâ‚‚ B : Poset â„“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) {f : âŸª Aâ‚ â†— â„˜ B âŸ«} â†’ f âŠ‘â™® f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŸ Î±á¶œ[ â‡„Aâ‡„ ]
right-unit-extensive[âŸ]á¶œ[ â‡„Aâ‡„ ] {f} = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ f ]]
   â€£ âŸ… â—‡ right-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f âŸ returnâ™® ]]
   â€£ [focus-right [âŸ] ğ‘œğ‘“ f ] âŸ… extensiveá¶œ[ â‡„Aâ‡„ ] âŸ†
   â€£ [[ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
   âˆ

left-unit-reductive[âŸ]á¶œ[_] : âˆ€ {â„“} {A Bâ‚ Bâ‚‚ : Poset â„“} (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª A â†— â„˜ Bâ‚‚ âŸ«} â†’ (Î±á¶œ[ â‡„Bâ‡„ ] âŸ Î³á¶œ[ â‡„Bâ‡„ ]) âŸ f âŠ‘â™® f
left-unit-reductive[âŸ]á¶œ[ â‡„Bâ‡„ ] {f} = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ (Î±á¶œ[ â‡„Bâ‡„ ] âŸ Î³á¶œ[ â‡„Bâ‡„ ]) âŸ f ]]
   â€£ [focus-left [âŸ] ğ‘œğ‘“ f ] âŸ… reductiveá¶œ[ â‡„Bâ‡„ ] âŸ†
   â€£ [[ returnâ™® âŸ f ]]
   â€£ âŸ… left-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f ]]
   âˆ

right-unit-reductive[âŸ]á¶œ[_] : âˆ€ {â„“} {Aâ‚ Aâ‚‚ B : Poset â„“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) {f : âŸª Aâ‚‚ â†— â„˜ B âŸ«} â†’ f âŸ Î±á¶œ[ â‡„Aâ‡„ ] âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŠ‘â™® f
right-unit-reductive[âŸ]á¶œ[ â‡„Aâ‡„ ] {f} = let open ProofMode[âŠ‘] in [proof-mode]
  do [[ f âŸ Î±á¶œ[ â‡„Aâ‡„ ] âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
   â€£ [focus-right [âŸ] ğ‘œğ‘“ f ] âŸ… reductiveá¶œ[ â‡„Aâ‡„ ] âŸ†
   â€£ [[ f âŸ returnâ™® ]]
   â€£ âŸ… right-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f ]]
   âˆ

-- left-unit-reductive[*]á¶œ[_] : âˆ€ {â„“} {Aâ‚ Aâ‚‚ B : Poset â„“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) {f : âŸª Aâ‚‚ â†— â„˜ B âŸ«} {X : âŸª â„˜ Aâ‚‚ âŸ«} â†’ f * â‹… (Î±á¶œ[ â‡„Aâ‡„ ] * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] * â‹… X)) âŠ‘ f * â‹… X
-- left-unit-reductive[*]á¶œ[ â‡„Aâ‡„ ] {f} {x} = res[f]â¸¢âŠ‘â†—â¸£ let open ProofMode[âŠ‘] in [proof-mode]
--   do [[ f * âˆ˜â™® Î±á¶œ[ â‡„Aâ‡„ ] * âˆ˜â™® Î³á¶œ[ â‡„Aâ‡„ ] * ]]
--    â€£ [focus-right [âˆ˜â™®] ğ‘œğ‘“ f * ] begin
--        do [[ Î±á¶œ[ â‡„Aâ‡„ ] * âˆ˜â™® Î³á¶œ[ â‡„Aâ‡„ ] * ]]
--         â€£ âŸ… â—‡ associative[*/ext] âŸ†â¸¢â‰ˆâ¸£
--         â€£ [[ (Î±á¶œ[ â‡„Aâ‡„ ] * âˆ˜â™® Î³á¶œ[ â‡„Aâ‡„ ]) * ]]
--         â€£ [focus-in [*] ] begin
--             do [[ Î±á¶œ[ â‡„Aâ‡„ ] * âˆ˜â™® Î³á¶œ[ â‡„Aâ‡„ ] ]]
--              â€£ [[ Î±á¶œ[ â‡„Aâ‡„ ] âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
--              â€£ âŸ… reductiveá¶œ[ â‡„Aâ‡„ ] âŸ†
--              â€£ [[ return ]]
--             end
--         â€£ [[ return * ]]
--         â€£ âŸ… left-unit[*/ext] âŸ†â¸¢â‰ˆâ¸£
--         â€£ [[ idâ™® ]]
--        end
--    â€£ [[ f * âˆ˜â™® idâ™® ]]
--    â€£ âŸ… right-unit[âˆ˜â™®] âŸ†â¸¢â‰ˆâ¸£
--    â€£ [[ f * ]]
--   âˆ

record _â‡„á¶œâ™­_ {â„“} (A B : Set â„“) {{A-PO : Precision â„“ A}} {{B-PO : Precision â„“ B}} : Set (â†‘á´¸ â„“) where
  field
    Î· : A â†’ B
    monotonic[Î·] : proper (_âŠ‘_ â‡‰ _âŠ‘_) Î·
    Î³ : B â†’ A â†’ Set â„“
    monotonic[Î³] : proper (_âŠ‘_ â‡‰ _âŠ’_ â‡‰ [â†’]) Î³
    sound : âˆ€ {x : A} â†’ Î³ (Î· x) x
    complete : âˆ€ {x xâ™¯} â†’ Î³ xâ™¯ x â†’ Î· x âŠ‘ xâ™¯
    
mk[â‡„á¶œâ™­] :
  âˆ€ {â„“} {A B : Set â„“}
    {{A-PO : Precision â„“ A}} {{A-REX : Reflexive (_âŠ‘_ {A = A})}}
    {{B-PO : Precision â„“ B}} {{B-REX : Reflexive (_âŠ‘_ {A = B})}}
  â†’ A â‡„á¶œâ™­ B â†’ â‡§ A â‡„á¶œ â‡§ B
mk[â‡„á¶œâ™­] {A = A} {B} Aâ‡„B = record
  { Î·á¶œ[_] = witness (curryâ¸¢Î»â™­â¸£ idâ¸¢Î»â™­â¸£) $ mk[witness] Î· monotonic[Î·]
  ; Î³á¶œ[_] = witness (curryâ¸¢Î»â™­â¸£ idâ¸¢Ï‰â™­â¸£) $ mk[witness] Î³ monotonic[Î³]
  ; extensiveá¶œ[_] = Ï€â‚‚ âŸ¦extensiveá¶œâŸ§ sound
  ; reductiveá¶œ[_] = Ï€â‚‚ âŸ¦reductiveá¶œâŸ§ (intro[âŠ‘â™­] âˆ˜ complete)
  }
  where open _â‡„á¶œâ™­_ Aâ‡„B

â‡„á¶œâ†”â‡„áµ : âˆ€ {â„“} {A B : Poset â„“} â†’ (A â‡„á¶œ B) â†” (A â‡„áµ B)
â‡„á¶œâ†”â‡„áµ = âŸ¨ LHS , RHS âŸ©
  where
    LHS : âˆ€ {â„“} {A B : Poset â„“} â†’ A â‡„á¶œ B â†’ A â‡„áµ B
    LHS Aâ‡„B = record
      { Î±áµ[_] = Î±á¶œ[ Aâ‡„B ]
      ; Î³áµ[_] = Î³á¶œ[ Aâ‡„B ]
      ; extensiveáµ[_] = extensiveá¶œ[ Aâ‡„B ]
      ; reductiveáµ[_] = reductiveá¶œ[ Aâ‡„B ]
      }
    RHS : âˆ€ {â„“} {A B : Poset â„“} â†’ A â‡„áµ B â†’ A â‡„á¶œ B
    RHS {A = A} {B} Aâ‡„B = record
      { Î·á¶œ[_] = Î·
      ; Î³á¶œ[_] = Î³áµ[ Aâ‡„B ]
      ; extensiveá¶œ[_] = Ï€â‚‚ âŸ¦extensiveá¶œâŸ§ sound
      ; reductiveá¶œ[_] = Ï€â‚‚ âŸ¦reductiveá¶œâŸ§ complete
      }
      where
        fun : âŸª A âŸ« â†’ âŸª B âŸ«
        fun x with soundáµ[ Aâ‡„B ] {x}
        ... | âˆƒâ„˜ y ,, yâˆˆÎ±[x] ,, xâˆˆÎ³[y] = y
        abstract
          ppr : proper (_âŠ‘â™®_ â‡‰ _âŠ‘â™®_) fun
          ppr {x} {y} xâŠ‘y with soundáµ[ Aâ‡„B ] {x} | soundáµ[ Aâ‡„B ] {y}
          ... | âˆƒâ„˜ xâ™¯ ,, xâ™¯âˆˆÎ±[x] ,, xâˆˆÎ³[xâ™¯] | âˆƒâ„˜ yâ™¯ ,, yâ™¯âˆˆÎ±[y] ,, yâˆˆÎ³[yâ™¯] =
            res[X][â„˜]â¸¢âŠ‘â¸£ (res[f][â†—]â¸¢âŠ‘â¸£ $ reductiveáµ[ Aâ‡„B ]) $
            âˆƒâ„˜ x ,, res[x][â„˜]â¸¢âŠ‘â¸£ {X = Î³áµ[ Aâ‡„B ] â‹… yâ™¯} xâŠ‘y yâˆˆÎ³[yâ™¯] ,, xâ™¯âˆˆÎ±[x]
        Î· : âŸª A â†— B âŸ«
        Î· = witness (curryâ¸¢Î»â¸£ $ idâ¸¢Î»â¸£) $ mk[witness] fun ppr
        sound : âˆ€ {x} â†’ x â‹¿ Î³áµ[ Aâ‡„B ] â‹… (Î· â‹… x)
        sound {x} with soundáµ[ Aâ‡„B ] {x}
        ... | âˆƒâ„˜ xâ™¯ ,, xâ™¯âˆˆÎ±[x] ,, xâˆˆÎ³[xâ™¯] = xâˆˆÎ³[xâ™¯]
        complete : âˆ€ {x xâ™¯} â†’ x â‹¿ Î³áµ[ Aâ‡„B ] â‹… xâ™¯ â†’ Î· â‹… x âŠ‘â™® xâ™¯
        complete {x} {xâ™¯} xâˆˆÎ³[xâ™¯] with soundáµ[ Aâ‡„B ] {x}
        ... | âˆƒâ„˜ yâ™¯ ,, yâ™¯âˆˆÎ±[x] ,, xâˆˆÎ³[yâ™¯] = completeáµ[ Aâ‡„B ] $ âˆƒâ„˜ x ,, xâˆˆÎ³[xâ™¯] ,, yâ™¯âˆˆÎ±[x]

â‡„áµâ†’â‡„á¶œ[_] : âˆ€ {â„“} {A B : Poset â„“} â†’ A â‡„áµ B â†’ A â‡„á¶œ B
â‡„áµâ†’â‡„á¶œ[_] = Ï€â‚‚ â‡„á¶œâ†”â‡„áµ

â‡„á¶œâ†’â‡„áµ[_] : âˆ€ {â„“} {A B : Poset â„“} â†’ A â‡„á¶œ B â†’ A â‡„áµ B
â‡„á¶œâ†’â‡„áµ[_] = Ï€â‚ â‡„á¶œâ†”â‡„áµ

Î±â‰ˆpure[Î·] : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„B : A â‡„áµ B) â†’ Î±áµ[ Aâ‡„B ] â‰ˆâ™® Î±á¶œ[ â‡„áµâ†’â‡„á¶œ[ Aâ‡„B ] ]
Î±â‰ˆpure[Î·] Aâ‡„B = unique[Î±]áµ Aâ‡„B â‡„á¶œâ†’â‡„áµ[ â‡„áµâ†’â‡„á¶œ[ Aâ‡„B ] ] xRx

pure[Î·]â‰ˆÎ± : âˆ€ {â„“} {A B : Poset â„“} (Aâ‡„B : A â‡„á¶œ B) â†’ Î±á¶œ[ Aâ‡„B ] â‰ˆâ™® Î±áµ[ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ]
pure[Î·]â‰ˆÎ± Aâ‡„B = unique[Î±]áµ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] xRx

module _ {â„“} {A : Poset â„“} where
  idâ¸¢â‡„á¶œâ¸£ : A â‡„á¶œ A
  idâ¸¢â‡„á¶œâ¸£ = record
    { Î·á¶œ[_] = idâ™®
    ; Î³á¶œ[_] = returnâ™®
    ; extensiveá¶œ[_] = ext[â†—]â¸¢âŠ‘â¸£ $ Î» {x} â†’ let open ProofMode[âŠ‘] in [proof-mode]
      do [[ returnâ™® â‹… x ]]
       â€£ âŸ… â—‡ right-unit[*] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ returnâ™® *â™® â‹… (returnâ™® â‹… x) ]]
       â€£ [[ (returnâ™® âŸ pure â‹… idâ™®) â‹… x ]]
       âˆ
    ; reductiveá¶œ[_] = ext[â†—]â¸¢âŠ‘â¸£ $ Î» {x} â†’ let open ProofMode[âŠ‘] in [proof-mode]
      do [[ (pure â‹… idâ™® âŸ returnâ™®) â‹… x ]]
       â€£ âŸ… right-unit[*] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ pure â‹… idâ™® â‹… x ]]
       â€£ [[ returnâ™® â‹… x ]]
       âˆ
    }

_âŠšâ¸¢â‡„á¶œâ¸£_ : âˆ€ {â„“} {A B C : Poset â„“} â†’ B â‡„á¶œ C â†’ A â‡„á¶œ B â†’ A â‡„á¶œ C
_âŠšâ¸¢â‡„á¶œâ¸£_ {â„“} {Aâ‚} {Aâ‚‚} {Aâ‚ƒ} Bâ‡„C Aâ‡„B = record
  { Î·á¶œ[_] = Î·á¶œ[ Bâ‡„C ] âˆ˜â™® Î·á¶œ[ Aâ‡„B ]
  ; Î³á¶œ[_] = Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]
  ; extensiveá¶œ[_] = let open ProofMode[âŠ‘] in [proof-mode]
      do [[ returnâ™® ]]
       â€£ âŸ… extensiveáµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŠšâ¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] âŸ†
       â€£ [[ Î³áµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŠšâ¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] âŸ Î±áµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŠšâ¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] ]]
       â€£ [[ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) âŸ (Î±á¶œ[ Bâ‡„C ] âŸ Î±á¶œ[ Aâ‡„B ]) ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) ] âŸ… homomorphic[pure/âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) âŸ pure â‹… (Î·á¶œ[ Bâ‡„C ] âˆ˜â™® Î·á¶œ[ Aâ‡„B ]) ]]
       âˆ
  ; reductiveá¶œ[_] = let open ProofMode[âŠ‘] in [proof-mode]
      do [[ pure â‹… (Î·á¶œ[ Bâ‡„C ] âˆ˜â™® Î·á¶œ[ Aâ‡„B ]) âŸ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) ]]
       â€£ [focus-left [âŸ] ğ‘œğ‘“ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) ] âŸ… â—‡ homomorphic[pure/âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î±á¶œ[ Bâ‡„C ] âŸ Î±á¶œ[ Aâ‡„B ]) âŸ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) ]]
       â€£ [[ Î±áµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŠšâ¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] âŸ Î³áµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŠšâ¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] ]]
       â€£ âŸ… reductiveáµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŠšâ¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] âŸ†
       â€£ [[ returnâ™® ]]
       âˆ
  }

_âˆ§â¸¢â‡„á¶œâ¸£_ : âˆ€ {â„“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : Poset â„“} â†’ Aâ‚ â‡„á¶œ Aâ‚‚ â†’ Bâ‚ â‡„á¶œ Bâ‚‚ â†’ (Aâ‚ âˆ§â™® Bâ‚) â‡„á¶œ (Aâ‚‚ âˆ§â™® Bâ‚‚)
_âˆ§â¸¢â‡„á¶œâ¸£_ {â„“} {Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} â‡„Aâ‡„ â‡„Bâ‡„ = mk[â‡„á¶œâ™­] record
  { Î· = Î·
  ; monotonic[Î·] = monotonic[Î·]
  ; Î³ = Î³
  ; monotonic[Î³] = monotonic[Î³]
  ; sound = sound
  ; complete = complete
  }
  where
    Î· : Aâ‚ âˆ§â™­ Bâ‚ â†’ Aâ‚‚ âˆ§â™­ Bâ‚‚
    Î· âŸ¨ x , y âŸ© = âŸ¨ Î·á¶œ[ â‡„Aâ‡„ ] â‹… x , Î·á¶œ[ â‡„Bâ‡„ ] â‹… y âŸ©
    abstract
      monotonic[Î·] : proper (_âŠ‘_ â‡‰ _âŠ‘_) Î·
      monotonic[Î·] âŸ¨ xâ‚âŠ‘xâ‚‚ , yâ‚âŠ‘yâ‚‚ âŸ© = âŸ¨ res[x][â†—]â¸¢âŠ‘â¸£ {f = Î·á¶œ[ â‡„Aâ‡„ ]} xâ‚âŠ‘xâ‚‚ , res[x][â†—]â¸¢âŠ‘â¸£ {f = Î·á¶œ[ â‡„Bâ‡„ ]} yâ‚âŠ‘yâ‚‚ âŸ©
    Î³ : Aâ‚‚ âˆ§â™­ Bâ‚‚ â†’ Aâ‚ âˆ§â™­ Bâ‚ â†’ Set â„“
    Î³ âŸ¨ xâ™¯ , yâ™¯ âŸ© âŸ¨ x , y âŸ© = (x â‹¿ Î³á¶œ[ â‡„Aâ‡„ ] â‹… xâ™¯) âˆ§ (y â‹¿ Î³á¶œ[ â‡„Bâ‡„ ] â‹… yâ™¯)
    abstract
      monotonic[Î³] : proper (_âŠ‘_ â‡‰ _âŠ’_ â‡‰ [â†’]) Î³
      monotonic[Î³] âŸ¨ xâ‚â™¯âŠ‘xâ‚‚â™¯ , yâ‚â™¯âŠ‘yâ‚‚â™¯ âŸ© âŸ¨ xâ‚â‰½xâ‚‚ , yâ‚â‰½yâ‚‚ âŸ© âŸ¨ xâ‚âˆˆÎ³[xâ‚â™¯] , yâ‚âˆˆÎ³[yâ‚â™¯] âŸ© =
        âŸ¨ res[Xx][â„˜]â¸¢âŠ‘â¸£ (res[x][â†—]â¸¢âŠ‘â¸£ {f = Î³á¶œ[ â‡„Aâ‡„ ]} xâ‚â™¯âŠ‘xâ‚‚â™¯) xâ‚â‰½xâ‚‚ xâ‚âˆˆÎ³[xâ‚â™¯]
        , res[Xx][â„˜]â¸¢âŠ‘â¸£ (res[x][â†—]â¸¢âŠ‘â¸£ {f = Î³á¶œ[ â‡„Bâ‡„ ]} yâ‚â™¯âŠ‘yâ‚‚â™¯) yâ‚â‰½yâ‚‚ yâ‚âˆˆÎ³[yâ‚â™¯]
        âŸ©
    sound : âˆ€ {xy} â†’ Î³ (Î· xy) xy
    sound {âŸ¨ x , y âŸ©} = âŸ¨ soundá¶œ[ â‡„Aâ‡„ ] {x} , soundá¶œ[ â‡„Bâ‡„ ] {y} âŸ©
    complete : âˆ€ {xyâ™¯ xy} â†’ Î³ xyâ™¯ xy â†’ Î· xy âŠ‘ xyâ™¯
    complete {âŸ¨ xâ™¯ , yâ™¯ âŸ©} {âŸ¨ x , y âŸ©} âŸ¨ xâ‚âˆˆÎ³[xâ‚â™¯] , yâ‚âˆˆÎ³[yâ‚â™¯] âŸ© = âŸ¨ completeá¶œ[ â‡„Aâ‡„ ] xâ‚âˆˆÎ³[xâ‚â™¯] , completeá¶œ[ â‡„Bâ‡„ ] yâ‚âˆˆÎ³[yâ‚â™¯] âŸ©

_â†—â¸¢â‡„á¶œâ¸£_ : âˆ€ {â„“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : Poset â„“} â†’ Aâ‚ â‡„á¶œ Aâ‚‚ â†’ Bâ‚ â‡„á¶œ Bâ‚‚ â†’ (Aâ‚ â†— â„˜ Bâ‚) â‡„ (Aâ‚‚ â†— â„˜ Bâ‚‚)
_â†—â¸¢â‡„á¶œâ¸£_ {Aâ‚ = Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} â‡„Aâ‡„ â‡„Bâ‡„ = â‡„á¶œâ†’â‡„áµ[ â‡„Aâ‡„ ] â†—â¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ â‡„Bâ‡„ ]

Î±Î±á¶œ[_,_] :
  âˆ€ {â„“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : Poset â„“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª Aâ‚ â†— â„˜ Bâ‚ âŸ«} {fâ™¯ : âŸª Aâ‚‚ â†— â„˜ Bâ‚‚ âŸ«}
  â†’ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯ â†” Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŠ‘â™® fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ]
Î±Î±á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] {f} {fâ™¯} = âŸ¨ LHS , RHS âŸ©
  where
    LHS : Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯ â†’ Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŠ‘â™® fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ]
    LHS Î±[f]âŠ‘fâ™¯ = let open ProofMode[âŠ‘] in [proof-mode]
      do [[ Î±á¶œ[ â‡„Bâ‡„ ] âŸ f ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ Î±á¶œ[ â‡„Bâ‡„ ] ] begin
           do [[ f ]]
            â€£ âŸ… right-unit-extensive[âŸ]á¶œ[ â‡„Aâ‡„ ] âŸ†
            â€£ [[ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
            â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ (f âŸ Î³á¶œ[ â‡„Aâ‡„ ]) âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
           end
       â€£ [[ Î±á¶œ[ â‡„Bâ‡„ ] âŸ (f âŸ Î³á¶œ[ â‡„Aâ‡„ ]) âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŸ Î³á¶œ[ â‡„Aâ‡„ ]) âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ [[ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ [focus-left [âŸ] ğ‘œğ‘“ Î±á¶œ[ â‡„Aâ‡„ ] ] âŸ… Î±[f]âŠ‘fâ™¯ âŸ†
       â€£ [[ fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
       âˆ
    RHS : Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŠ‘â™® fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ] â†’ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯
    RHS Î·âŸfâŠ‘fâ™¯âŸÎ· = let open ProofMode[âŠ‘] in [proof-mode]
      do [[ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f ]]
       â€£ [[ Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î±á¶œ[ â‡„Bâ‡„ ] âŸ f) âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ [focus-left [âŸ] ğ‘œğ‘“ Î³á¶œ[ â‡„Aâ‡„ ] ] âŸ… Î·âŸfâŠ‘fâ™¯âŸÎ· âŸ†
       â€£ [[ (fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ]) âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ] âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… right-unit-reductive[âŸ]á¶œ[ â‡„Aâ‡„ ] âŸ†
       â€£ [[ fâ™¯ ]]
       âˆ

Î·Î·á¶œ[_,_] : 
  âˆ€ {â„“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : Poset â„“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª Aâ‚ â†— Bâ‚ âŸ«} {fâ™¯ : âŸª Aâ‚‚ â†— Bâ‚‚ âŸ«}
  â†’ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… (pure â‹… f) âŠ‘â™® pure â‹… fâ™¯ â†” Î·á¶œ[ â‡„Bâ‡„ ] âˆ˜â™® f âŠ‘â™® fâ™¯ âˆ˜â™® Î·á¶œ[ â‡„Aâ‡„ ]
Î·Î·á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] {f} {fâ™¯} = âŸ¨ LHS , RHS âŸ©
  where
    LHS : Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… (pure â‹… f) âŠ‘â™® pure â‹… fâ™¯ â†’ Î·á¶œ[ â‡„Bâ‡„ ] âˆ˜â™® f âŠ‘â™® fâ™¯ âˆ˜â™® Î·á¶œ[ â‡„Aâ‡„ ]
    LHS Î±[f]âŠ‘fâ™¯ = injective[pure]â¸¢âŠ‘â¸£ $ let open ProofMode[âŠ‘] in [proof-mode]
      do [[ pure â‹… (Î·á¶œ[ â‡„Bâ‡„ ] âˆ˜â™® f) ]]
       â€£ âŸ… â—‡ homomorphic[pure/âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ pure â‹… Î·á¶œ[ â‡„Bâ‡„ ] âŸ pure â‹… f ]]
       â€£ âŸ… Ï€â‚ Î±Î±á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] Î±[f]âŠ‘fâ™¯ âŸ†
       â€£ [[ pure â‹… fâ™¯ âŸ pure â‹… Î·á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… homomorphic[pure/âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ pure â‹… (fâ™¯ âˆ˜â™® Î·á¶œ[ â‡„Aâ‡„ ]) ]]
       âˆ
    RHS : Î·á¶œ[ â‡„Bâ‡„ ] âˆ˜â™® f âŠ‘â™® fâ™¯ âˆ˜â™® Î·á¶œ[ â‡„Aâ‡„ ] â†’ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… (pure â‹… f) âŠ‘â™® pure â‹… fâ™¯
    RHS Î·âˆ˜fâŠ‘fâ™¯âˆ˜Î· = Ï€â‚‚ Î±Î±á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] $ let open ProofMode[âŠ‘] in [proof-mode]
      do [[ pure â‹… Î·á¶œ[ â‡„Bâ‡„ ] âŸ pure â‹… f ]]
       â€£ âŸ… homomorphic[pure/âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ pure â‹… (Î·á¶œ[ â‡„Bâ‡„ ] âˆ˜â™® f) ]]
       â€£ [focus-right [â‹…] ğ‘œğ‘“ pure ] âŸ… Î·âˆ˜fâŠ‘fâ™¯âˆ˜Î· âŸ†
       â€£ âŸ… â—‡ homomorphic[pure/âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ pure â‹… fâ™¯ âŸ pure â‹… Î·á¶œ[ â‡„Aâ‡„ ] ]]
       âˆ

Î³Î³á¶œ[_,_] :
  âˆ€ {â„“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : Poset â„“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª Aâ‚ â†— â„˜ Bâ‚ âŸ«} {fâ™¯ : âŸª Aâ‚‚ â†— â„˜ Bâ‚‚ âŸ«}
  â†’ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯ â†” f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŠ‘â™® Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯
Î³Î³á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] {f} {fâ™¯} = âŸ¨ LHS , RHS âŸ©
  where
    LHS : Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯ â†’ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŠ‘â™® Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯
    LHS Î±[f]âŠ‘fâ™¯ = let open ProofMode[âŠ‘] in [proof-mode]
      do [[ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… left-unit-extensive[âŸ]á¶œ[ â‡„Bâ‡„ ] âŸ†
       â€£ [[ (Î³á¶œ[ â‡„Bâ‡„ ] âŸ Î±á¶œ[ â‡„Bâ‡„ ]) âŸ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] âŸ Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] âŸ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ Î³á¶œ[ â‡„Bâ‡„ ] ] âŸ… Î±[f]âŠ‘fâ™¯ âŸ†
       â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯ ]]
       âˆ
    RHS : f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŠ‘â™® Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯ â†’ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯
    RHS fâŸÎ³âŠ‘Î³âŸfâ™¯ = let open ProofMode[âŠ‘] in [proof-mode]
      do [[ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f ]]
       â€£ [[ Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ Î±á¶œ[ â‡„Bâ‡„ ] ] âŸ… fâŸÎ³âŠ‘Î³âŸfâ™¯ âŸ†
       â€£ [[ Î±á¶œ[ â‡„Bâ‡„ ] âŸ Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯ ]]
       â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î±á¶œ[ â‡„Bâ‡„ ] âŸ Î³á¶œ[ â‡„Bâ‡„ ]) âŸ fâ™¯ ]]
       â€£ âŸ… left-unit-reductive[âŸ]á¶œ[ â‡„Bâ‡„ ] âŸ†
       â€£ [[ fâ™¯ ]]
       âˆ
  
Î³Î³á¶œ[*][_,_] :
  âˆ€ {â„“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : Poset â„“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª Aâ‚ â†— â„˜ Bâ‚ âŸ«} {fâ™¯ : âŸª Aâ‚‚ â†— â„˜ Bâ‚‚ âŸ«}
  â†’ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯ â†” (âˆ€ {x} â†’ f *â™® â‹… (Î³á¶œ[ â‡„Aâ‡„ ] â‹… x) âŠ‘â™® Î³á¶œ[ â‡„Bâ‡„ ] *â™® â‹… (fâ™¯ â‹… x))
Î³Î³á¶œ[*][ â‡„Aâ‡„ , â‡„Bâ‡„ ] {f} {fâ™¯} = âŸ¨ LHS , RHS âŸ©
  where
    LHS : Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯ â†’ âˆ€ {x} â†’ f *â™® â‹… (Î³á¶œ[ â‡„Aâ‡„ ] â‹… x) âŠ‘â™® Î³á¶œ[ â‡„Bâ‡„ ] *â™® â‹… (fâ™¯ â‹… x)
    LHS Î±[f]âŠ‘fâ™¯ {x} = res[f][â†—]â¸¢âŠ‘â¸£ {x = x} (Ï€â‚ Î³Î³á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] Î±[f]âŠ‘fâ™¯)
    RHS : (âˆ€ {x} â†’ f *â™® â‹… (Î³á¶œ[ â‡„Aâ‡„ ] â‹… x) âŠ‘â™® Î³á¶œ[ â‡„Bâ‡„ ] *â™® â‹… (fâ™¯ â‹… x)) â†’ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯
    RHS f[Î³[x]]âŠ‘Î³[fâ™¯[x]] = Ï€â‚‚ Î³Î³á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] $ ext[â†—]â¸¢âŠ‘â¸£ $ Î» {x} â†’ f[Î³[x]]âŠ‘Î³[fâ™¯[x]] {x}

Î³Î³á¶œ[â‹…][_,_] :
  âˆ€ {â„“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : Poset â„“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª Aâ‚ â†— â„˜ Bâ‚ âŸ«} {fâ™¯ : âŸª Aâ‚‚ â†— â„˜ Bâ‚‚ âŸ«}
  â†’ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯ â†” (âˆ€ {X} â†’ f *â™® â‹… (Î³á¶œ[ â‡„Aâ‡„ ] *â™® â‹… X) âŠ‘â™® Î³á¶œ[ â‡„Bâ‡„ ] *â™® â‹… (fâ™¯ *â™® â‹… X))
Î³Î³á¶œ[â‹…][ â‡„Aâ‡„ , â‡„Bâ‡„ ] {f} {fâ™¯} = âŸ¨ LHS , RHS âŸ©
  where
    LHS : Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯ â†’ âˆ€ {X} â†’ f *â™® â‹… (Î³á¶œ[ â‡„Aâ‡„ ] *â™® â‹… X) âŠ‘â™® Î³á¶œ[ â‡„Bâ‡„ ] *â™® â‹… (fâ™¯ *â™® â‹… X)
    LHS Î±[f]âŠ‘fâ™¯ {X} = let open ProofMode[âŠ‘] in [proof-mode]
      do [[ f *â™® â‹… (Î³á¶œ[ â‡„Aâ‡„ ] *â™® â‹… X) ]]
       â€£ âŸ… â—‡ associative[*] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (f âŸ Î³á¶œ[ â‡„Aâ‡„ ]) *â™® â‹… X ]]
       â€£ [focus-left [â‹…] ğ‘œğ‘“ X ] $ [focus-in [*] ] begin
           do [[ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
            â€£ âŸ… Ï€â‚ Î³Î³á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] Î±[f]âŠ‘fâ™¯ âŸ†
            â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯ ]]
           end
       â€£ [[ (Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯) *â™® â‹… X ]]
       â€£ âŸ… associative[*] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] *â™® â‹… (fâ™¯ *â™® â‹… X) ]]
       âˆ
    RHS : (âˆ€ {X} â†’ f *â™® â‹… (Î³á¶œ[ â‡„Aâ‡„ ] *â™® â‹… X) âŠ‘â™® Î³á¶œ[ â‡„Bâ‡„ ] *â™® â‹… (fâ™¯ *â™® â‹… X)) â†’ Î±[ â‡„Aâ‡„ â†—â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘â™® fâ™¯
    RHS f[Î³[X]]âŠ‘Î³[fâ™¯[X]] = Ï€â‚‚ Î³Î³á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] $ complete[*]â¸¢âŠ‘â¸£ $ ext[â†—]â¸¢âŠ‘â¸£ $ Î» {X} â†’ let open ProofMode[âŠ‘] in [proof-mode]
      do [[ (f âŸ Î³á¶œ[ â‡„Aâ‡„ ]) *â™® â‹… X ]]
       â€£ âŸ… associative[*] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ f *â™® â‹… (Î³á¶œ[ â‡„Aâ‡„ ] *â™® â‹… X) ]]
       â€£ âŸ… f[Î³[X]]âŠ‘Î³[fâ™¯[X]] âŸ†
       â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] *â™® â‹… (fâ™¯ *â™® â‹… X) ]]
       â€£ âŸ… â—‡ associative[*] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯) *â™® â‹… X ]]
       âˆ
