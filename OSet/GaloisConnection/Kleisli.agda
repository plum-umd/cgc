module OSet.GaloisConnection.Kleisli where

open import Prelude
open import OSet.OSet
open import OSet.Fun
open import OSet.Power
open import OSet.Product
open import OSet.Lib
open import OSet.ProofMode

open import OSet.GaloisConnection.Classical

infixr 4 _Î±â‡„Î³áµ_
record _Î±â‡„Î³áµ_ {ğ“} (A B : POSet ğ“) : Set (sucË¡ ğ“) where
  field
    Î±áµ[_] : âŸª A â‡’ ğ’« B âŸ«
    Î³áµ[_] : âŸª B â‡’ ğ’« A âŸ«
    expansiveáµ[_] : return âŠ‘ Î³áµ[_] âŸ Î±áµ[_]
    contractiveáµ[_] : Î±áµ[_] âŸ Î³áµ[_] âŠ‘ return
open _Î±â‡„Î³áµ_ public

expansiveâ†”soundáµ : âˆ€ {ğ“} {A B : POSet ğ“} {Î± : âŸª A â‡’ ğ’« B âŸ«} {Î³ : âŸª B â‡’ ğ’« A âŸ«} â†’ return âŠ‘ Î³ âŸ Î± â†” (âˆ€ {x} â†’ x â‹¿ Î³ * â‹… (Î± â‹… x))
expansiveâ†”soundáµ {A = A} {B} {Î±} {Î³} = LHS , RHS
  where
    LHS : return âŠ‘ Î³ âŸ Î± â†’ âˆ€ {x} â†’ x â‹¿ Î³ * â‹… (Î± â‹… x)
    LHS expansive = Ï€â‚ returnâ†”â‹¿ $ res-f[Î»]â¸¢âŠ‘â¸£ expansive
    RHS : (âˆ€ {x} â†’ x â‹¿ Î³ * â‹… (Î± â‹… x)) â†’ return âŠ‘ Î³ âŸ Î±
    RHS sound = ext[Î»]â¸¢âŠ‘â¸£ $ Ï€â‚‚ returnâ†”â‹¿ sound

contractiveâ†”completeáµ : âˆ€ {ğ“} {A B : POSet ğ“} {Î± : âŸª A â‡’ ğ’« B âŸ«} {Î³ : âŸª B â‡’ ğ’« A âŸ«} â†’ Î± âŸ Î³ âŠ‘ return â†” (âˆ€ {x^ y^} â†’ y^ â‹¿ Î± * â‹… (Î³ â‹… x^) â†’ y^ âŠ‘ x^)
contractiveâ†”completeáµ {A = A} {B} {Î±} {Î³} = LHS , RHS
  where
    LHS : Î± âŸ Î³ âŠ‘ return â†’ âˆ€ {x^ y^} â†’ y^ â‹¿ Î± * â‹… (Î³ â‹… x^) â†’ y^ âŠ‘ x^
    LHS contractive x^âˆˆÎ±[Î³[y^]] = Ï€â‚ returnâ†”â‹¿ $ res-f[Î»]â¸¢âŠ‘â¸£ contractive âŒ¾ Ï€â‚‚ returnâ†”â‹¿ x^âˆˆÎ±[Î³[y^]]
    RHS : (âˆ€ {x^ y^} â†’ y^ â‹¿ Î± * â‹… (Î³ â‹… x^) â†’ y^ âŠ‘ x^) â†’ Î± âŸ Î³ âŠ‘ return
    RHS complete = ext[Î»]â¸¢âŠ‘â¸£ $ ext[Ï‰]â¸¢âŠ‘â¸£ $ complete

soundáµ[_] : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„B : A Î±â‡„Î³áµ B) â†’ âˆ€ {x} â†’ x â‹¿ Î³áµ[ Aâ‡„B ] * â‹… (Î±áµ[ Aâ‡„B ] â‹… x)
soundáµ[ Aâ‡„B ] = Ï€â‚ expansiveâ†”soundáµ expansiveáµ[ Aâ‡„B ]

completeáµ[_] : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„B : A Î±â‡„Î³áµ B) â†’ âˆ€ {x^ y^} â†’ y^ â‹¿ Î±áµ[ Aâ‡„B ] * â‹… (Î³áµ[ Aâ‡„B ] â‹… x^) â†’ y^ âŠ‘ x^
completeáµ[ Aâ‡„B ] = Ï€â‚ contractiveâ†”completeáµ contractiveáµ[ Aâ‡„B ]

infixr 4 _Î±â‡„Î³áµâ¸¢â†‘â¸£_
record _Î±â‡„Î³áµâ¸¢â†‘â¸£_ {ğ“} (A B : Set ğ“) {{A-PO : PreOrder ğ“ A}} {{B-PO : PreOrder ğ“ B}} : Set (sucË¡ ğ“) where
  field
    Î±áµâ¸¢â†‘â¸£ : A â†’ B â†’ Set ğ“
    monotonic[Î±áµâ¸¢â†‘â¸£] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î±áµâ¸¢â†‘â¸£
    Î³áµâ¸¢â†‘â¸£ : B â†’ A â†’ Set ğ“
    monotonic[Î³áµâ¸¢â†‘â¸£] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î³áµâ¸¢â†‘â¸£
    sound[Î±Î³áµ]â¸¢â†‘â¸£ : âˆ€ {x : A} â†’ âˆƒ x^ ğ‘ ğ‘¡ Î±áµâ¸¢â†‘â¸£ x x^ Ã— Î³áµâ¸¢â†‘â¸£ x^ x
    complete[Î±Î³áµ]â¸¢â†‘â¸£ : âˆ€ {xâ‚^ xâ‚‚^ x} â†’ Î³áµâ¸¢â†‘â¸£ xâ‚^ x â†’ Î±áµâ¸¢â†‘â¸£ x xâ‚‚^ â†’ xâ‚‚^ âŠ´ xâ‚^

mk[Î±â‡„Î³áµ]â¸¢â†‘â¸£ :
  âˆ€ {ğ“} {A B : Set ğ“}
    {{A-PO : PreOrder ğ“ A}} {{A-REX : Reflexive (_âŠ´_ {A = A})}}
    {{B-PO : PreOrder ğ“ B}} {{B-REX : Reflexive (_âŠ´_ {A = B})}}
  â†’ A Î±â‡„Î³áµâ¸¢â†‘â¸£ B â†’ â‡§ A Î±â‡„Î³áµ â‡§ B
mk[Î±â‡„Î³áµ]â¸¢â†‘â¸£ {A = A} {B} Aâ‡„B = record
  { Î±áµ[_] = Î±
  ; Î³áµ[_] = Î³
  ; expansiveáµ[_] = Ï€â‚‚ expansiveâ†”soundáµ $ Î» {x} â†’ sound {x}
  ; contractiveáµ[_] = Ï€â‚‚ contractiveâ†”completeáµ complete
  }
  where
    open _Î±â‡„Î³áµâ¸¢â†‘â¸£_ Aâ‡„B
    Î± : âŸª â‡§ A â‡’ ğ’« (â‡§ B) âŸ«
    Î± = witness-x (curryâ¸¢Î»â†‘â¸£ idâ¸¢Ï‰â†‘â¸£) $ mk[witness] Î±áµâ¸¢â†‘â¸£ monotonic[Î±áµâ¸¢â†‘â¸£]
    Î³ : âŸª â‡§ B â‡’ ğ’« (â‡§ A) âŸ«
    Î³ = witness-x (curryâ¸¢Î»â†‘â¸£ idâ¸¢Ï‰â†‘â¸£) $ mk[witness] Î³áµâ¸¢â†‘â¸£ monotonic[Î³áµâ¸¢â†‘â¸£]
    sound : âˆ€ {x} â†’ x â‹¿ Î³ * â‹… (Î± â‹… x)
    sound {x} with sound[Î±Î³áµ]â¸¢â†‘â¸£ {x = â†“ x}
    ... | âˆƒ x^ ,, x^âˆˆÎ±[x] , xâˆˆÎ³[x^]  = âˆƒğ’« â†‘ x^ ,, x^âˆˆÎ±[x] ,, xâˆˆÎ³[x^]
    complete : âˆ€ {x^ y^} â†’ x^ â‹¿ Î± * â‹… (Î³ â‹… y^) â†’ x^ âŠ‘ y^
    complete (âˆƒğ’« x ,, xâˆˆÎ³[x^] ,, y^âˆˆÎ±[x]) = intro[âŠ‘]â¸¢â†“â¸£ $ complete[Î±Î³áµ]â¸¢â†‘â¸£ xâˆˆÎ³[x^] y^âˆˆÎ±[x]


Î±â‡„Î³áµâ†’Î±â‡„Î³ : âˆ€ {ğ“} {A B : POSet ğ“} â†’ A Î±â‡„Î³áµ B â†’ ğ’« A Î±â‡„Î³ ğ’« B
Î±â‡„Î³áµâ†’Î±â‡„Î³ Aâ‡„B = record
  { Î±[_] = Î±áµ[ Aâ‡„B ] *
  ; Î³[_] = Î³áµ[ Aâ‡„B ] *
  ; expansive[_] = [âŠ‘-proof-mode]
      do [âŠ‘][[ â†‘id ]]
      âŠ‘â€£ [âŠ‘-â‰ˆ] return * âŸ… â—‡ left-unit[*]â¸¢idâ¸£ âŸ†
      âŠ‘â€£ [âŠ‘-focus-in [*] ] [âŠ‘] Î³áµ[ Aâ‡„B ] âŸ Î±áµ[ Aâ‡„B ] âŸ… expansiveáµ[ Aâ‡„B ] âŸ†
      âŠ‘â€£ [âŠ‘][[ (Î³áµ[ Aâ‡„B ] âŸ Î±áµ[ Aâ‡„B ]) * ]]
      âŠ‘â€£ [âŠ‘-â‰ˆ] Î³áµ[ Aâ‡„B ] * âŠ™ Î±áµ[ Aâ‡„B ] * âŸ… associative[âŸ]â¸¢âŠ™â¸£ âŸ†
      â¬œ
  ; contractive[_] = [âŠ‘-proof-mode]
      do [âŠ‘][[ Î±áµ[ Aâ‡„B ] * âŠ™ Î³áµ[ Aâ‡„B ] * ]]
      âŠ‘â€£ [âŠ‘-â‰ˆ] (Î±áµ[ Aâ‡„B ] âŸ Î³áµ[ Aâ‡„B ]) * âŸ… â—‡ associative[âŸ]â¸¢âŠ™â¸£ âŸ†
      âŠ‘â€£ [âŠ‘-focus-in [*] ] [âŠ‘] return âŸ… contractiveáµ[ Aâ‡„B ] âŸ†
      âŠ‘â€£ [âŠ‘][[ return * ]]
      âŠ‘â€£ [âŠ‘-â‰ˆ] â†‘id âŸ… left-unit[*]â¸¢idâ¸£ âŸ†
      â¬œ
  }

weaken[Î±]áµ : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A Î±â‡„Î³áµ B) â†’ Î³áµ[ Aâ‡„Bâ‚‚ ] âŠ‘ Î³áµ[ Aâ‡„Bâ‚ ] â†’ Î±áµ[ Aâ‡„Bâ‚ ] âŠ‘ Î±áµ[ Aâ‡„Bâ‚‚ ]
weaken[Î±]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î³â‚‚âŠ‘Î³â‚ = [âŠ‘-proof-mode]
  do [âŠ‘][[ Î±áµ[ Aâ‡„Bâ‚ ] ]]
  âŠ‘â€£ [âŠ‘-â‰ˆ] Î±áµ[ Aâ‡„Bâ‚ ] âŸ return âŸ… â—‡ right-unit[âŸ] âŸ†
  âŠ‘â€£ [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„Bâ‚ ] ] begin
       do [âŠ‘] Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] âŸ… expansiveáµ[ Aâ‡„Bâ‚‚ ] âŸ†
       âŠ‘â€£ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„Bâ‚‚ ] ] [âŠ‘] Î³áµ[ Aâ‡„Bâ‚ ] âŸ… Î³â‚‚âŠ‘Î³â‚ âŸ†
       end
  âŠ‘â€£ [âŠ‘][[ Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] ]]
  âŠ‘â€£ [âŠ‘-â‰ˆ] (Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚ ]) âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] âŸ… â—‡ associative[âŸ] âŸ†
  âŠ‘â€£ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„Bâ‚‚ ] ] [âŠ‘] return âŸ… contractiveáµ[ Aâ‡„Bâ‚ ] âŸ†
  âŠ‘â€£ [âŠ‘][[ return âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] ]]
  âŠ‘â€£ [âŠ‘-â‰ˆ] Î±áµ[ Aâ‡„Bâ‚‚ ] âŸ… left-unit[âŸ] âŸ†
  â¬œ

unique[Î±]áµ : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A Î±â‡„Î³áµ B) â†’ Î³áµ[ Aâ‡„Bâ‚ ] â‰ˆ Î³áµ[ Aâ‡„Bâ‚‚ ] â†’ Î±áµ[ Aâ‡„Bâ‚ ] â‰ˆ Î±áµ[ Aâ‡„Bâ‚‚ ]
unique[Î±]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î³â‚â‰ˆÎ³â‚‚ = â‹ˆ[] (weaken[Î±]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ $ xRx[] $ â—‡ Î³â‚â‰ˆÎ³â‚‚) (weaken[Î±]áµ Aâ‡„Bâ‚‚ Aâ‡„Bâ‚ $ xRx[] Î³â‚â‰ˆÎ³â‚‚)

weaken[Î³]áµ : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A Î±â‡„Î³áµ B) â†’ Î±áµ[ Aâ‡„Bâ‚‚ ] âŠ‘ Î±áµ[ Aâ‡„Bâ‚ ] â†’ Î³áµ[ Aâ‡„Bâ‚ ] âŠ‘ Î³áµ[ Aâ‡„Bâ‚‚ ]
weaken[Î³]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î±â‚‚âŠ‘Î±â‚ = [âŠ‘-proof-mode]
  do [âŠ‘][[ Î³áµ[ Aâ‡„Bâ‚ ] ]]
  âŠ‘â€£ [âŠ‘-â‰ˆ] return âŸ Î³áµ[ Aâ‡„Bâ‚ ] âŸ… â—‡ left-unit[âŸ] âŸ†
  âŠ‘â€£ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ Î³áµ[ Aâ‡„Bâ‚ ] ] begin
       do [âŠ‘] Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] âŸ… expansiveáµ[ Aâ‡„Bâ‚‚ ] âŸ†
       âŠ‘â€£ [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ Aâ‡„Bâ‚‚ ] ] [âŠ‘] Î±áµ[ Aâ‡„Bâ‚ ] âŸ… Î±â‚‚âŠ‘Î±â‚ âŸ†
       end
  âŠ‘â€£ [âŠ‘][[ (Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚ ]) âŸ Î³áµ[ Aâ‡„Bâ‚ ] ]]
  âŠ‘â€£ [âŠ‘-â‰ˆ] Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚ ] âŸ… associative[âŸ] âŸ†
  âŠ‘â€£ [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ Aâ‡„Bâ‚‚ ] ] [âŠ‘] return âŸ… contractiveáµ[ Aâ‡„Bâ‚ ] âŸ†
  âŠ‘â€£ [âŠ‘][[ Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ return ]]
  âŠ‘â€£ [âŠ‘-â‰ˆ] Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ… right-unit[âŸ] âŸ†
  â¬œ

unique[Î³]áµ : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A Î±â‡„Î³áµ B) â†’ Î±áµ[ Aâ‡„Bâ‚ ] â‰ˆ Î±áµ[ Aâ‡„Bâ‚‚ ] â†’ Î³áµ[ Aâ‡„Bâ‚ ] â‰ˆ Î³áµ[ Aâ‡„Bâ‚‚ ]
unique[Î³]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î±â‚â‰ˆÎ±â‚‚ = â‹ˆ[] (weaken[Î³]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ $ xRx[] $ â—‡ Î±â‚â‰ˆÎ±â‚‚) (weaken[Î³]áµ Aâ‡„Bâ‚‚ Aâ‡„Bâ‚ $ xRx[] Î±â‚â‰ˆÎ±â‚‚)

xRxâ¸¢Î±â‡„Î³áµâ¸£ : âˆ€ {ğ“} {A : POSet ğ“} â†’ A Î±â‡„Î³áµ A
xRxâ¸¢Î±â‡„Î³áµâ¸£ = record
  { Î±áµ[_] = return
  ; Î³áµ[_] = return
  ; expansiveáµ[_] = xRx[] $ â—‡ left-unit[âŸ]
  ; contractiveáµ[_] = xRx[] left-unit[âŸ]
  }

infixr 9 _âŒ¾â¸¢Î±â‡„Î³áµâ¸£_
_âŒ¾â¸¢Î±â‡„Î³áµâ¸£_ : âˆ€ {ğ“} {A B C : POSet ğ“} â†’ B Î±â‡„Î³áµ C â†’ A Î±â‡„Î³áµ B â†’ A Î±â‡„Î³áµ C
Bâ‡„C âŒ¾â¸¢Î±â‡„Î³áµâ¸£ Aâ‡„B = record
  { Î±áµ[_] = Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]
  ; Î³áµ[_] = Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]
  ; expansiveáµ[_] = [âŠ‘-proof-mode]
      do [âŠ‘][[ return ]]
      âŠ‘â€£ [âŠ‘] Î³áµ[ Aâ‡„B ] âŸ Î±áµ[ Aâ‡„B ] âŸ… expansiveáµ[ Aâ‡„B ] âŸ†
      âŠ‘â€£ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„B ] ] begin
           do [âŠ‘-â‰ˆ] Î³áµ[ Aâ‡„B ] âŸ return âŸ… â—‡ right-unit[âŸ] âŸ†
           âŠ‘â€£ [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ Aâ‡„B ] ] [âŠ‘] Î³áµ[ Bâ‡„C ] âŸ Î±áµ[ Bâ‡„C ] âŸ… expansiveáµ[ Bâ‡„C ] âŸ†
           âŠ‘â€£ [âŠ‘][[ Î³áµ[ Aâ‡„B ] âŸ (Î³áµ[ Bâ‡„C ] âŸ Î±áµ[ Bâ‡„C ]) ]]
           end
      âŠ‘â€£ [âŠ‘][[ (Î³áµ[ Aâ‡„B ] âŸ (Î³áµ[ Bâ‡„C ] âŸ Î±áµ[ Bâ‡„C ])) âŸ Î±áµ[ Aâ‡„B ] ]]
      âŠ‘â€£ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„B ] ] [âŠ‘-â‰ˆ] (Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) âŸ Î±áµ[ Bâ‡„C ] âŸ… â—‡ associative[âŸ] âŸ†
      âŠ‘â€£ [âŠ‘][[ ((Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) âŸ Î±áµ[ Bâ‡„C ]) âŸ Î±áµ[ Aâ‡„B ] ]]
      âŠ‘â€£ [âŠ‘-â‰ˆ] (Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) âŸ (Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) âŸ… associative[âŸ] âŸ†
      â¬œ
  ; contractiveáµ[_] = [âŠ‘-proof-mode]
      do [âŠ‘][[ (Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) âŸ (Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) ]]
      âŠ‘â€£ [âŠ‘-â‰ˆ] ((Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) âŸ Î³áµ[ Aâ‡„B ]) âŸ Î³áµ[ Bâ‡„C ] âŸ… â—‡ associative[âŸ] âŸ†
      âŠ‘â€£ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ Î³áµ[ Bâ‡„C ] ] begin
           do [âŠ‘-â‰ˆ] Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ] âŸ Î³áµ[ Aâ‡„B ] âŸ… associative[âŸ] âŸ†
           âŠ‘â€£ [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ Î±áµ[ Bâ‡„C ] ] [âŠ‘] return âŸ… contractiveáµ[ Aâ‡„B ] âŸ†
           âŠ‘â€£ [âŠ‘][[ Î±áµ[ Bâ‡„C ] âŸ return ]]
           âŠ‘â€£ [âŠ‘-â‰ˆ] Î±áµ[ Bâ‡„C ] âŸ… right-unit[âŸ] âŸ†
           end
      âŠ‘â€£ [âŠ‘][[ Î±áµ[ Bâ‡„C ] âŸ Î³áµ[ Bâ‡„C ] ]]
      âŠ‘â€£ [âŠ‘] return âŸ… contractiveáµ[ Bâ‡„C ] âŸ†
      â¬œ
  }

infixr 4 _â‡’â¸¢Î±â‡„Î³áµâ¸£_
_â‡’â¸¢Î±â‡„Î³áµâ¸£_ : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} â†’ Aâ‚ Î±â‡„Î³áµ Bâ‚ â†’ Aâ‚‚ Î±â‡„Î³áµ Bâ‚‚ â†’ (Aâ‚ â‡’ ğ’« Aâ‚‚) Î±â‡„Î³ (Bâ‚ â‡’ ğ’« Bâ‚‚)
_â‡’â¸¢Î±â‡„Î³áµâ¸£_ {Aâ‚ = Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} Aâ‚â‡„Bâ‚ Aâ‚‚â‡„Bâ‚‚ = record
  { Î±[_] = Î±
  ; Î³[_] = Î³
  ; expansive[_] = ext[Î»]â¸¢âŠ‘â¸£ $ Î» {f} â†’ [âŠ‘-proof-mode]
      do [âŠ‘][[ f ]]
      âŠ‘â€£ [âŠ‘-â‰ˆ] return âŸ f âŸ… â—‡ left-unit[âŸ] âŸ†
      âŠ‘â€£ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ f ] [âŠ‘] Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ… expansiveáµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ†
      âŠ‘â€£ [âŠ‘][[ (Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ]) âŸ f ]]
      âŠ‘â€£ [âŠ‘-â‰ˆ] Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f âŸ… associative[âŸ] âŸ†
      âŠ‘â€£ [âŠ‘-â‰ˆ] (Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f) âŸ return âŸ… â—‡ right-unit[âŸ] âŸ†
      âŠ‘â€£ [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ (Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f) ] [âŠ‘] Î³áµ[ Aâ‚â‡„Bâ‚ ] âŸ Î±áµ[ Aâ‚â‡„Bâ‚ ] âŸ… expansiveáµ[ Aâ‚â‡„Bâ‚ ] âŸ†
      âŠ‘â€£ [âŠ‘][[ (Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f) âŸ Î³áµ[ Aâ‚â‡„Bâ‚ ] âŸ Î±áµ[ Aâ‚â‡„Bâ‚ ] ]]
      âŠ‘â€£ [âŠ‘-â‰ˆ]  Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ (Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f) âŸ Î³áµ[ Aâ‚â‡„Bâ‚ ] âŸ Î±áµ[ Aâ‚â‡„Bâ‚ ] âŸ… associative[âŸ] âŸ†
      âŠ‘â€£ [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] ] begin
           do [âŠ‘-â‰ˆ] ((Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f) âŸ Î³áµ[ Aâ‚â‡„Bâ‚ ]) âŸ Î±áµ[ Aâ‚â‡„Bâ‚ ] âŸ… â—‡ associative[âŸ] âŸ†
           âŠ‘â€£ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‚â‡„Bâ‚ ] ] [âŠ‘-â‰ˆ] Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f âŸ Î³áµ[ Aâ‚â‡„Bâ‚ ] âŸ… associative[âŸ] âŸ†
           âŠ‘â€£ [âŠ‘][[ (Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f âŸ Î³áµ[ Aâ‚â‡„Bâ‚ ]) âŸ Î±áµ[ Aâ‚â‡„Bâ‚ ] ]]
           end
      âŠ‘â€£ [âŠ‘][[ Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ (Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f âŸ Î³áµ[ Aâ‚â‡„Bâ‚ ]) âŸ Î±áµ[ Aâ‚â‡„Bâ‚ ] ]]
      âŠ‘â€£ [âŠ‘-â‰¡] (Î³ âŠ™ Î±) â‹… f âŸ… â†¯ âŸ†
      â¬œ
  ; contractive[_] = ext[Î»]â¸¢âŠ‘â¸£ $ Î» {f} â†’ [âŠ‘-proof-mode]
      do [âŠ‘][[ (Î± âŠ™ Î³) â‹… f ]]
      âŠ‘â€£ [âŠ‘-â‰¡] Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ (Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f âŸ Î±áµ[ Aâ‚â‡„Bâ‚ ]) âŸ Î³áµ[ Aâ‚â‡„Bâ‚ ] âŸ… â†¯ âŸ†
      âŠ‘â€£ [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] ] begin
           do [âŠ‘-â‰ˆ] Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ (f âŸ Î±áµ[ Aâ‚â‡„Bâ‚ ]) âŸ Î³áµ[ Aâ‚â‡„Bâ‚ ] âŸ… associative[âŸ] âŸ†
           âŠ‘â€£ [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] ] begin
                do [âŠ‘-â‰ˆ] f âŸ Î±áµ[ Aâ‚â‡„Bâ‚ ] âŸ Î³áµ[ Aâ‚â‡„Bâ‚ ] âŸ… associative[âŸ] âŸ†
                âŠ‘â€£ [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ f ] [âŠ‘] return âŸ… contractiveáµ[ Aâ‚â‡„Bâ‚ ] âŸ†
                âŠ‘â€£ [âŠ‘-â‰ˆ] f âŸ… right-unit[âŸ] âŸ†
                end
           end
      âŠ‘â€£ [âŠ‘][[ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f ]]
      âŠ‘â€£ [âŠ‘-â‰ˆ] (Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ]) âŸ f âŸ… â—‡ associative[âŸ] âŸ†
      âŠ‘â€£ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ f ] [âŠ‘] return âŸ… contractiveáµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ†
      âŠ‘â€£ [âŠ‘-â‰ˆ] f âŸ… left-unit[âŸ] âŸ†
      â¬œ
  }
  where
    Î±-fun : âŸª Aâ‚ â‡’ ğ’« Aâ‚‚ âŸ« â†’ âŸª Bâ‚ â‡’ ğ’« Bâ‚‚ âŸ«
    Î±-fun f = Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f âŸ Î³áµ[ Aâ‚â‡„Bâ‚ ]
    abstract
      Î±-ppr : proper (_âŠ‘_ â‡‰ _âŠ‘_) Î±-fun
      Î±-ppr fâ‚âŠ‘fâ‚‚ = [âŠ‘-proof-mode] [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ _ ] $ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ _ ] [âŠ‘] _ âŸ… fâ‚âŠ‘fâ‚‚ âŸ† â¬œ
    Î± : âŸª (Aâ‚ â‡’ ğ’« Aâ‚‚) â‡’ (Bâ‚ â‡’ ğ’« Bâ‚‚) âŸ«
    Î± = witness-x (curryâ¸¢Î»â¸£ idâ¸¢Î»â¸£) $ mk[witness] Î±-fun Î±-ppr
    Î³-fun : âŸª Bâ‚ â‡’ ğ’« Bâ‚‚ âŸ« â†’ âŸª Aâ‚ â‡’ ğ’« Aâ‚‚ âŸ«
    Î³-fun f^ = Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] âŸ f^ âŸ Î±áµ[ Aâ‚â‡„Bâ‚ ]
    abstract
      Î³-ppr : proper (_âŠ‘_ â‡‰ _âŠ‘_) Î³-fun
      Î³-ppr fâ‚âŠ‘fâ‚‚ = [âŠ‘-proof-mode] [âŠ‘-focus-right [âŸ] ğ‘œğ‘“ _ ] $ [âŠ‘-focus-left [âŸ] ğ‘œğ‘“ _ ] [âŠ‘] _ âŸ… fâ‚âŠ‘fâ‚‚ âŸ† â¬œ
    Î³ : âŸª (Bâ‚ â‡’ ğ’« Bâ‚‚) â‡’ (Aâ‚ â‡’ ğ’« Aâ‚‚) âŸ«
    Î³ = witness-x (curryâ¸¢Î»â¸£ idâ¸¢Î»â¸£) $ mk[witness] Î³-fun Î³-ppr

_Ã—â¸¢Î±â‡„Î³áµâ¸£_ : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} â†’ Aâ‚ Î±â‡„Î³áµ Bâ‚ â†’ Aâ‚‚ Î±â‡„Î³áµ Bâ‚‚ â†’ (Aâ‚ âŸ¨Ã—âŸ© Aâ‚‚) Î±â‡„Î³áµ (Bâ‚ âŸ¨Ã—âŸ© Bâ‚‚)
_Ã—â¸¢Î±â‡„Î³áµâ¸£_ {ğ“} {Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} Aâ‚â‡„Bâ‚ Aâ‚‚â‡„Bâ‚‚ = mk[Î±â‡„Î³áµ]â¸¢â†‘â¸£ $ record
  { Î±áµâ¸¢â†‘â¸£ = Î±
  ; monotonic[Î±áµâ¸¢â†‘â¸£] = monotonic[Î±]
  ; Î³áµâ¸¢â†‘â¸£ = Î³
  ; monotonic[Î³áµâ¸¢â†‘â¸£] = monotonic[Î³]
  ; sound[Î±Î³áµ]â¸¢â†‘â¸£ = sound
  ; complete[Î±Î³áµ]â¸¢â†‘â¸£ = complete
  }
  where
    Î± : prod Aâ‚ Aâ‚‚ â†’ prod Bâ‚ Bâ‚‚ â†’ Set ğ“
    Î± (x , y) (x^ , y^) = (x^ â‹¿ Î±áµ[ Aâ‚â‡„Bâ‚ ] â‹… x) Ã— (y^ â‹¿ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] â‹… y)
    abstract
      monotonic[Î±] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î±
      monotonic[Î±] (xâ‚âŠ‘xâ‚‚ , yâ‚âŠ‘yâ‚‚) (xâ‚^âŠ’xâ‚‚^ , yâ‚^âŠ’yâ‚‚^) (xâ‚^âˆˆÎ±[xâ‚] , yâ‚^âˆˆÎ±[yâ‚]) =
          res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î±áµ[ Aâ‚â‡„Bâ‚ ]} xâ‚âŠ‘xâ‚‚) xâ‚^âŠ’xâ‚‚^ xâ‚^âˆˆÎ±[xâ‚]
        , res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ]} yâ‚âŠ‘yâ‚‚) yâ‚^âŠ’yâ‚‚^ yâ‚^âˆˆÎ±[yâ‚]
    Î³ : prod Bâ‚ Bâ‚‚ â†’ prod Aâ‚ Aâ‚‚ â†’ Set ğ“
    Î³ (x^ , y^) (x , y) = (x â‹¿ Î³áµ[ Aâ‚â‡„Bâ‚ ] â‹… x^) Ã— (y â‹¿ Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] â‹… y^)
    abstract
      monotonic[Î³] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î³
      monotonic[Î³] (xâ‚^âŠ‘xâ‚‚^ , yâ‚^âŠ‘yâ‚‚^) (xâ‚âŠ’xâ‚‚ , yâ‚âŠ’yâ‚‚) (xâ‚âˆˆÎ³[xâ‚^] , yâ‚âˆˆÎ³[yâ‚^]) =
          res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î³áµ[ Aâ‚â‡„Bâ‚ ]} xâ‚^âŠ‘xâ‚‚^) xâ‚âŠ’xâ‚‚ xâ‚âˆˆÎ³[xâ‚^]
        , res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ]} yâ‚^âŠ‘yâ‚‚^) yâ‚âŠ’yâ‚‚ yâ‚âˆˆÎ³[yâ‚^]
    sound : âˆ€ {xy : prod Aâ‚ Aâ‚‚} â†’ âˆƒ xy^ ğ‘ ğ‘¡ Î± xy xy^ Ã— Î³ xy^ xy
    sound {x , y} with soundáµ[ Aâ‚â‡„Bâ‚ ] {x} | soundáµ[ Aâ‚‚â‡„Bâ‚‚ ] {y}
    ... | âˆƒğ’« x^ ,, x^âˆˆÎ±[x] ,, xâˆˆÎ³[x^] | âˆƒğ’« y^ ,, yâˆˆÎ±[y^] ,, y^âˆˆÎ³[y] = âˆƒ (x^ , y^) ,, (x^âˆˆÎ±[x] , yâˆˆÎ±[y^]) , (xâˆˆÎ³[x^] , y^âˆˆÎ³[y])
    complete : âˆ€ {xyâ‚^ xyâ‚‚^ : prod Bâ‚ Bâ‚‚} {xy : prod Aâ‚ Aâ‚‚} â†’ Î³ xyâ‚^ xy â†’ Î± xy xyâ‚‚^ â†’ xyâ‚‚^ âŠ´ xyâ‚^
    complete {xâ‚^ , yâ‚^} {xâ‚‚^ , yâ‚‚^} {x , y} (xâˆˆÎ³[xâ‚^] , yâˆˆÎ³[yâ‚^]) (xâ‚‚^âˆˆÎ±[x] , yâ‚‚^âˆˆÎ±[y]) =
        (completeáµ[ Aâ‚â‡„Bâ‚ ] $ âˆƒğ’« x ,, xâˆˆÎ³[xâ‚^] ,, xâ‚‚^âˆˆÎ±[x])
      , (completeáµ[ Aâ‚‚â‡„Bâ‚‚ ] $ âˆƒğ’« y ,, yâˆˆÎ³[yâ‚^] ,, yâ‚‚^âˆˆÎ±[y])
