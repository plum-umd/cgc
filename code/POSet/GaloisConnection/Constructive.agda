module POSet.GaloisConnection.Constructive where

open import Prelude
open import POSet.POSet
open import POSet.Fun
open import POSet.Power
open import POSet.Product
open import POSet.ProofMode
open import POSet.Lib
open import POSet.PowerMonad

open import POSet.GaloisConnection.Classical
open import POSet.GaloisConnection.Kleisli

infixr 4 _â‡„á¶œ_
record _â‡„á¶œ_ {ğ“} (A B : POSet ğ“) : Set (sucË¡ ğ“) where
  field
    Î·á¶œ[_] : âŸª A â‡’ B âŸ«
    Î³á¶œ[_] : âŸª B â‡’ ğ’« A âŸ«
    expansiveá¶œ[xâŸ][_] : return âŠ‘ Î³á¶œ[_] âŸ pure â‹… Î·á¶œ[_]
    contractiveá¶œ[xâŸ][_] : pure â‹… Î·á¶œ[_] âŸ Î³á¶œ[_] âŠ‘ return
open _â‡„á¶œ_ public

Î±á¶œ[_] : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„B : A â‡„á¶œ B) â†’ âŸª A â‡’ ğ’« B âŸ«
Î±á¶œ[ Aâ‡„B ] = pure â‹… Î·á¶œ[ Aâ‡„B ]

expansiveá¶œ[x*][_] : âˆ€ {ğ“} {A B : POSet ğ“} (â‡„Aâ‡„ : A â‡„á¶œ B) {x : âŸª A âŸ«} â†’ return â‹… x âŠ‘ Î³á¶œ[ â‡„Aâ‡„ ] * â‹… (Î±á¶œ[ â‡„Aâ‡„ ] â‹… x)
expansiveá¶œ[x*][ â‡„Aâ‡„ ] {x} = res-f[â‡’]â¸¢âŠ‘â¸£ expansiveá¶œ[xâŸ][ â‡„Aâ‡„ ]

contractive[x*][_] : âˆ€ {ğ“} {A B : POSet ğ“} (â‡„Aâ‡„ : A â‡„á¶œ B) {y : âŸª B âŸ«} â†’ Î±á¶œ[ â‡„Aâ‡„ ] * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] â‹… y) âŠ‘ return â‹… y
contractive[x*][ â‡„Aâ‡„ ] = res-f[â‡’]â¸¢âŠ‘â¸£ contractiveá¶œ[xâŸ][ â‡„Aâ‡„ ]

expansive[XâŠ™][_] : âˆ€ {ğ“} {A B : POSet ğ“} (â‡„Aâ‡„ : A â‡„á¶œ B) â†’ idâº âŠ‘ Î³á¶œ[ â‡„Aâ‡„ ] * âŠ™ Î±á¶œ[ â‡„Aâ‡„ ] *
expansive[XâŠ™][ â‡„Aâ‡„ ] = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ idâº ]]
   â€£ âŸ… â—‡ left-unit[*]â¸¢extâ¸£ âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ return * ]]
   â€£ [focus-in [*] ] begin
       do [[ return ]]
        â€£ âŸ… expansiveá¶œ[xâŸ][ â‡„Aâ‡„ ] âŸ†
        â€£ [[ Î³á¶œ[ â‡„Aâ‡„ ] âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
       end
   â€£ [[ (Î³á¶œ[ â‡„Aâ‡„ ] âŸ Î±á¶œ[ â‡„Aâ‡„ ]) * ]]
   â€£ âŸ… associative[*]â¸¢âŠ™â¸£ âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ Î³á¶œ[ â‡„Aâ‡„ ] * âŠ™ Î±á¶œ[ â‡„Aâ‡„ ] * ]]
   âˆ

contractive[XâŠ™][_] : âˆ€ {ğ“} {A B : POSet ğ“} (â‡„Aâ‡„ : A â‡„á¶œ B) â†’ Î±á¶œ[ â‡„Aâ‡„ ] * âŠ™ Î³á¶œ[ â‡„Aâ‡„ ] * âŠ‘ idâº
contractive[XâŠ™][ â‡„Aâ‡„ ] = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ Î±á¶œ[ â‡„Aâ‡„ ] * âŠ™ Î³á¶œ[ â‡„Aâ‡„ ] * ]]
   â€£ âŸ… â—‡ associative[*]â¸¢âŠ™â¸£ âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ (Î±á¶œ[ â‡„Aâ‡„ ] * âŠ™ Î³á¶œ[ â‡„Aâ‡„ ]) * ]]
   â€£ [focus-in [*] ] begin
       do [[ Î±á¶œ[ â‡„Aâ‡„ ] * âŠ™ Î³á¶œ[ â‡„Aâ‡„ ] ]]
        â€£ âŸ… contractiveá¶œ[xâŸ][ â‡„Aâ‡„ ] âŸ†
        â€£ [[ return ]]
       end
   â€£ [[ return * ]]
   â€£ âŸ… left-unit[*]â¸¢extâ¸£ âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ idâº ]]
   âˆ

expansiveá¶œ[X*][_] : âˆ€ {ğ“} {A B : POSet ğ“} (â‡„Aâ‡„ : A â‡„á¶œ B) {X : âŸª ğ’« A âŸ«} â†’ X âŠ‘ Î³á¶œ[ â‡„Aâ‡„ ] * â‹… (Î±á¶œ[ â‡„Aâ‡„ ] * â‹… X)
expansiveá¶œ[X*][ â‡„Aâ‡„ ] = res-f[â‡’]â¸¢âŠ‘â¸£ expansive[XâŠ™][ â‡„Aâ‡„ ]

contractiveá¶œ[X*][_] : âˆ€ {ğ“} {A B : POSet ğ“} (â‡„Aâ‡„ : A â‡„á¶œ B) {Y : âŸª ğ’« B âŸ«} â†’ Î±á¶œ[ â‡„Aâ‡„ ] * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] * â‹… Y) âŠ‘ Y
contractiveá¶œ[X*][ â‡„Aâ‡„ ] = res-f[â‡’]â¸¢âŠ‘â¸£ contractive[XâŠ™][ â‡„Aâ‡„ ]

-- expansiveâ†”â¸¢pureâ¸£ : âˆ€ {ğ“} {A B : POSet ğ“} {Î· : âŸª A â‡’ B âŸ«} {Î³ : âŸª B â‡’ ğ’« A âŸ«} â†’ return âŠ‘ Î³ âŸ pure â‹… Î· â†” return âŠ‘ Î³ âŠ™ Î·
-- expansiveâ†”â¸¢pureâ¸£ {A = A} {B} {Î·} {Î³} = LHS , RHS
--   where
--     LHS : return âŠ‘ Î³ âŸ pure â‹… Î· â†’ return âŠ‘ Î³ âŠ™ Î·
--     LHS returnâŠ‘Î³âŸÎ· = xRx[] right-unit[âŸ]â¸¢pureâ¸£ âŒ¾ returnâŠ‘Î³âŸÎ·
--     RHS : return âŠ‘ Î³ âŠ™ Î· â†’ return âŠ‘ Î³ âŸ pure â‹… Î·
--     RHS returnâŠ‘Î³âŠ™Î· = xRx[] (â—‡ right-unit[âŸ]â¸¢pureâ¸£) âŒ¾ returnâŠ‘Î³âŠ™Î·

expansiveâ†”soundá¶œ : âˆ€ {ğ“} {A B : POSet ğ“} {Î· : âŸª A â‡’ B âŸ«} {Î³ : âŸª B â‡’ ğ’« A âŸ«} â†’ return âŠ‘ Î³ âŸ pure â‹… Î· â†” (âˆ€ {x} â†’ x â‹¿ Î³ â‹… (Î· â‹… x))
expansiveâ†”soundá¶œ {A = A} {B} {Î·} {Î³} = LHS , RHS
  where
    LHS : return âŠ‘ Î³ âŸ pure â‹… Î· â†’ âˆ€ {x} â†’ x â‹¿ Î³ â‹… (Î· â‹… x)
    LHS expansive = Ï€â‚ returnâ†”â‹¿ $ res-f[â‡’]â¸¢âŠ‘â¸£ $ xRx[] right-unit[âŸ]â¸¢pureâ¸£ âŒ¾ expansive
    RHS : (âˆ€ {x} â†’ x â‹¿ Î³ â‹… (Î· â‹… x)) â†’ return âŠ‘ Î³ âŸ pure â‹… Î·
    RHS sound = xRx[] (â—‡ right-unit[âŸ]â¸¢pureâ¸£) âŒ¾ ext[â‡’]â¸¢âŠ‘â¸£ (Ï€â‚‚ returnâ†”â‹¿ sound)

contractiveâ†”completeá¶œ : âˆ€ {ğ“} {A B : POSet ğ“} {Î· : âŸª A â‡’ B âŸ«} {Î³ : âŸª B â‡’ ğ’« A âŸ«} â†’ pure â‹… Î· âŸ Î³ âŠ‘ return â†” (âˆ€ {xâ™¯ x} â†’ x â‹¿ Î³ â‹… xâ™¯ â†’ Î· â‹… x âŠ‘ xâ™¯)
contractiveâ†”completeá¶œ {A = A} {B} {Î·} {Î³} = LHS , RHS
  where
    LHS : pure â‹… Î· âŸ Î³ âŠ‘ return â†’ âˆ€ {xâ™¯ x} â†’ x â‹¿ Î³ â‹… xâ™¯ â†’ Î· â‹… x âŠ‘ xâ™¯
    LHS contractive {xâ™¯} {x} xâˆˆÎ³[xâ™¯] = Ï€â‚ returnâ†”â‹¿ $ res-f[â‡’]â¸¢âŠ‘â¸£ contractive âŒ¾ let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ (pure â‹… Î·) â‹… x ]]
       â€£ âŸ… â—‡ right-unit[*] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (pure â‹… Î·) * â‹… (return â‹… x) ]]
       â€£ [focus-right [â‹…] ğ‘œğ‘“ (pure â‹… Î·) * ] âŸ… Ï€â‚‚ returnâ†”â‹¿ xâˆˆÎ³[xâ™¯] âŸ†
       â€£ [[ (pure â‹… Î·) * â‹… (Î³ â‹… xâ™¯) ]]
       âˆ
    RHS : (âˆ€ {xâ™¯ x} â†’ x â‹¿ Î³ â‹… xâ™¯ â†’ Î· â‹… x âŠ‘ xâ™¯) â†’ pure â‹… Î· âŸ Î³ âŠ‘ return
    RHS complete = ext[â‡’]â¸¢âŠ‘â¸£ $ ext[ğ’«]â¸¢âŠ‘â¸£ H
      where
        H : âˆ€ {xâ™¯ yâ™¯} â†’ yâ™¯ â‹¿ (pure â‹… Î·) * â‹… (Î³ â‹… xâ™¯) â†’ yâ™¯ âŠ‘ xâ™¯
        H (âˆƒğ’« x ,, xâˆˆÎ³[xâ™¯] ,, yâ™¯âŠ‘Î·[x]) = complete xâˆˆÎ³[xâ™¯] âŒ¾ yâ™¯âŠ‘Î·[x]

soundá¶œ[_] : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„B : A â‡„á¶œ B) â†’ âˆ€ {x} â†’ x â‹¿ Î³á¶œ[ Aâ‡„B ] â‹… (Î·á¶œ[ Aâ‡„B ] â‹… x)
soundá¶œ[ Aâ‡„B ] = Ï€â‚ expansiveâ†”soundá¶œ expansiveá¶œ[xâŸ][ Aâ‡„B ]

completeá¶œ[_] : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„B : A â‡„á¶œ B) â†’ âˆ€ {xâ™¯ x} â†’ x â‹¿ Î³á¶œ[ Aâ‡„B ] â‹… xâ™¯ â†’ Î·á¶œ[ Aâ‡„B ] â‹… x âŠ‘ xâ™¯
completeá¶œ[ Aâ‡„B ] = Ï€â‚ contractiveâ†”completeá¶œ contractiveá¶œ[xâŸ][ Aâ‡„B ]

left-unit-expansive[âŸ]á¶œ[_] : âˆ€ {ğ“} {A Bâ‚ Bâ‚‚ : POSet ğ“} (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª A â‡’ ğ’« Bâ‚ âŸ«} â†’ f âŠ‘ (Î³á¶œ[ â‡„Bâ‡„ ] âŸ Î±á¶œ[ â‡„Bâ‡„ ]) âŸ f
left-unit-expansive[âŸ]á¶œ[ â‡„Bâ‡„ ] {f} = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ f ]]
   â€£ âŸ… â—‡ left-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ return âŸ f ]]
   â€£ [focus-left [âŸ] ğ‘œğ‘“ f ] âŸ… expansiveá¶œ[xâŸ][ â‡„Bâ‡„ ] âŸ†
   â€£ [[ (Î³á¶œ[ â‡„Bâ‡„ ] âŸ Î±á¶œ[ â‡„Bâ‡„ ]) âŸ f ]]
   âˆ

right-unit-expansive[âŸ]á¶œ[_] : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ B : POSet ğ“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) {f : âŸª Aâ‚ â‡’ ğ’« B âŸ«} â†’ f âŠ‘ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŸ Î±á¶œ[ â‡„Aâ‡„ ]
right-unit-expansive[âŸ]á¶œ[ â‡„Aâ‡„ ] {f} = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ f ]]
   â€£ âŸ… â—‡ right-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f âŸ return ]]
   â€£ [focus-right [âŸ] ğ‘œğ‘“ f ] âŸ… expansiveá¶œ[xâŸ][ â‡„Aâ‡„ ] âŸ†
   â€£ [[ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
   âˆ

left-unit-contractive[âŸ]á¶œ[_] : âˆ€ {ğ“} {A Bâ‚ Bâ‚‚ : POSet ğ“} (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª A â‡’ ğ’« Bâ‚‚ âŸ«} â†’ (Î±á¶œ[ â‡„Bâ‡„ ] âŸ Î³á¶œ[ â‡„Bâ‡„ ]) âŸ f âŠ‘ f
left-unit-contractive[âŸ]á¶œ[ â‡„Bâ‡„ ] {f} = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ (Î±á¶œ[ â‡„Bâ‡„ ] âŸ Î³á¶œ[ â‡„Bâ‡„ ]) âŸ f ]]
   â€£ [focus-left [âŸ] ğ‘œğ‘“ f ] âŸ… contractiveá¶œ[xâŸ][ â‡„Bâ‡„ ] âŸ†
   â€£ [[ return âŸ f ]]
   â€£ âŸ… left-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f ]]
   âˆ

right-unit-contractive[âŸ]á¶œ[_] : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ B : POSet ğ“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) {f : âŸª Aâ‚‚ â‡’ ğ’« B âŸ«} â†’ f âŸ Î±á¶œ[ â‡„Aâ‡„ ] âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŠ‘ f
right-unit-contractive[âŸ]á¶œ[ â‡„Aâ‡„ ] {f} = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ f âŸ Î±á¶œ[ â‡„Aâ‡„ ] âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
   â€£ [focus-right [âŸ] ğ‘œğ‘“ f ] âŸ… contractiveá¶œ[xâŸ][ â‡„Aâ‡„ ] âŸ†
   â€£ [[ f âŸ return ]]
   â€£ âŸ… right-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f ]]
   âˆ

-- left-unit-contractive[*]á¶œ[_] : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ B : POSet ğ“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) {f : âŸª Aâ‚‚ â‡’ ğ’« B âŸ«} {X : âŸª ğ’« Aâ‚‚ âŸ«} â†’ f * â‹… (Î±á¶œ[ â‡„Aâ‡„ ] * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] * â‹… X)) âŠ‘ f * â‹… X
-- left-unit-contractive[*]á¶œ[ â‡„Aâ‡„ ] {f} {x} = res-f[â‡’]â¸¢âŠ‘â¸£ let open Â§-ProofMode[âŠ‘] in [proof-mode]
--   do [[ f * âŠ™ Î±á¶œ[ â‡„Aâ‡„ ] * âŠ™ Î³á¶œ[ â‡„Aâ‡„ ] * ]]
--    â€£ [focus-right [âŠ™] ğ‘œğ‘“ f * ] begin
--        do [[ Î±á¶œ[ â‡„Aâ‡„ ] * âŠ™ Î³á¶œ[ â‡„Aâ‡„ ] * ]]
--         â€£ âŸ… â—‡ associative[*]â¸¢âŠ™â¸£ âŸ†â¸¢â‰ˆâ¸£
--         â€£ [[ (Î±á¶œ[ â‡„Aâ‡„ ] * âŠ™ Î³á¶œ[ â‡„Aâ‡„ ]) * ]]
--         â€£ [focus-in [*] ] begin
--             do [[ Î±á¶œ[ â‡„Aâ‡„ ] * âŠ™ Î³á¶œ[ â‡„Aâ‡„ ] ]]
--              â€£ [[ Î±á¶œ[ â‡„Aâ‡„ ] âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
--              â€£ âŸ… contractiveá¶œ[xâŸ][ â‡„Aâ‡„ ] âŸ†
--              â€£ [[ return ]]
--             end
--         â€£ [[ return * ]]
--         â€£ âŸ… left-unit[*]â¸¢extâ¸£ âŸ†â¸¢â‰ˆâ¸£
--         â€£ [[ idâº ]]
--        end
--    â€£ [[ f * âŠ™ idâº ]]
--    â€£ âŸ… right-unit[âŠ™] âŸ†â¸¢â‰ˆâ¸£
--    â€£ [[ f * ]]
--   âˆ

infixr 4 _Î·â‡„Î³â¸¢â†‘â¸£_
record _Î·â‡„Î³â¸¢â†‘â¸£_ {ğ“} (A B : Set ğ“) {{A-PO : PreOrder ğ“ A}} {{B-PO : PreOrder ğ“ B}} : Set (sucË¡ ğ“) where
  field
    Î· : A â†’ B
    monotonic[Î·] : proper (_âŠ´_ â‡‰ _âŠ´_) Î·
    Î³ : B â†’ A â†’ Set ğ“
    monotonic[Î³] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î³
    sound : âˆ€ {x : A} â†’ Î³ (Î· x) x
    complete : âˆ€ {x xâ™¯} â†’ Î³ xâ™¯ x â†’ Î· x âŠ´ xâ™¯
    
mk[Î·â‡„Î³]â¸¢â†‘â¸£ :
  âˆ€ {ğ“} {A B : Set ğ“}
    {{A-PO : PreOrder ğ“ A}} {{A-REX : Reflexive (_âŠ´_ {A = A})}}
    {{B-PO : PreOrder ğ“ B}} {{B-REX : Reflexive (_âŠ´_ {A = B})}}
  â†’ A Î·â‡„Î³â¸¢â†‘â¸£ B â†’ â‡§ A â‡„á¶œ â‡§ B
mk[Î·â‡„Î³]â¸¢â†‘â¸£ {A = A} {B} Aâ‡„B = record
  { Î·á¶œ[_] = witness-x (curryâ¸¢Î»â†‘â¸£ idâ¸¢Î»â†‘â¸£) $ mk[witness] Î· monotonic[Î·]
  ; Î³á¶œ[_] = witness-x (curryâ¸¢Î»â†‘â¸£ idâ¸¢Ï‰â†‘â¸£) $ mk[witness] Î³ monotonic[Î³]
  ; expansiveá¶œ[xâŸ][_] = Ï€â‚‚ expansiveâ†”soundá¶œ sound
  ; contractiveá¶œ[xâŸ][_] = Ï€â‚‚ contractiveâ†”completeá¶œ (intro[âŠ‘]â¸¢â†“â¸£ âˆ˜ complete)
  }
  where open _Î·â‡„Î³â¸¢â†‘â¸£_ Aâ‡„B

â‡„á¶œâ†”â‡„áµ : âˆ€ {ğ“} {A B : POSet ğ“} â†’ (A â‡„á¶œ B) â†” (A â‡„áµ B)
â‡„á¶œâ†”â‡„áµ = LHS , RHS
  where
    LHS : âˆ€ {ğ“} {A B : POSet ğ“} â†’ A â‡„á¶œ B â†’ A â‡„áµ B
    LHS Aâ‡„B = record
      { Î±áµ[_] = Î±á¶œ[ Aâ‡„B ]
      ; Î³áµ[_] = Î³á¶œ[ Aâ‡„B ]
      ; expansiveáµ[_] = expansiveá¶œ[xâŸ][ Aâ‡„B ]
      ; contractiveáµ[_] = contractiveá¶œ[xâŸ][ Aâ‡„B ]
      }
    RHS : âˆ€ {ğ“} {A B : POSet ğ“} â†’ A â‡„áµ B â†’ A â‡„á¶œ B
    RHS {A = A} {B} Aâ‡„B = record
      { Î·á¶œ[_] = Î·
      ; Î³á¶œ[_] = Î³áµ[ Aâ‡„B ]
      ; expansiveá¶œ[xâŸ][_] = Ï€â‚‚ expansiveâ†”soundá¶œ sound
      ; contractiveá¶œ[xâŸ][_] = Ï€â‚‚ contractiveâ†”completeá¶œ complete
      }
      where
        fun : âŸª A âŸ« â†’ âŸª B âŸ«
        fun x with soundáµ[ Aâ‡„B ] {x}
        ... | âˆƒğ’« y ,, yâˆˆÎ±[x] ,, xâˆˆÎ³[y] = y
        abstract
          ppr : proper (_âŠ‘_ â‡‰ _âŠ‘_) fun
          ppr {x} {y} xâŠ‘y with soundáµ[ Aâ‡„B ] {x} | soundáµ[ Aâ‡„B ] {y}
          ... | âˆƒğ’« xâ™¯ ,, xâ™¯âˆˆÎ±[x] ,, xâˆˆÎ³[xâ™¯] | âˆƒğ’« yâ™¯ ,, yâ™¯âˆˆÎ±[y] ,, yâˆˆÎ³[yâ™¯] =
            res-X[ğ’«]â¸¢âŠ‘â¸£ (res-f[â‡’]â¸¢âŠ‘â¸£ $ contractiveáµ[ Aâ‡„B ]) $
            âˆƒğ’« x ,, res-x[ğ’«]â¸¢âŠ‘â¸£ {X = Î³áµ[ Aâ‡„B ] â‹… yâ™¯} xâŠ‘y yâˆˆÎ³[yâ™¯] ,, xâ™¯âˆˆÎ±[x]
        Î· : âŸª A â‡’ B âŸ«
        Î· = witness-x (curryâ¸¢Î»â¸£ $ idâ¸¢Î»â¸£) $ mk[witness] fun ppr
        sound : âˆ€ {x} â†’ x â‹¿ Î³áµ[ Aâ‡„B ] â‹… (Î· â‹… x)
        sound {x} with soundáµ[ Aâ‡„B ] {x}
        ... | âˆƒğ’« xâ™¯ ,, xâ™¯âˆˆÎ±[x] ,, xâˆˆÎ³[xâ™¯] = xâˆˆÎ³[xâ™¯]
        complete : âˆ€ {x xâ™¯} â†’ x â‹¿ Î³áµ[ Aâ‡„B ] â‹… xâ™¯ â†’ Î· â‹… x âŠ‘ xâ™¯
        complete {x} {xâ™¯} xâˆˆÎ³[xâ™¯] with soundáµ[ Aâ‡„B ] {x}
        ... | âˆƒğ’« yâ™¯ ,, yâ™¯âˆˆÎ±[x] ,, xâˆˆÎ³[yâ™¯] = completeáµ[ Aâ‡„B ] $ âˆƒğ’« x ,, xâˆˆÎ³[xâ™¯] ,, yâ™¯âˆˆÎ±[x]

â‡„áµâ†’â‡„á¶œ[_] : âˆ€ {ğ“} {A B : POSet ğ“} â†’ A â‡„áµ B â†’ A â‡„á¶œ B
â‡„áµâ†’â‡„á¶œ[_] = Ï€â‚‚ â‡„á¶œâ†”â‡„áµ

â‡„á¶œâ†’â‡„áµ[_] : âˆ€ {ğ“} {A B : POSet ğ“} â†’ A â‡„á¶œ B â†’ A â‡„áµ B
â‡„á¶œâ†’â‡„áµ[_] = Ï€â‚ â‡„á¶œâ†”â‡„áµ

Î±â‰ˆpure[Î·] : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„B : A â‡„áµ B) â†’ Î±áµ[ Aâ‡„B ] â‰ˆ Î±á¶œ[ â‡„áµâ†’â‡„á¶œ[ Aâ‡„B ] ]
Î±â‰ˆpure[Î·] Aâ‡„B = unique[Î±]áµ Aâ‡„B â‡„á¶œâ†’â‡„áµ[ â‡„áµâ†’â‡„á¶œ[ Aâ‡„B ] ] xRxâ¸¢â‰ˆâ¸£

pure[Î·]â‰ˆÎ± : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„B : A â‡„á¶œ B) â†’ Î±á¶œ[ Aâ‡„B ] â‰ˆ Î±áµ[ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ]
pure[Î·]â‰ˆÎ± Aâ‡„B = unique[Î±]áµ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] xRxâ¸¢â‰ˆâ¸£

_âŒ¾â¸¢â‡„á¶œâ¸£_ : âˆ€ {ğ“} {A B C : POSet ğ“} â†’ B â‡„á¶œ C â†’ A â‡„á¶œ B â†’ A â‡„á¶œ C
_âŒ¾â¸¢â‡„á¶œâ¸£_ {ğ“} {Aâ‚} {Aâ‚‚} {Aâ‚ƒ} Bâ‡„C Aâ‡„B = record
  { Î·á¶œ[_] = Î·á¶œ[ Bâ‡„C ] âŠ™ Î·á¶œ[ Aâ‡„B ]
  ; Î³á¶œ[_] = Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]
  ; expansiveá¶œ[xâŸ][_] = let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ return ]]
       â€£ âŸ… expansiveáµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŒ¾â¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] âŸ†
       â€£ [[ Î³áµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŒ¾â¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] âŸ Î±áµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŒ¾â¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] ]]
       â€£ [[ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) âŸ (Î±á¶œ[ Bâ‡„C ] âŸ Î±á¶œ[ Aâ‡„B ]) ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) ] âŸ… homomorphic[pure]â¸¢âŸâ¸£ âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) âŸ pure â‹… (Î·á¶œ[ Bâ‡„C ] âŠ™ Î·á¶œ[ Aâ‡„B ]) ]]
       âˆ
  ; contractiveá¶œ[xâŸ][_] = let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ pure â‹… (Î·á¶œ[ Bâ‡„C ] âŠ™ Î·á¶œ[ Aâ‡„B ]) âŸ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) ]]
       â€£ [focus-left [âŸ] ğ‘œğ‘“ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) ] âŸ… â—‡ homomorphic[pure]â¸¢âŸâ¸£ âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î±á¶œ[ Bâ‡„C ] âŸ Î±á¶œ[ Aâ‡„B ]) âŸ (Î³á¶œ[ Aâ‡„B ] âŸ Î³á¶œ[ Bâ‡„C ]) ]]
       â€£ [[ Î±áµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŒ¾â¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] âŸ Î³áµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŒ¾â¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] ]]
       â€£ âŸ… contractiveáµ[ â‡„á¶œâ†’â‡„áµ[ Bâ‡„C ] âŒ¾â¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ Aâ‡„B ] ] âŸ†
       â€£ [[ return ]]
       âˆ
  }

_Ã—â¸¢â‡„á¶œâ¸£_ : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} â†’ Aâ‚ â‡„á¶œ Aâ‚‚ â†’ Bâ‚ â‡„á¶œ Bâ‚‚ â†’ (Aâ‚ Ã—âº Bâ‚) â‡„á¶œ (Aâ‚‚ Ã—âº Bâ‚‚)
_Ã—â¸¢â‡„á¶œâ¸£_ {ğ“} {Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} â‡„Aâ‡„ â‡„Bâ‡„ = mk[Î·â‡„Î³]â¸¢â†‘â¸£ record
  { Î· = Î·
  ; monotonic[Î·] = monotonic[Î·]
  ; Î³ = Î³
  ; monotonic[Î³] = monotonic[Î³]
  ; sound = sound
  ; complete = complete
  }
  where
    Î· : prod Aâ‚ Bâ‚ â†’ prod Aâ‚‚ Bâ‚‚
    Î· (x , y) = Î·á¶œ[ â‡„Aâ‡„ ] â‹… x , Î·á¶œ[ â‡„Bâ‡„ ] â‹… y
    abstract
      monotonic[Î·] : proper (_âŠ´_ â‡‰ _âŠ´_) Î·
      monotonic[Î·] (xâ‚âŠ‘xâ‚‚ , yâ‚âŠ‘yâ‚‚) = res-x[â‡’]â¸¢âŠ‘â¸£ {f = Î·á¶œ[ â‡„Aâ‡„ ]} xâ‚âŠ‘xâ‚‚ , res-x[â‡’]â¸¢âŠ‘â¸£ {f = Î·á¶œ[ â‡„Bâ‡„ ]} yâ‚âŠ‘yâ‚‚
    Î³ : prod Aâ‚‚ Bâ‚‚ â†’ prod Aâ‚ Bâ‚ â†’ Set ğ“
    Î³ (xâ™¯ , yâ™¯) (x , y) = (x â‹¿ Î³á¶œ[ â‡„Aâ‡„ ] â‹… xâ™¯) Ã— (y â‹¿ Î³á¶œ[ â‡„Bâ‡„ ] â‹… yâ™¯)
    abstract
      monotonic[Î³] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î³
      monotonic[Î³] (xâ‚â™¯âŠ‘xâ‚‚â™¯ , yâ‚â™¯âŠ‘yâ‚‚â™¯) (xâ‚âŠµxâ‚‚ , yâ‚âŠµyâ‚‚) (xâ‚âˆˆÎ³[xâ‚â™¯] , yâ‚âˆˆÎ³[yâ‚â™¯]) =
          res-X-x[ğ’«]â¸¢âŠ‘â¸£ (res-x[â‡’]â¸¢âŠ‘â¸£ {f = Î³á¶œ[ â‡„Aâ‡„ ]} xâ‚â™¯âŠ‘xâ‚‚â™¯) xâ‚âŠµxâ‚‚ xâ‚âˆˆÎ³[xâ‚â™¯]
        , res-X-x[ğ’«]â¸¢âŠ‘â¸£ (res-x[â‡’]â¸¢âŠ‘â¸£ {f = Î³á¶œ[ â‡„Bâ‡„ ]} yâ‚â™¯âŠ‘yâ‚‚â™¯) yâ‚âŠµyâ‚‚ yâ‚âˆˆÎ³[yâ‚â™¯]
    sound : âˆ€ {xy} â†’ Î³ (Î· xy) xy
    sound {x , y} = soundá¶œ[ â‡„Aâ‡„ ] {x} , soundá¶œ[ â‡„Bâ‡„ ] {y}
    complete : âˆ€ {xyâ™¯ xy} â†’ Î³ xyâ™¯ xy â†’ Î· xy âŠ´ xyâ™¯
    complete {xâ™¯ , yâ™¯} {x , y} (xâ‚âˆˆÎ³[xâ‚â™¯] , yâ‚âˆˆÎ³[yâ‚â™¯]) = completeá¶œ[ â‡„Aâ‡„ ] xâ‚âˆˆÎ³[xâ‚â™¯] , completeá¶œ[ â‡„Bâ‡„ ] yâ‚âˆˆÎ³[yâ‚â™¯]

_â‡’â¸¢â‡„á¶œâ¸£_ : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} â†’ Aâ‚ â‡„á¶œ Aâ‚‚ â†’ Bâ‚ â‡„á¶œ Bâ‚‚ â†’ (Aâ‚ â‡’ ğ’« Bâ‚) â‡„ (Aâ‚‚ â‡’ ğ’« Bâ‚‚)
_â‡’â¸¢â‡„á¶œâ¸£_ {Aâ‚ = Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} â‡„Aâ‡„ â‡„Bâ‡„ = â‡„á¶œâ†’â‡„áµ[ â‡„Aâ‡„ ] â‡’â¸¢â‡„áµâ¸£ â‡„á¶œâ†’â‡„áµ[ â‡„Bâ‡„ ]

Î±[f]â†”Î±âŸfá¶œ[_,_] :
  âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª Aâ‚ â‡’ ğ’« Bâ‚ âŸ«} {fâ™¯ : âŸª Aâ‚‚ â‡’ ğ’« Bâ‚‚ âŸ«}
  â†’ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯ â†” Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŠ‘ fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ]
Î±[f]â†”Î±âŸfá¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] {f} {fâ™¯} = LHS , RHS
  where
    LHS : Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯ â†’ Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŠ‘ fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ]
    LHS Î±[f]âŠ‘fâ™¯ = let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ Î±á¶œ[ â‡„Bâ‡„ ] âŸ f ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ Î±á¶œ[ â‡„Bâ‡„ ] ] begin
           do [[ f ]]
            â€£ âŸ… right-unit-expansive[âŸ]á¶œ[ â‡„Aâ‡„ ] âŸ†
            â€£ [[ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
            â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ (f âŸ Î³á¶œ[ â‡„Aâ‡„ ]) âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
           end
       â€£ [[ Î±á¶œ[ â‡„Bâ‡„ ] âŸ (f âŸ Î³á¶œ[ â‡„Aâ‡„ ]) âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŸ Î³á¶œ[ â‡„Aâ‡„ ]) âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ [[ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ [focus-left [âŸ] ğ‘œğ‘“ Î±á¶œ[ â‡„Aâ‡„ ] ] âŸ… Î±[f]âŠ‘fâ™¯ âŸ†
       â€£ [[ fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ] ]]
       âˆ
    RHS : Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŠ‘ fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ] â†’ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯
    RHS Î·âŸfâŠ‘fâ™¯âŸÎ· = let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f ]]
       â€£ [[ Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î±á¶œ[ â‡„Bâ‡„ ] âŸ f) âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ [focus-left [âŸ] ğ‘œğ‘“ Î³á¶œ[ â‡„Aâ‡„ ] ] âŸ… Î·âŸfâŠ‘fâ™¯âŸÎ· âŸ†
       â€£ [[ (fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ]) âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ fâ™¯ âŸ Î±á¶œ[ â‡„Aâ‡„ ] âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… right-unit-contractive[âŸ]á¶œ[ â‡„Aâ‡„ ] âŸ†
       â€£ [[ fâ™¯ ]]
       âˆ

Î±[f]â†”Î·âŠ™fá¶œ[_,_] : 
  âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª Aâ‚ â‡’ Bâ‚ âŸ«} {fâ™¯ : âŸª Aâ‚‚ â‡’ Bâ‚‚ âŸ«}
  â†’ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… (pure â‹… f) âŠ‘ pure â‹… fâ™¯ â†” Î·á¶œ[ â‡„Bâ‡„ ] âŠ™ f âŠ‘ fâ™¯ âŠ™ Î·á¶œ[ â‡„Aâ‡„ ]
Î±[f]â†”Î·âŠ™fá¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] {f} {fâ™¯} = LHS , RHS
  where
    LHS : Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… (pure â‹… f) âŠ‘ pure â‹… fâ™¯ â†’ Î·á¶œ[ â‡„Bâ‡„ ] âŠ™ f âŠ‘ fâ™¯ âŠ™ Î·á¶œ[ â‡„Aâ‡„ ]
    LHS Î±[f]âŠ‘fâ™¯ = injective[pure]â¸¢âŠ‘â¸£ $ let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ pure â‹… (Î·á¶œ[ â‡„Bâ‡„ ] âŠ™ f) ]]
       â€£ âŸ… â—‡ homomorphic[pure]â¸¢âŸâ¸£ âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ pure â‹… Î·á¶œ[ â‡„Bâ‡„ ] âŸ pure â‹… f ]]
       â€£ âŸ… Ï€â‚ Î±[f]â†”Î±âŸfá¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] Î±[f]âŠ‘fâ™¯ âŸ†
       â€£ [[ pure â‹… fâ™¯ âŸ pure â‹… Î·á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… homomorphic[pure]â¸¢âŸâ¸£ âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ pure â‹… (fâ™¯ âŠ™ Î·á¶œ[ â‡„Aâ‡„ ]) ]]
       âˆ
    RHS : Î·á¶œ[ â‡„Bâ‡„ ] âŠ™ f âŠ‘ fâ™¯ âŠ™ Î·á¶œ[ â‡„Aâ‡„ ] â†’ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… (pure â‹… f) âŠ‘ pure â‹… fâ™¯
    RHS Î·âŠ™fâŠ‘fâ™¯âŠ™Î· = Ï€â‚‚ Î±[f]â†”Î±âŸfá¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] $ let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ pure â‹… Î·á¶œ[ â‡„Bâ‡„ ] âŸ pure â‹… f ]]
       â€£ âŸ… homomorphic[pure]â¸¢âŸâ¸£ âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ pure â‹… (Î·á¶œ[ â‡„Bâ‡„ ] âŠ™ f) ]]
       â€£ [focus-right [â‹…] ğ‘œğ‘“ pure ] âŸ… Î·âŠ™fâŠ‘fâ™¯âŠ™Î· âŸ†
       â€£ âŸ… â—‡ homomorphic[pure]â¸¢âŸâ¸£ âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ pure â‹… fâ™¯ âŸ pure â‹… Î·á¶œ[ â‡„Aâ‡„ ] ]]
       âˆ

Î±[f]â†”fâŸÎ³á¶œ[_,_] :
  âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª Aâ‚ â‡’ ğ’« Bâ‚ âŸ«} {fâ™¯ : âŸª Aâ‚‚ â‡’ ğ’« Bâ‚‚ âŸ«}
  â†’ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯ â†” f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŠ‘ Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯
Î±[f]â†”fâŸÎ³á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] {f} {fâ™¯} = LHS , RHS
  where
    LHS : Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯ â†’ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŠ‘ Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯
    LHS Î±[f]âŠ‘fâ™¯ = let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… left-unit-expansive[âŸ]á¶œ[ â‡„Bâ‡„ ] âŸ†
       â€£ [[ (Î³á¶œ[ â‡„Bâ‡„ ] âŸ Î±á¶œ[ â‡„Bâ‡„ ]) âŸ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] âŸ Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] âŸ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ Î³á¶œ[ â‡„Bâ‡„ ] ] âŸ… Î±[f]âŠ‘fâ™¯ âŸ†
       â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯ ]]
       âˆ
    RHS : f âŸ Î³á¶œ[ â‡„Aâ‡„ ] âŠ‘ Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯ â†’ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯
    RHS fâŸÎ³âŠ‘Î³âŸfâ™¯ = let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f ]]
       â€£ [[ Î±á¶œ[ â‡„Bâ‡„ ] âŸ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ Î±á¶œ[ â‡„Bâ‡„ ] ] âŸ… fâŸÎ³âŠ‘Î³âŸfâ™¯ âŸ†
       â€£ [[ Î±á¶œ[ â‡„Bâ‡„ ] âŸ Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯ ]]
       â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î±á¶œ[ â‡„Bâ‡„ ] âŸ Î³á¶œ[ â‡„Bâ‡„ ]) âŸ fâ™¯ ]]
       â€£ âŸ… left-unit-contractive[âŸ]á¶œ[ â‡„Bâ‡„ ] âŸ†
       â€£ [[ fâ™¯ ]]
       âˆ
  
Î±[f]â†”fâŸÎ³á¶œ*[_,_] :
  âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª Aâ‚ â‡’ ğ’« Bâ‚ âŸ«} {fâ™¯ : âŸª Aâ‚‚ â‡’ ğ’« Bâ‚‚ âŸ«}
  â†’ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯ â†” (âˆ€ {x} â†’ f * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] â‹… x) âŠ‘ Î³á¶œ[ â‡„Bâ‡„ ] * â‹… (fâ™¯ â‹… x))
Î±[f]â†”fâŸÎ³á¶œ*[ â‡„Aâ‡„ , â‡„Bâ‡„ ] {f} {fâ™¯} = LHS , RHS
  where
    LHS : Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯ â†’ âˆ€ {x} â†’ f * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] â‹… x) âŠ‘ Î³á¶œ[ â‡„Bâ‡„ ] * â‹… (fâ™¯ â‹… x)
    LHS Î±[f]âŠ‘fâ™¯ {x} = res-f[â‡’]â¸¢âŠ‘â¸£ {x = x} (Ï€â‚ Î±[f]â†”fâŸÎ³á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] Î±[f]âŠ‘fâ™¯)
    RHS : (âˆ€ {x} â†’ f * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] â‹… x) âŠ‘ Î³á¶œ[ â‡„Bâ‡„ ] * â‹… (fâ™¯ â‹… x)) â†’ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯
    RHS f[Î³[x]]âŠ‘Î³[fâ™¯[x]] = Ï€â‚‚ Î±[f]â†”fâŸÎ³á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] $ ext[â‡’]â¸¢âŠ‘â¸£ $ Î» {x} â†’ f[Î³[x]]âŠ‘Î³[fâ™¯[x]] {x}

Î±[f]â†”fâŸÎ³á¶œ*X[_,_] :
  âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} (â‡„Aâ‡„ : Aâ‚ â‡„á¶œ Aâ‚‚) (â‡„Bâ‡„ : Bâ‚ â‡„á¶œ Bâ‚‚) {f : âŸª Aâ‚ â‡’ ğ’« Bâ‚ âŸ«} {fâ™¯ : âŸª Aâ‚‚ â‡’ ğ’« Bâ‚‚ âŸ«}
  â†’ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯ â†” (âˆ€ {X} â†’ f * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] * â‹… X) âŠ‘ Î³á¶œ[ â‡„Bâ‡„ ] * â‹… (fâ™¯ * â‹… X))
Î±[f]â†”fâŸÎ³á¶œ*X[ â‡„Aâ‡„ , â‡„Bâ‡„ ] {f} {fâ™¯} = LHS , RHS
  where
    LHS : Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯ â†’ âˆ€ {X} â†’ f * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] * â‹… X) âŠ‘ Î³á¶œ[ â‡„Bâ‡„ ] * â‹… (fâ™¯ * â‹… X)
    LHS Î±[f]âŠ‘fâ™¯ {X} = let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ f * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] * â‹… X) ]]
       â€£ âŸ… â—‡ associative[âŸ]â¸¢*â¸£ âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (f âŸ Î³á¶œ[ â‡„Aâ‡„ ]) * â‹… X ]]
       â€£ [focus-left [â‹…] ğ‘œğ‘“ X ] $ [focus-in [*] ] begin
           do [[ f âŸ Î³á¶œ[ â‡„Aâ‡„ ] ]]
            â€£ âŸ… Ï€â‚ Î±[f]â†”fâŸÎ³á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] Î±[f]âŠ‘fâ™¯ âŸ†
            â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯ ]]
           end
       â€£ [[ (Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯) * â‹… X ]]
       â€£ âŸ… associative[âŸ]â¸¢*â¸£ âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] * â‹… (fâ™¯ * â‹… X) ]]
       âˆ
    RHS : (âˆ€ {X} â†’ f * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] * â‹… X) âŠ‘ Î³á¶œ[ â‡„Bâ‡„ ] * â‹… (fâ™¯ * â‹… X)) â†’ Î±[ â‡„Aâ‡„ â‡’â¸¢â‡„á¶œâ¸£ â‡„Bâ‡„ ] â‹… f âŠ‘ fâ™¯
    RHS f[Î³[X]]âŠ‘Î³[fâ™¯[X]] = Ï€â‚‚ Î±[f]â†”fâŸÎ³á¶œ[ â‡„Aâ‡„ , â‡„Bâ‡„ ] $ complete[*]â¸¢âŠ‘â¸£ $ ext[â‡’]â¸¢âŠ‘â¸£ $ Î» {X} â†’ let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ (f âŸ Î³á¶œ[ â‡„Aâ‡„ ]) * â‹… X ]]
       â€£ âŸ… associative[âŸ]â¸¢*â¸£ âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ f * â‹… (Î³á¶œ[ â‡„Aâ‡„ ] * â‹… X) ]]
       â€£ âŸ… f[Î³[X]]âŠ‘Î³[fâ™¯[X]] âŸ†
       â€£ [[ Î³á¶œ[ â‡„Bâ‡„ ] * â‹… (fâ™¯ * â‹… X) ]]
       â€£ âŸ… â—‡ associative[âŸ]â¸¢*â¸£ âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î³á¶œ[ â‡„Bâ‡„ ] âŸ fâ™¯) * â‹… X ]]
       âˆ
