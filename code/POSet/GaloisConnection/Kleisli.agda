module POSet.GaloisConnection.Kleisli where

open import Prelude
open import POSet.POSet
open import POSet.Fun
open import POSet.Power
open import POSet.Product
open import POSet.Lib
open import POSet.ProofMode
open import POSet.PowerMonad

open import POSet.GaloisConnection.Classical

infixr 4 _â‡„áµ_
record _â‡„áµ_ {ğ“} (A B : POSet ğ“) : Set (sucË¡ ğ“) where
  field
    Î±áµ[_] : âŸª A â‡’ ğ’« B âŸ«
    Î³áµ[_] : âŸª B â‡’ ğ’« A âŸ«
    expansiveáµ[_] : return âŠ‘ Î³áµ[_] âŸ Î±áµ[_]
    contractiveáµ[_] : Î±áµ[_] âŸ Î³áµ[_] âŠ‘ return
open _â‡„áµ_ public

expansiveâ†”soundáµ : âˆ€ {ğ“} {A B : POSet ğ“} {Î± : âŸª A â‡’ ğ’« B âŸ«} {Î³ : âŸª B â‡’ ğ’« A âŸ«} â†’ return âŠ‘ Î³ âŸ Î± â†” (âˆ€ {x} â†’ x â‹¿ Î³ * â‹… (Î± â‹… x))
expansiveâ†”soundáµ {A = A} {B} {Î±} {Î³} = LHS , RHS
  where
    LHS : return âŠ‘ Î³ âŸ Î± â†’ âˆ€ {x} â†’ x â‹¿ Î³ * â‹… (Î± â‹… x)
    LHS expansive = Ï€â‚ returnâ†”â‹¿ $ res-f[â‡’]â¸¢âŠ‘â¸£ expansive
    RHS : (âˆ€ {x} â†’ x â‹¿ Î³ * â‹… (Î± â‹… x)) â†’ return âŠ‘ Î³ âŸ Î±
    RHS sound = ext[â‡’]â¸¢âŠ‘â¸£ $ Ï€â‚‚ returnâ†”â‹¿ sound

contractiveâ†”completeáµ : âˆ€ {ğ“} {A B : POSet ğ“} {Î± : âŸª A â‡’ ğ’« B âŸ«} {Î³ : âŸª B â‡’ ğ’« A âŸ«} â†’ Î± âŸ Î³ âŠ‘ return â†” (âˆ€ {xâ™¯ yâ™¯} â†’ yâ™¯ â‹¿ Î± * â‹… (Î³ â‹… xâ™¯) â†’ yâ™¯ âŠ‘ xâ™¯)
contractiveâ†”completeáµ {A = A} {B} {Î±} {Î³} = LHS , RHS
  where
    LHS : Î± âŸ Î³ âŠ‘ return â†’ âˆ€ {xâ™¯ yâ™¯} â†’ yâ™¯ â‹¿ Î± * â‹… (Î³ â‹… xâ™¯) â†’ yâ™¯ âŠ‘ xâ™¯
    LHS contractive xâ™¯âˆˆÎ±[Î³[yâ™¯]] = Ï€â‚ returnâ†”â‹¿ $ res-f[â‡’]â¸¢âŠ‘â¸£ contractive âŒ¾ Ï€â‚‚ returnâ†”â‹¿ xâ™¯âˆˆÎ±[Î³[yâ™¯]]

    RHS : (âˆ€ {xâ™¯ yâ™¯} â†’ yâ™¯ â‹¿ Î± * â‹… (Î³ â‹… xâ™¯) â†’ yâ™¯ âŠ‘ xâ™¯) â†’ Î± âŸ Î³ âŠ‘ return
    RHS complete = ext[â‡’]â¸¢âŠ‘â¸£ $ ext[ğ’«]â¸¢âŠ‘â¸£ $ complete

soundáµ[_] : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„B : A â‡„áµ B) â†’ âˆ€ {x} â†’ x â‹¿ Î³áµ[ Aâ‡„B ] * â‹… (Î±áµ[ Aâ‡„B ] â‹… x)
soundáµ[ Aâ‡„B ] = Ï€â‚ expansiveâ†”soundáµ expansiveáµ[ Aâ‡„B ]

completeáµ[_] : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„B : A â‡„áµ B) â†’ âˆ€ {xâ™¯ yâ™¯} â†’ yâ™¯ â‹¿ Î±áµ[ Aâ‡„B ] * â‹… (Î³áµ[ Aâ‡„B ] â‹… xâ™¯) â†’ yâ™¯ âŠ‘ xâ™¯
completeáµ[ Aâ‡„B ] = Ï€â‚ contractiveâ†”completeáµ contractiveáµ[ Aâ‡„B ]

left-unit-expansive[âŸ]áµ[_] : âˆ€ {ğ“} {A Bâ‚ Bâ‚‚ : POSet ğ“} (â‡„Bâ‡„ : Bâ‚ â‡„áµ Bâ‚‚) {f : âŸª A â‡’ ğ’« Bâ‚ âŸ«} â†’ f âŠ‘ (Î³áµ[ â‡„Bâ‡„ ] âŸ Î±áµ[ â‡„Bâ‡„ ]) âŸ f
left-unit-expansive[âŸ]áµ[ â‡„Bâ‡„ ] {f} = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ f ]]
   â€£ âŸ… â—‡ left-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ return âŸ f ]]
   â€£ [focus-left [âŸ] ğ‘œğ‘“ f ] âŸ… expansiveáµ[ â‡„Bâ‡„ ] âŸ†
   â€£ [[ (Î³áµ[ â‡„Bâ‡„ ] âŸ Î±áµ[ â‡„Bâ‡„ ]) âŸ f ]]
   âˆ

right-unit-expansive[âŸ]áµ[_] : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ B : POSet ğ“} (â‡„Aâ‡„ : Aâ‚ â‡„áµ Aâ‚‚) {f : âŸª Aâ‚ â‡’ ğ’« B âŸ«} â†’ f âŠ‘ f âŸ Î³áµ[ â‡„Aâ‡„ ] âŸ Î±áµ[ â‡„Aâ‡„ ]
right-unit-expansive[âŸ]áµ[ â‡„Aâ‡„ ] {f} = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ f ]]
   â€£ âŸ… â—‡ right-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f âŸ return ]]
   â€£ [focus-right [âŸ] ğ‘œğ‘“ f ] âŸ… expansiveáµ[ â‡„Aâ‡„ ] âŸ†
   â€£ [[ f âŸ Î³áµ[ â‡„Aâ‡„ ] âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
   âˆ

left-unit-contractive[âŸ]áµ[_] : âˆ€ {ğ“} {A Bâ‚ Bâ‚‚ : POSet ğ“} (â‡„Bâ‡„ : Bâ‚ â‡„áµ Bâ‚‚) {f : âŸª A â‡’ ğ’« Bâ‚‚ âŸ«} â†’ (Î±áµ[ â‡„Bâ‡„ ] âŸ Î³áµ[ â‡„Bâ‡„ ]) âŸ f âŠ‘ f
left-unit-contractive[âŸ]áµ[ â‡„Bâ‡„ ] {f} = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ (Î±áµ[ â‡„Bâ‡„ ] âŸ Î³áµ[ â‡„Bâ‡„ ]) âŸ f ]]
   â€£ [focus-left [âŸ] ğ‘œğ‘“ f ] âŸ… contractiveáµ[ â‡„Bâ‡„ ] âŸ†
   â€£ [[ return âŸ f ]]
   â€£ âŸ… left-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f ]]
   âˆ

right-unit-contractive[âŸ]áµ[_] : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ B : POSet ğ“} (â‡„Aâ‡„ : Aâ‚ â‡„áµ Aâ‚‚) {f : âŸª Aâ‚‚ â‡’ ğ’« B âŸ«} â†’ f âŸ Î±áµ[ â‡„Aâ‡„ ] âŸ Î³áµ[ â‡„Aâ‡„ ] âŠ‘ f
right-unit-contractive[âŸ]áµ[ â‡„Aâ‡„ ] {f} = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ f âŸ Î±áµ[ â‡„Aâ‡„ ] âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
   â€£ [focus-right [âŸ] ğ‘œğ‘“ f ] âŸ… contractiveáµ[ â‡„Aâ‡„ ] âŸ†
   â€£ [[ f âŸ return ]]
   â€£ âŸ… right-unit[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ f ]]
   âˆ

weaken[Î±]áµ : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A â‡„áµ B) â†’ Î³áµ[ Aâ‡„Bâ‚‚ ] âŠ‘ Î³áµ[ Aâ‡„Bâ‚ ] â†’ Î±áµ[ Aâ‡„Bâ‚ ] âŠ‘ Î±áµ[ Aâ‡„Bâ‚‚ ]
weaken[Î±]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î³â‚‚âŠ‘Î³â‚ = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ Î±áµ[ Aâ‡„Bâ‚ ] ]]
   â€£ âŸ… right-unit-expansive[âŸ]áµ[ Aâ‡„Bâ‚‚ ] âŸ†
   â€£ [[ Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] ]]
   â€£ [focus-right [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„Bâ‚ ] ] $ [focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„Bâ‚‚ ] ] âŸ… Î³â‚‚âŠ‘Î³â‚ âŸ†
   â€£ [[ Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] ]]
   â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ (Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚ ]) âŸ Î±áµ[ Aâ‡„Bâ‚‚ ] ]]
   â€£ âŸ… left-unit-contractive[âŸ]áµ[ Aâ‡„Bâ‚ ] âŸ†
   â€£ [[ Î±áµ[ Aâ‡„Bâ‚‚ ] ]]
   âˆ

unique[Î±]áµ : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A â‡„áµ B) â†’ Î³áµ[ Aâ‡„Bâ‚ ] â‰ˆ Î³áµ[ Aâ‡„Bâ‚‚ ] â†’ Î±áµ[ Aâ‡„Bâ‚ ] â‰ˆ Î±áµ[ Aâ‡„Bâ‚‚ ]
unique[Î±]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î³â‚â‰ˆÎ³â‚‚ = â‹ˆ[] (weaken[Î±]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ $ xRx[] $ â—‡ Î³â‚â‰ˆÎ³â‚‚) (weaken[Î±]áµ Aâ‡„Bâ‚‚ Aâ‡„Bâ‚ $ xRx[] Î³â‚â‰ˆÎ³â‚‚)

weaken[Î³]áµ : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A â‡„áµ B) â†’ Î±áµ[ Aâ‡„Bâ‚‚ ] âŠ‘ Î±áµ[ Aâ‡„Bâ‚ ] â†’ Î³áµ[ Aâ‡„Bâ‚ ] âŠ‘ Î³áµ[ Aâ‡„Bâ‚‚ ]
weaken[Î³]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î±â‚‚âŠ‘Î±â‚ = let open Â§-ProofMode[âŠ‘] in [proof-mode]
  do [[ Î³áµ[ Aâ‡„Bâ‚ ] ]]
   â€£ âŸ… left-unit-expansive[âŸ]áµ[ Aâ‡„Bâ‚‚ ] âŸ†
   â€£ [[ (Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚‚ ]) âŸ Î³áµ[ Aâ‡„Bâ‚ ] ]]
   â€£ [focus-left [âŸ] ğ‘œğ‘“ Î³áµ[ Aâ‡„Bâ‚ ] ] $ [focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ Aâ‡„Bâ‚‚ ] ] âŸ… Î±â‚‚âŠ‘Î±â‚ âŸ†
   â€£ [[ (Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚ ]) âŸ Î³áµ[ Aâ‡„Bâ‚ ] ]]
   â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
   â€£ [[ Î³áµ[ Aâ‡„Bâ‚‚ ] âŸ Î±áµ[ Aâ‡„Bâ‚ ] âŸ Î³áµ[ Aâ‡„Bâ‚ ] ]]
   â€£ âŸ… right-unit-contractive[âŸ]áµ[ Aâ‡„Bâ‚ ] âŸ†
   â€£ [[ Î³áµ[ Aâ‡„Bâ‚‚ ] ]]
   âˆ

unique[Î³]áµ : âˆ€ {ğ“} {A B : POSet ğ“} (Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ : A â‡„áµ B) â†’ Î±áµ[ Aâ‡„Bâ‚ ] â‰ˆ Î±áµ[ Aâ‡„Bâ‚‚ ] â†’ Î³áµ[ Aâ‡„Bâ‚ ] â‰ˆ Î³áµ[ Aâ‡„Bâ‚‚ ]
unique[Î³]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ Î±â‚â‰ˆÎ±â‚‚ = â‹ˆ[] (weaken[Î³]áµ Aâ‡„Bâ‚ Aâ‡„Bâ‚‚ $ xRx[] $ â—‡ Î±â‚â‰ˆÎ±â‚‚) (weaken[Î³]áµ Aâ‡„Bâ‚‚ Aâ‡„Bâ‚ $ xRx[] Î±â‚â‰ˆÎ±â‚‚)

infixr 9 _âŒ¾â¸¢â‡„áµâ¸£_
_âŒ¾â¸¢â‡„áµâ¸£_ : âˆ€ {ğ“} {A B C : POSet ğ“} â†’ B â‡„áµ C â†’ A â‡„áµ B â†’ A â‡„áµ C
Bâ‡„C âŒ¾â¸¢â‡„áµâ¸£ Aâ‡„B = record
  { Î±áµ[_] = Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]
  ; Î³áµ[_] = Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]
  ; expansiveáµ[_] = let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ return ]]
       â€£ âŸ… expansiveáµ[ Aâ‡„B ] âŸ†
       â€£ [[ Î³áµ[ Aâ‡„B ] âŸ Î±áµ[ Aâ‡„B ] ]]
       â€£ [focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ Aâ‡„B ] ] begin
           do [[ Î³áµ[ Aâ‡„B ] ]]
            â€£ âŸ… right-unit-expansive[âŸ]áµ[ Bâ‡„C ] âŸ†
            â€£ [[ Î³áµ[ Aâ‡„B ] âŸ (Î³áµ[ Bâ‡„C ] âŸ Î±áµ[ Bâ‡„C ]) ]]
            â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ (Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) âŸ Î±áµ[ Bâ‡„C ] ]]
           end
       â€£ [[ ((Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) âŸ Î±áµ[ Bâ‡„C ]) âŸ Î±áµ[ Aâ‡„B ] ]]
       â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) âŸ (Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) ]]
       âˆ
  ; contractiveáµ[_] = let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ (Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) âŸ (Î³áµ[ Aâ‡„B ] âŸ Î³áµ[ Bâ‡„C ]) ]]
       â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ ((Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) âŸ Î³áµ[ Aâ‡„B ]) âŸ Î³áµ[ Bâ‡„C ] ]]
       â€£ [focus-left [âŸ] ğ‘œğ‘“ Î³áµ[ Bâ‡„C ] ] begin
           do [[ (Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ]) âŸ Î³áµ[ Aâ‡„B ] ]]
            â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ Î±áµ[ Bâ‡„C ] âŸ Î±áµ[ Aâ‡„B ] âŸ Î³áµ[ Aâ‡„B ] ]]
            â€£ âŸ… right-unit-contractive[âŸ]áµ[ Aâ‡„B ] âŸ†
            â€£ [[ Î±áµ[ Bâ‡„C ] ]]
           end
       â€£ [[ Î±áµ[ Bâ‡„C ] âŸ Î³áµ[ Bâ‡„C ] ]]
       â€£ âŸ… contractiveáµ[ Bâ‡„C ] âŸ†
       â€£ [[ return ]]
       âˆ
  }

infixr 4 _â‡’â¸¢â‡„áµâ¸£_
_â‡’â¸¢â‡„áµâ¸£_ : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} â†’ Aâ‚ â‡„áµ Aâ‚‚ â†’ Bâ‚ â‡„áµ Bâ‚‚ â†’ (Aâ‚ â‡’ ğ’« Bâ‚) â‡„ (Aâ‚‚ â‡’ ğ’« Bâ‚‚)
_â‡’â¸¢â‡„áµâ¸£_ {Aâ‚ = Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} â‡„Aâ‡„ â‡„Bâ‡„ = record
  { Î±[_] = wrap[âŸ] â‹… Î±áµ[ â‡„Bâ‡„ ] â‹… Î³áµ[ â‡„Aâ‡„ ]
  ; Î³[_] = wrap[âŸ] â‹… Î³áµ[ â‡„Bâ‡„ ] â‹… Î±áµ[ â‡„Aâ‡„ ]
  ; expansive[_] = ext[â‡’]â¸¢âŠ‘â¸£ $ Î» {f} â†’ let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ f ]]
       â€£ âŸ… left-unit-expansive[âŸ]áµ[ â‡„Bâ‡„ ] âŸ†
       â€£ [[ (Î³áµ[ â‡„Bâ‡„ ] âŸ Î±áµ[ â‡„Bâ‡„ ]) âŸ f ]]
       â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ Î³áµ[ â‡„Bâ‡„ ] âŸ Î±áµ[ â‡„Bâ‡„ ] âŸ f ]]
       â€£ âŸ… right-unit-expansive[âŸ]áµ[ â‡„Aâ‡„ ] âŸ†
       â€£ [[ (Î³áµ[ â‡„Bâ‡„ ] âŸ Î±áµ[ â‡„Bâ‡„ ] âŸ f) âŸ Î³áµ[ â‡„Aâ‡„ ] âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
       â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ Î³áµ[ â‡„Bâ‡„ ] âŸ (Î±áµ[ â‡„Bâ‡„ ] âŸ f) âŸ Î³áµ[ â‡„Aâ‡„ ] âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ â‡„Bâ‡„ ] ] begin
           do [[ (Î±áµ[ â‡„Bâ‡„ ] âŸ f) âŸ Î³áµ[ â‡„Aâ‡„ ] âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
            â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ ((Î±áµ[ â‡„Bâ‡„ ] âŸ f) âŸ Î³áµ[ â‡„Aâ‡„ ]) âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
            â€£ [focus-left [âŸ] ğ‘œğ‘“ Î±áµ[ â‡„Aâ‡„ ] ] âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ (Î±áµ[ â‡„Bâ‡„ ] âŸ f âŸ Î³áµ[ â‡„Aâ‡„ ]) âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
           end
       â€£ [[ Î³áµ[ â‡„Bâ‡„ ] âŸ (Î±áµ[ â‡„Bâ‡„ ] âŸ f âŸ Î³áµ[ â‡„Aâ‡„ ]) âŸ Î±áµ[ â‡„Aâ‡„ ] ]]
       â€£ [[ (wrap[âŸ] â‹… Î³áµ[ â‡„Bâ‡„ ] â‹… Î±áµ[ â‡„Aâ‡„ ] âŠ™ wrap[âŸ] â‹… Î±áµ[ â‡„Bâ‡„ ] â‹… Î³áµ[ â‡„Aâ‡„ ]) â‹… f ]]
       âˆ
  ; contractive[_] = ext[â‡’]â¸¢âŠ‘â¸£ $ Î» {f} â†’ let open Â§-ProofMode[âŠ‘] in [proof-mode]
      do [[ (wrap[âŸ] â‹… Î±áµ[ â‡„Bâ‡„ ] â‹… Î³áµ[ â‡„Aâ‡„ ] âŠ™ wrap[âŸ] â‹… Î³áµ[ â‡„Bâ‡„ ] â‹… Î±áµ[ â‡„Aâ‡„ ]) â‹… f ]]
       â€£ [[ Î±áµ[ â‡„Bâ‡„ ] âŸ (Î³áµ[ â‡„Bâ‡„ ] âŸ f âŸ Î±áµ[ â‡„Aâ‡„ ]) âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
       â€£ [focus-right [âŸ] ğ‘œğ‘“ Î±áµ[ â‡„Bâ‡„ ] ] begin
           do [[ (Î³áµ[ â‡„Bâ‡„ ] âŸ f âŸ Î±áµ[ â‡„Aâ‡„ ]) âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
            â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
            â€£ [[ Î³áµ[ â‡„Bâ‡„ ] âŸ (f âŸ Î±áµ[ â‡„Aâ‡„ ]) âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
            â€£ [focus-right [âŸ] ğ‘œğ‘“ Î³áµ[ â‡„Bâ‡„ ] ] begin
                do [[ (f âŸ Î±áµ[ â‡„Aâ‡„ ]) âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
                 â€£ âŸ… associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
                 â€£ [[ f âŸ Î±áµ[ â‡„Aâ‡„ ] âŸ Î³áµ[ â‡„Aâ‡„ ] ]]
                 â€£ âŸ… right-unit-contractive[âŸ]áµ[ â‡„Aâ‡„ ] âŸ†
                 â€£ [[ f ]]
                end
           end
       â€£ [[ Î±áµ[ â‡„Bâ‡„ ] âŸ Î³áµ[ â‡„Bâ‡„ ] âŸ f ]]
       â€£ âŸ… â—‡ associative[âŸ] âŸ†â¸¢â‰ˆâ¸£
       â€£ [[ (Î±áµ[ â‡„Bâ‡„ ] âŸ Î³áµ[ â‡„Bâ‡„ ]) âŸ f ]]
       â€£ âŸ… left-unit-contractive[âŸ]áµ[ â‡„Bâ‡„ ] âŸ†
       â€£ [[ f ]]
       âˆ
  }

-- infixr 4 _Î±â‡„Î³áµâ¸¢â†‘â¸£_
-- record _Î±â‡„Î³áµâ¸¢â†‘â¸£_ {ğ“} (A B : Set ğ“) {{A-PO : PreOrder ğ“ A}} {{B-PO : PreOrder ğ“ B}} : Set (sucË¡ ğ“) where
--   field
--     Î±áµâ¸¢â†‘â¸£ : A â†’ B â†’ Set ğ“
--     monotonic[Î±áµâ¸¢â†‘â¸£] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î±áµâ¸¢â†‘â¸£
--     Î³áµâ¸¢â†‘â¸£ : B â†’ A â†’ Set ğ“
--     monotonic[Î³áµâ¸¢â†‘â¸£] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î³áµâ¸¢â†‘â¸£
--     sound[Î±Î³áµ]â¸¢â†‘â¸£ : âˆ€ {x : A} â†’ âˆƒ x^ ğ‘ ğ‘¡ Î±áµâ¸¢â†‘â¸£ x x^ Ã— Î³áµâ¸¢â†‘â¸£ x^ x
--     complete[Î±Î³áµ]â¸¢â†‘â¸£ : âˆ€ {xâ‚^ xâ‚‚^ x} â†’ Î³áµâ¸¢â†‘â¸£ xâ‚^ x â†’ Î±áµâ¸¢â†‘â¸£ x xâ‚‚^ â†’ xâ‚‚^ âŠ´ xâ‚^
-- 
-- mk[Î±â‡„Î³áµ]â¸¢â†‘â¸£ :
--   âˆ€ {ğ“} {A B : Set ğ“}
--     {{A-PO : PreOrder ğ“ A}} {{A-REX : Reflexive (_âŠ´_ {A = A})}}
--     {{B-PO : PreOrder ğ“ B}} {{B-REX : Reflexive (_âŠ´_ {A = B})}}
--   â†’ A Î±â‡„Î³áµâ¸¢â†‘â¸£ B â†’ â‡§ A Î±â‡„Î³áµ â‡§ B
-- mk[Î±â‡„Î³áµ]â¸¢â†‘â¸£ {A = A} {B} Aâ‡„B = record
--   { Î±áµ[_] = Î±
--   ; Î³áµ[_] = Î³
--   ; expansiveáµ[_] = Ï€â‚‚ expansiveâ†”soundáµ $ Î» {x} â†’ sound {x}
--   ; contractiveáµ[_] = Ï€â‚‚ contractiveâ†”completeáµ complete
--   }
--   where
--     open _Î±â‡„Î³áµâ¸¢â†‘â¸£_ Aâ‡„B
--     Î± : âŸª â‡§ A â‡’ ğ’« (â‡§ B) âŸ«
--     Î± = witness-x (curryâ¸¢Î»â†‘â¸£ idâ¸¢Ï‰â†‘â¸£) $ mk[witness] Î±áµâ¸¢â†‘â¸£ monotonic[Î±áµâ¸¢â†‘â¸£]
--     Î³ : âŸª â‡§ B â‡’ ğ’« (â‡§ A) âŸ«
--     Î³ = witness-x (curryâ¸¢Î»â†‘â¸£ idâ¸¢Ï‰â†‘â¸£) $ mk[witness] Î³áµâ¸¢â†‘â¸£ monotonic[Î³áµâ¸¢â†‘â¸£]
--     sound : âˆ€ {x} â†’ x â‹¿ Î³ * â‹… (Î± â‹… x)
--     sound {â†‘âŸ¨ x âŸ©} with sound[Î±Î³áµ]â¸¢â†‘â¸£ {x}
--     ... | âˆƒ x^ ,, x^âˆˆÎ±[x] , xâˆˆÎ³[x^]  = âˆƒğ’« â†‘ x^ ,, x^âˆˆÎ±[x] ,, xâˆˆÎ³[x^]
--     complete : âˆ€ {x^ y^} â†’ x^ â‹¿ Î± * â‹… (Î³ â‹… y^) â†’ x^ âŠ‘ y^
--     complete (âˆƒğ’« x ,, xâˆˆÎ³[x^] ,, y^âˆˆÎ±[x]) = intro[âŠ‘]â¸¢â†“â¸£ $ complete[Î±Î³áµ]â¸¢â†‘â¸£ xâˆˆÎ³[x^] y^âˆˆÎ±[x]
-- 
-- xRxâ¸¢Î±â‡„Î³áµâ¸£ : âˆ€ {ğ“} {A : POSet ğ“} â†’ A Î±â‡„Î³áµ A
-- xRxâ¸¢Î±â‡„Î³áµâ¸£ = record
--   { Î±áµ[_] = return
--   ; Î³áµ[_] = return
--   ; expansiveáµ[_] = xRx[] $ â—‡ left-unit[âŸ]
--   ; contractiveáµ[_] = xRx[] left-unit[âŸ]
--   }
-- 
-- Î±â‡„Î³áµâ†’Î±â‡„Î³ : âˆ€ {ğ“} {A B : POSet ğ“} â†’ A Î±â‡„Î³áµ B â†’ ğ’« A Î±â‡„Î³ ğ’« B
-- Î±â‡„Î³áµâ†’Î±â‡„Î³ Aâ‡„B = record
--   { Î±[_] = Î±áµ[ Aâ‡„B ] *
--   ; Î³[_] = Î³áµ[ Aâ‡„B ] *
--   ; expansive[_] = let open Â§-ProofMode[âŠ‘] in [proof-mode]
--       do [[ idáµ’ ]]
--        â€£ âŸ… â—‡ left-unit[*]â¸¢extâ¸£ âŸ†â¸¢â‰ˆâ¸£
--        â€£ [[ return * ]]
--        â€£ [focus-in [*] ] âŸ… expansiveáµ[ Aâ‡„B ] âŸ†
--        â€£ [[ (Î³áµ[ Aâ‡„B ] âŸ Î±áµ[ Aâ‡„B ]) * ]]
--        â€£ âŸ… associative[âŸ]â¸¢âŠ™â¸£ âŸ†â¸¢â‰ˆâ¸£
--        â€£ [[ Î³áµ[ Aâ‡„B ] * âŠ™ Î±áµ[ Aâ‡„B ] * ]]
--        âˆ
--   ; contractive[_] = let open Â§-ProofMode[âŠ‘] in [proof-mode]
--       do [[ Î±áµ[ Aâ‡„B ] * âŠ™ Î³áµ[ Aâ‡„B ] * ]]
--        â€£ âŸ… â—‡ associative[âŸ]â¸¢âŠ™â¸£ âŸ†â¸¢â‰ˆâ¸£
--        â€£ [[ (Î±áµ[ Aâ‡„B ] âŸ Î³áµ[ Aâ‡„B ]) * ]]
--        â€£ [focus-in [*] ] âŸ… contractiveáµ[ Aâ‡„B ] âŸ†
--        â€£ [[ return * ]]
--        â€£ âŸ… left-unit[*]â¸¢extâ¸£ âŸ†â¸¢â‰ˆâ¸£
--        â€£ [[ idáµ’ ]]
--        âˆ
--   }
-- 
-- _Ã—â¸¢Î±â‡„Î³áµâ¸£_ : âˆ€ {ğ“} {Aâ‚ Aâ‚‚ Bâ‚ Bâ‚‚ : POSet ğ“} â†’ Aâ‚ Î±â‡„Î³áµ Bâ‚ â†’ Aâ‚‚ Î±â‡„Î³áµ Bâ‚‚ â†’ (Aâ‚ âŸ¨Ã—âŸ© Aâ‚‚) Î±â‡„Î³áµ (Bâ‚ âŸ¨Ã—âŸ© Bâ‚‚)
-- _Ã—â¸¢Î±â‡„Î³áµâ¸£_ {ğ“} {Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} Aâ‚â‡„Bâ‚ Aâ‚‚â‡„Bâ‚‚ = mk[Î±â‡„Î³áµ]â¸¢â†‘â¸£ $ record
--   { Î±áµâ¸¢â†‘â¸£ = Î±
--   ; monotonic[Î±áµâ¸¢â†‘â¸£] = monotonic[Î±]
--   ; Î³áµâ¸¢â†‘â¸£ = Î³
--   ; monotonic[Î³áµâ¸¢â†‘â¸£] = monotonic[Î³]
--   ; sound[Î±Î³áµ]â¸¢â†‘â¸£ = sound
--   ; complete[Î±Î³áµ]â¸¢â†‘â¸£ = complete
--   }
--   where
--     Î± : prod Aâ‚ Aâ‚‚ â†’ prod Bâ‚ Bâ‚‚ â†’ Set ğ“
--     Î± (x , y) (x^ , y^) = (x^ â‹¿ Î±áµ[ Aâ‚â‡„Bâ‚ ] â‹… x) Ã— (y^ â‹¿ Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ] â‹… y)
--     abstract
--       monotonic[Î±] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î±
--       monotonic[Î±] (xâ‚âŠ‘xâ‚‚ , yâ‚âŠ‘yâ‚‚) (xâ‚^âŠ’xâ‚‚^ , yâ‚^âŠ’yâ‚‚^) (xâ‚^âˆˆÎ±[xâ‚] , yâ‚^âˆˆÎ±[yâ‚]) =
--           res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î±áµ[ Aâ‚â‡„Bâ‚ ]} xâ‚âŠ‘xâ‚‚) xâ‚^âŠ’xâ‚‚^ xâ‚^âˆˆÎ±[xâ‚]
--         , res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î±áµ[ Aâ‚‚â‡„Bâ‚‚ ]} yâ‚âŠ‘yâ‚‚) yâ‚^âŠ’yâ‚‚^ yâ‚^âˆˆÎ±[yâ‚]
--     Î³ : prod Bâ‚ Bâ‚‚ â†’ prod Aâ‚ Aâ‚‚ â†’ Set ğ“
--     Î³ (x^ , y^) (x , y) = (x â‹¿ Î³áµ[ Aâ‚â‡„Bâ‚ ] â‹… x^) Ã— (y â‹¿ Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ] â‹… y^)
--     abstract
--       monotonic[Î³] : proper (_âŠ´_ â‡‰ _âŠµ_ â‡‰ [â†’]) Î³
--       monotonic[Î³] (xâ‚^âŠ‘xâ‚‚^ , yâ‚^âŠ‘yâ‚‚^) (xâ‚âŠ’xâ‚‚ , yâ‚âŠ’yâ‚‚) (xâ‚âˆˆÎ³[xâ‚^] , yâ‚âˆˆÎ³[yâ‚^]) =
--           res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î³áµ[ Aâ‚â‡„Bâ‚ ]} xâ‚^âŠ‘xâ‚‚^) xâ‚âŠ’xâ‚‚ xâ‚âˆˆÎ³[xâ‚^]
--         , res-X-x[Ï‰]â¸¢âŠ‘â¸£ (res-x[Î»]â¸¢âŠ‘â¸£ {f = Î³áµ[ Aâ‚‚â‡„Bâ‚‚ ]} yâ‚^âŠ‘yâ‚‚^) yâ‚âŠ’yâ‚‚ yâ‚âˆˆÎ³[yâ‚^]
--     sound : âˆ€ {xy : prod Aâ‚ Aâ‚‚} â†’ âˆƒ xy^ ğ‘ ğ‘¡ Î± xy xy^ Ã— Î³ xy^ xy
--     sound {x , y} with soundáµ[ Aâ‚â‡„Bâ‚ ] {x} | soundáµ[ Aâ‚‚â‡„Bâ‚‚ ] {y}
--     ... | âˆƒğ’« x^ ,, x^âˆˆÎ±[x] ,, xâˆˆÎ³[x^] | âˆƒğ’« y^ ,, yâˆˆÎ±[y^] ,, y^âˆˆÎ³[y] = âˆƒ (x^ , y^) ,, (x^âˆˆÎ±[x] , yâˆˆÎ±[y^]) , (xâˆˆÎ³[x^] , y^âˆˆÎ³[y])
--     complete : âˆ€ {xyâ‚^ xyâ‚‚^ : prod Bâ‚ Bâ‚‚} {xy : prod Aâ‚ Aâ‚‚} â†’ Î³ xyâ‚^ xy â†’ Î± xy xyâ‚‚^ â†’ xyâ‚‚^ âŠ´ xyâ‚^
--     complete {xâ‚^ , yâ‚^} {xâ‚‚^ , yâ‚‚^} {x , y} (xâˆˆÎ³[xâ‚^] , yâˆˆÎ³[yâ‚^]) (xâ‚‚^âˆˆÎ±[x] , yâ‚‚^âˆˆÎ±[y]) =
--         (completeáµ[ Aâ‚â‡„Bâ‚ ] $ âˆƒğ’« x ,, xâˆˆÎ³[xâ‚^] ,, xâ‚‚^âˆˆÎ±[x])
--       , (completeáµ[ Aâ‚‚â‡„Bâ‚‚ ] $ âˆƒğ’« y ,, yâˆˆÎ³[yâ‚^] ,, yâ‚‚^âˆˆÎ±[y])
